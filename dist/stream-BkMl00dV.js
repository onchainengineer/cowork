import{aX as J,aY as z,aZ as M}from"./main-us6gfN3Q.js";class _{constructor(i){this.counter=0,this.metadataRegistry=i?.metadata??z,this.target=i?.target??"draft-2020-12",this.unrepresentable=i?.unrepresentable??"throw",this.override=i?.override??(()=>{}),this.io=i?.io??"output",this.seen=new Map}process(i,a={path:[],schemaPath:[]}){var r;const e=i._zod.def,u={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},f=this.seen.get(i);if(f)return f.count++,a.schemaPath.includes(i)&&(f.cycle=a.path),f.schema;const l={schema:{},count:1,cycle:void 0,path:a.path};this.seen.set(i,l);const g=i._zod.toJSONSchema?.();if(g)l.schema=g;else{const c={...a,schemaPath:[...a.schemaPath,i],path:a.path},w=i._zod.parent;if(w)l.ref=w,this.process(w,c),this.seen.get(w).isParent=!0;else{const p=l.schema;switch(e.type){case"string":{const t=p;t.type="string";const{minimum:s,maximum:o,format:m,patterns:d,contentEncoding:y}=i._zod.bag;if(typeof s=="number"&&(t.minLength=s),typeof o=="number"&&(t.maxLength=o),m&&(t.format=u[m]??m,t.format===""&&delete t.format),y&&(t.contentEncoding=y),d&&d.size>0){const S=[...d];S.length===1?t.pattern=S[0].source:S.length>1&&(l.schema.allOf=[...S.map(k=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:k.source}))])}break}case"number":{const t=p,{minimum:s,maximum:o,format:m,multipleOf:d,exclusiveMaximum:y,exclusiveMinimum:S}=i._zod.bag;typeof m=="string"&&m.includes("int")?t.type="integer":t.type="number",typeof S=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(t.minimum=S,t.exclusiveMinimum=!0):t.exclusiveMinimum=S),typeof s=="number"&&(t.minimum=s,typeof S=="number"&&this.target!=="draft-4"&&(S>=s?delete t.minimum:delete t.exclusiveMinimum)),typeof y=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(t.maximum=y,t.exclusiveMaximum=!0):t.exclusiveMaximum=y),typeof o=="number"&&(t.maximum=o,typeof y=="number"&&this.target!=="draft-4"&&(y<=o?delete t.maximum:delete t.exclusiveMaximum)),typeof d=="number"&&(t.multipleOf=d);break}case"boolean":{const t=p;t.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(p.type="string",p.nullable=!0,p.enum=[null]):p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const t=p,{minimum:s,maximum:o}=i._zod.bag;typeof s=="number"&&(t.minItems=s),typeof o=="number"&&(t.maxItems=o),t.type="array",t.items=this.process(e.element,{...c,path:[...c.path,"items"]});break}case"object":{const t=p;t.type="object",t.properties={};const s=e.shape;for(const d in s)t.properties[d]=this.process(s[d],{...c,path:[...c.path,"properties",d]});const o=new Set(Object.keys(s)),m=new Set([...o].filter(d=>{const y=e.shape[d]._zod;return this.io==="input"?y.optin===void 0:y.optout===void 0}));m.size>0&&(t.required=Array.from(m)),e.catchall?._zod.def.type==="never"?t.additionalProperties=!1:e.catchall?e.catchall&&(t.additionalProperties=this.process(e.catchall,{...c,path:[...c.path,"additionalProperties"]})):this.io==="output"&&(t.additionalProperties=!1);break}case"union":{const t=p,s=e.discriminator!==void 0,o=e.options.map((m,d)=>this.process(m,{...c,path:[...c.path,s?"oneOf":"anyOf",d]}));s?t.oneOf=o:t.anyOf=o;break}case"intersection":{const t=p,s=this.process(e.left,{...c,path:[...c.path,"allOf",0]}),o=this.process(e.right,{...c,path:[...c.path,"allOf",1]}),m=y=>"allOf"in y&&Object.keys(y).length===1,d=[...m(s)?s.allOf:[s],...m(o)?o.allOf:[o]];t.allOf=d;break}case"tuple":{const t=p;t.type="array";const s=this.target==="draft-2020-12"?"prefixItems":"items",o=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",m=e.items.map((k,$)=>this.process(k,{...c,path:[...c.path,s,$]})),d=e.rest?this.process(e.rest,{...c,path:[...c.path,o,...this.target==="openapi-3.0"?[e.items.length]:[]]}):null;this.target==="draft-2020-12"?(t.prefixItems=m,d&&(t.items=d)):this.target==="openapi-3.0"?(t.items={anyOf:m},d&&t.items.anyOf.push(d),t.minItems=m.length,d||(t.maxItems=m.length)):(t.items=m,d&&(t.additionalItems=d));const{minimum:y,maximum:S}=i._zod.bag;typeof y=="number"&&(t.minItems=y),typeof S=="number"&&(t.maxItems=S);break}case"record":{const t=p;t.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(t.propertyNames=this.process(e.keyType,{...c,path:[...c.path,"propertyNames"]})),t.additionalProperties=this.process(e.valueType,{...c,path:[...c.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const t=p,s=M(e.entries);s.every(o=>typeof o=="number")&&(t.type="number"),s.every(o=>typeof o=="string")&&(t.type="string"),t.enum=s;break}case"literal":{const t=p,s=[];for(const o of e.values)if(o===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof o=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");s.push(Number(o))}else s.push(o);if(s.length!==0)if(s.length===1){const o=s[0];t.type=o===null?"null":typeof o,this.target==="draft-4"||this.target==="openapi-3.0"?t.enum=[o]:t.const=o}else s.every(o=>typeof o=="number")&&(t.type="number"),s.every(o=>typeof o=="string")&&(t.type="string"),s.every(o=>typeof o=="boolean")&&(t.type="string"),s.every(o=>o===null)&&(t.type="null"),t.enum=s;break}case"file":{const t=p,s={type:"string",format:"binary",contentEncoding:"binary"},{minimum:o,maximum:m,mime:d}=i._zod.bag;o!==void 0&&(s.minLength=o),m!==void 0&&(s.maxLength=m),d?d.length===1?(s.contentMediaType=d[0],Object.assign(t,s)):t.anyOf=d.map(y=>({...s,contentMediaType:y})):Object.assign(t,s);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const t=this.process(e.innerType,c);this.target==="openapi-3.0"?(l.ref=e.innerType,p.nullable=!0):p.anyOf=[t,{type:"null"}];break}case"nonoptional":{this.process(e.innerType,c),l.ref=e.innerType;break}case"success":{const t=p;t.type="boolean";break}case"default":{this.process(e.innerType,c),l.ref=e.innerType,p.default=JSON.parse(JSON.stringify(e.defaultValue));break}case"prefault":{this.process(e.innerType,c),l.ref=e.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(e.defaultValue)));break}case"catch":{this.process(e.innerType,c),l.ref=e.innerType;let t;try{t=e.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=t;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const t=p,s=i._zod.pattern;if(!s)throw new Error("Pattern not found in template literal");t.type="string",t.pattern=s.source;break}case"pipe":{const t=this.io==="input"?e.in._zod.def.type==="transform"?e.out:e.in:e.out;this.process(t,c),l.ref=t;break}case"readonly":{this.process(e.innerType,c),l.ref=e.innerType,p.readOnly=!0;break}case"promise":{this.process(e.innerType,c),l.ref=e.innerType;break}case"optional":{this.process(e.innerType,c),l.ref=e.innerType;break}case"lazy":{const t=i._zod.innerType;this.process(t,c),l.ref=t;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const b=this.metadataRegistry.get(i);return b&&Object.assign(l.schema,b),this.io==="input"&&O(i)&&(delete l.schema.examples,delete l.schema.default),this.io==="input"&&l.schema._prefault&&((r=l.schema).default??(r.default=l.schema._prefault)),delete l.schema._prefault,this.seen.get(i).schema}emit(i,a){const r={cycles:a?.cycles??"ref",reused:a?.reused??"inline",external:a?.external??void 0},e=this.seen.get(i);if(!e)throw new Error("Unprocessed schema. This is a bug in Zod.");const u=h=>{const c=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const s=r.external.registry.get(h[0])?.id,o=r.external.uri??(d=>d);if(s)return{ref:o(s)};const m=h[1].defId??h[1].schema.id??`schema${this.counter++}`;return h[1].defId=m,{defId:m,ref:`${o("__shared")}#/${c}/${m}`}}if(h[1]===e)return{ref:"#"};const p=`#/${c}/`,t=h[1].schema.id??`__schema${this.counter++}`;return{defId:t,ref:p+t}},f=h=>{if(h[1].schema.$ref)return;const c=h[1],{ref:w,defId:p}=u(h);c.def={...c.schema},p&&(c.defId=p);const t=c.schema;for(const s in t)delete t[s];t.$ref=w};if(r.cycles==="throw")for(const h of this.seen.entries()){const c=h[1];if(c.cycle)throw new Error(`Cycle detected: #/${c.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const h of this.seen.entries()){const c=h[1];if(i===h[0]){f(h);continue}if(r.external){const p=r.external.registry.get(h[0])?.id;if(i!==h[0]&&p){f(h);continue}}if(this.metadataRegistry.get(h[0])?.id){f(h);continue}if(c.cycle){f(h);continue}if(c.count>1&&r.reused==="ref"){f(h);continue}}const l=(h,c)=>{const w=this.seen.get(h),p=w.def??w.schema,t={...p};if(w.ref===null)return;const s=w.ref;if(w.ref=null,s){l(s,c);const o=this.seen.get(s).schema;o.$ref&&(c.target==="draft-7"||c.target==="draft-4"||c.target==="openapi-3.0")?(p.allOf=p.allOf??[],p.allOf.push(o)):(Object.assign(p,o),Object.assign(p,t))}w.isParent||this.override({zodSchema:h,jsonSchema:p,path:w.path??[]})};for(const h of[...this.seen.entries()].reverse())l(h[0],{target:this.target});const g={};if(this.target==="draft-2020-12"?g.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?g.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?g.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),r.external?.uri){const h=r.external.registry.get(i)?.id;if(!h)throw new Error("Schema is missing an `id` property");g.$id=r.external.uri(h)}Object.assign(g,e.def);const b=r.external?.defs??{};for(const h of this.seen.entries()){const c=h[1];c.def&&c.defId&&(b[c.defId]=c.def)}r.external||Object.keys(b).length>0&&(this.target==="draft-2020-12"?g.$defs=b:g.definitions=b);try{return JSON.parse(JSON.stringify(g))}catch{throw new Error("Error converting schema to JSON.")}}}function L(n,i){if(n instanceof J){const r=new _(i),e={};for(const l of n._idmap.entries()){const[g,b]=l;r.process(b)}const u={},f={registry:n,uri:i?.uri,defs:e};for(const l of n._idmap.entries()){const[g,b]=l;u[g]=r.emit(b,{...i,external:f})}if(Object.keys(e).length>0){const l=r.target==="draft-2020-12"?"$defs":"definitions";u.__shared={[l]:e}}return{schemas:u}}const a=new _(i);return a.process(n),a.emit(n,i)}function O(n,i){const a=i??{seen:new Set};if(a.seen.has(n))return!1;a.seen.add(n);const r=n._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return O(r.element,a);if(r.type==="set")return O(r.valueType,a);if(r.type==="lazy")return O(r.getter(),a);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return O(r.innerType,a);if(r.type==="intersection")return O(r.left,a)||O(r.right,a);if(r.type==="record"||r.type==="map")return O(r.keyType,a)||O(r.valueType,a);if(r.type==="pipe")return O(r.in,a)||O(r.out,a);if(r.type==="object"){for(const e in r.shape)if(O(r.shape[e],a))return!0;return!1}if(r.type==="union"){for(const e of r.options)if(O(e,a))return!0;return!1}if(r.type==="tuple"){for(const e of r.items)if(O(e,a))return!0;return!!(r.rest&&O(r.rest,a))}return!1}var x;(function(n){n.assertEqual=e=>{};function i(e){}n.assertIs=i;function a(e){throw new Error}n.assertNever=a,n.arrayToEnum=e=>{const u={};for(const f of e)u[f]=f;return u},n.getValidEnumValues=e=>{const u=n.objectKeys(e).filter(l=>typeof e[e[l]]!="number"),f={};for(const l of u)f[l]=e[l];return n.objectValues(f)},n.objectValues=e=>n.objectKeys(e).map(function(u){return e[u]}),n.objectKeys=typeof Object.keys=="function"?e=>Object.keys(e):e=>{const u=[];for(const f in e)Object.prototype.hasOwnProperty.call(e,f)&&u.push(f);return u},n.find=(e,u)=>{for(const f of e)if(u(f))return f},n.isInteger=typeof Number.isInteger=="function"?e=>Number.isInteger(e):e=>typeof e=="number"&&Number.isFinite(e)&&Math.floor(e)===e;function r(e,u=" | "){return e.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}n.joinValues=r,n.jsonStringifyReplacer=(e,u)=>typeof u=="bigint"?u.toString():u})(x||(x={}));var j;(function(n){n.mergeShapes=(i,a)=>({...i,...a})})(j||(j={}));x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class v extends Error{get errors(){return this.issues}constructor(i){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=i}format(i){const a=i||function(u){return u.message},r={_errors:[]},e=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(e);else if(f.code==="invalid_return_type")e(f.returnTypeError);else if(f.code==="invalid_arguments")e(f.argumentsError);else if(f.path.length===0)r._errors.push(a(f));else{let l=r,g=0;for(;g<f.path.length;){const b=f.path[g];g===f.path.length-1?(l[b]=l[b]||{_errors:[]},l[b]._errors.push(a(f))):l[b]=l[b]||{_errors:[]},l=l[b],g++}}};return e(this),r}static assert(i){if(!(i instanceof v))throw new Error(`Not a ZodError: ${i}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(i=a=>a.message){const a=Object.create(null),r=[];for(const e of this.issues)if(e.path.length>0){const u=e.path[0];a[u]=a[u]||[],a[u].push(i(e))}else r.push(i(e));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}}v.create=n=>new v(n);var N;(function(n){n.errToObj=i=>typeof i=="string"?{message:i}:i||{},n.toString=i=>typeof i=="string"?i:i?.message})(N||(N={}));var Z;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Z||(Z={}));class I extends Error{constructor(i,a){super(i),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function E(n){}function R(n){if(typeof n=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:i=E,onError:a=E,onRetry:r=E,onComment:e}=n;let u="",f=!0,l,g="",b="";function h(s){const o=f?s.replace(/^\xEF\xBB\xBF/,""):s,[m,d]=U(`${u}${o}`);for(const y of m)c(y);u=d,f=!1}function c(s){if(s===""){p();return}if(s.startsWith(":")){e&&e(s.slice(s.startsWith(": ")?2:1));return}const o=s.indexOf(":");if(o!==-1){const m=s.slice(0,o),d=s[o+1]===" "?2:1,y=s.slice(o+d);w(m,y,s);return}w(s,"",s)}function w(s,o,m){switch(s){case"event":b=o;break;case"data":g=`${g}${o}
`;break;case"id":l=o.includes("\0")?void 0:o;break;case"retry":/^\d+$/.test(o)?r(parseInt(o,10)):a(new I(`Invalid \`retry\` value: "${o}"`,{type:"invalid-retry",value:o,line:m}));break;default:a(new I(`Unknown field "${s.length>20?`${s.slice(0,20)}â€¦`:s}"`,{type:"unknown-field",field:s,value:o,line:m}));break}}function p(){g.length>0&&i({id:l,event:b||void 0,data:g.endsWith(`
`)?g.slice(0,-1):g}),l=void 0,g="",b=""}function t(s={}){u&&s.consume&&c(u),f=!0,l=void 0,g="",b="",u=""}return{feed:h,reset:t}}function U(n){const i=[];let a="",r=0;for(;r<n.length;){const e=n.indexOf("\r",r),u=n.indexOf(`
`,r);let f=-1;if(e!==-1&&u!==-1?f=Math.min(e,u):e!==-1?e===n.length-1?f=-1:f=e:u!==-1&&(f=u),f===-1){a=n.slice(r);break}else{const l=n.slice(r,f);i.push(l),r=f+1,n[r-1]==="\r"&&n[r]===`
`&&r++}}return[i,a]}class B extends TransformStream{constructor({onError:i,onRetry:a,onComment:r}={}){let e;super({start(u){e=R({onEvent:f=>{u.enqueue(f)},onError(f){i==="terminate"?u.error(f):typeof i=="function"&&i(f)},onRetry:a,onComment:r})},transform(u){e.feed(u)}})}}export{B as E,Z,L as t};
//# sourceMappingURL=stream-BkMl00dV.js.map
