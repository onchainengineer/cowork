import{E as ln,t as un,Z as f}from"./stream-EztMLV5l.js";import{aH as cn,u as _e,o as y,c as _t,f as bt,s as h,n as w,b as kt,a as U,_ as dn,r as fe,l as pn}from"./main-D0Ooo9fF.js";import"./__vite-browser-external-2447137e-CirRYW17.js";var wt="vercel.ai.error",fn=Symbol.for(wt),Re,De,Z=class St extends(De=Error,Re=fn,De){constructor({name:t,message:n,cause:r}){super(n),this[Re]=!0,this.name=t,this.cause=r}static isInstance(t){return St.hasMarker(t,wt)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}},Ot="AI_InvalidPromptError",At=`vercel.ai.error.${Ot}`,hn=Symbol.for(At),Ne,je,mn=class extends(je=Z,Ne=hn,je){constructor({prompt:e,message:t,cause:n}){super({name:Ot,message:`Invalid prompt: ${t}`,cause:n}),this[Ne]=!0,this.prompt=e}static isInstance(e){return Z.hasMarker(e,At)}},xt="AI_InvalidResponseDataError",Tt=`vercel.ai.error.${xt}`,gn=Symbol.for(Tt),Me,Ue,Ze=class extends(Ue=Z,Me=gn,Ue){constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:xt,message:t}),this[Me]=!0,this.data=e}static isInstance(e){return Z.hasMarker(e,Tt)}},Ct="AI_TooManyEmbeddingValuesForCallError",Pt=`vercel.ai.error.${Ct}`,vn=Symbol.for(Pt),Fe,Le,yn=class extends(Le=Z,Fe=vn,Le){constructor(e){super({name:Ct,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Fe]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return Z.hasMarker(e,Pt)}},It="AI_UnsupportedFunctionalityError",Et=`vercel.ai.error.${It}`,_n=Symbol.for(Et),qe,He,q=class extends(He=Z,qe=_n,He){constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:It,message:t}),this[qe]=!0,this.functionality=e}static isInstance(e){return Z.hasMarker(e,Et)}},$t="vercel.ai.error",bn=Symbol.for($t),Ve,Be,R=class Rt extends(Be=Error,Ve=bn,Be){constructor({name:t,message:n,cause:r}){super(n),this[Ve]=!0,this.name=t,this.cause=r}static isInstance(t){return Rt.hasMarker(t,$t)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}},Dt="AI_APICallError",Nt=`vercel.ai.error.${Dt}`,kn=Symbol.for(Nt),ze,Je,j=class extends(Je=R,ze=kn,Je){constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:a,responseBody:o,cause:s,isRetryable:l=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:Dt,message:e,cause:s}),this[ze]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=a,this.responseBody=o,this.isRetryable=l,this.data=u}static isInstance(e){return R.hasMarker(e,Nt)}},jt="AI_EmptyResponseBodyError",Mt=`vercel.ai.error.${jt}`,wn=Symbol.for(Mt),We,Ke,Sn=class extends(Ke=R,We=wn,Ke){constructor({message:e="Empty response body"}={}){super({name:jt,message:e}),this[We]=!0}static isInstance(e){return R.hasMarker(e,Mt)}};function Ut(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Zt="AI_InvalidArgumentError",Ft=`vercel.ai.error.${Zt}`,On=Symbol.for(Ft),Ge,Xe,Lt=class extends(Xe=R,Ge=On,Xe){constructor({message:e,cause:t,argument:n}){super({name:Zt,message:e,cause:t}),this[Ge]=!0,this.argument=n}static isInstance(e){return R.hasMarker(e,Ft)}},qt="AI_JSONParseError",Ht=`vercel.ai.error.${qt}`,An=Symbol.for(Ht),Ye,Qe,ae=class extends(Qe=R,Ye=An,Qe){constructor({text:e,cause:t}){super({name:qt,message:`JSON parsing failed: Text: ${e}.
Error message: ${Ut(t)}`,cause:t}),this[Ye]=!0,this.text=e}static isInstance(e){return R.hasMarker(e,Ht)}},Vt="AI_TypeValidationError",Bt=`vercel.ai.error.${Vt}`,xn=Symbol.for(Bt),et,tt,W=class he extends(tt=R,et=xn,tt){constructor({value:t,cause:n}){super({name:Vt,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Ut(n)}`,cause:n}),this[et]=!0,this.value=t}static isInstance(t){return R.hasMarker(t,Bt)}static wrap({value:t,cause:n}){return he.isInstance(n)&&n.value===t?n:new he({value:t,cause:n})}};function V(...e){return e.reduce((t,n)=>({...t,...n??{}}),{})}function oe(e){return Object.fromEntries([...e.headers])}var{btoa:Tn,atob:Cn}=globalThis;function Pn(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Cn(t);return Uint8Array.from(n,r=>r.codePointAt(0))}function In(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Tn(t)}function se(e){return e instanceof Uint8Array?In(e):e}function En(e,t={}){const{useArrayBrackets:n=!0}=t,r=new FormData;for(const[a,o]of Object.entries(e))if(o!=null){if(Array.isArray(o)){if(o.length===1){r.append(a,o[0]);continue}const s=n?`${a}[]`:a;for(const l of o)r.append(s,l);continue}r.append(a,o)}return r}var zt="AI_DownloadError",Jt=`vercel.ai.error.${zt}`,$n=Symbol.for(Jt),nt,rt,le=class extends(rt=R,nt=$n,rt){constructor({url:e,statusCode:t,statusText:n,cause:r,message:a=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:zt,message:a,cause:r}),this[nt]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return R.hasMarker(e,Jt)}};async function Rn(e){try{const t=await fetch(e);if(!t.ok)throw new le({url:e,statusCode:t.status,statusText:t.statusText});return await t.blob()}catch(t){throw le.isInstance(t)?t:new le({url:e,cause:t})}}var Dn=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=()=>{const o=n.length,s=new Array(t);for(let l=0;l<t;l++)s[l]=n[Math.random()*o|0];return s.join("")};if(e==null)return a;if(n.includes(r))throw new Lt({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${a()}`},ne=Dn();function me(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var Nn=["fetch failed","failed to fetch"],jn=["ConnectionRefused","ConnectionClosed","FailedToOpenSocket","ECONNRESET","ECONNREFUSED","ETIMEDOUT","EPIPE"];function Mn(e){if(!(e instanceof Error))return!1;const t=e.code;return!!(typeof t=="string"&&jn.includes(t))}function Un({error:e,url:t,requestBodyValues:n}){if(me(e))return e;if(e instanceof TypeError&&Nn.includes(e.message.toLowerCase())){const r=e.cause;if(r!=null)return new j({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return Mn(e)?new j({message:`Cannot connect to API: ${e.message}`,cause:e,url:t,requestBodyValues:n,isRetryable:!0}):e}function Zn(e=globalThis){var t,n,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(n=e.process)==null?void 0:n.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function Fn(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((n,r)=>{t[r.toLowerCase()]=n});else{Array.isArray(e)||(e=Object.entries(e));for(const[n,r]of e)r!=null&&(t[n.toLowerCase()]=r)}return t}function Wt(e,...t){const n=new Headers(Fn(e)),r=n.get("user-agent")||"";return n.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}var Ln="4.0.10",qn=/"__proto__"\s*:/,Hn=/"constructor"\s*:/;function at(e){const t=JSON.parse(e);return t===null||typeof t!="object"||qn.test(e)===!1&&Hn.test(e)===!1?t:Vn(t)}function Vn(e){let t=[e];for(;t.length;){const n=t;t=[];for(const r of n){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in r){const o=r[a];o&&typeof o=="object"&&t.push(o)}}}return e}function be(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return at(e)}try{return at(e)}finally{Error.stackTraceLimit=t}}function ke(e){if(e.type==="object"||Array.isArray(e.type)&&e.type.includes("object")){e.additionalProperties=!1;const{properties:n}=e;if(n!=null)for(const r of Object.keys(n))n[r]=L(n[r])}e.items!=null&&(e.items=Array.isArray(e.items)?e.items.map(L):L(e.items)),e.anyOf!=null&&(e.anyOf=e.anyOf.map(L)),e.allOf!=null&&(e.allOf=e.allOf.map(L)),e.oneOf!=null&&(e.oneOf=e.oneOf.map(L));const{definitions:t}=e;if(t!=null)for(const n of Object.keys(t))t[n]=L(t[n]);return e}function L(e){return typeof e=="boolean"?e:ke(e)}var Bn=Symbol("Let zodToJsonSchema decide on which parser to use"),ot={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},zn=e=>typeof e=="string"?{...ot,name:e}:{...ot,...e};function $(){return{}}function Jn(e,t){var n,r,a;const o={type:"array"};return(n=e.type)!=null&&n._def&&((a=(r=e.type)==null?void 0:r._def)==null?void 0:a.typeName)!==f.ZodAny&&(o.items=b(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function Wn(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}function Kn(){return{type:"boolean"}}function Kt(e,t){return b(e.type._def,t)}var Gn=(e,t)=>b(e.innerType._def,t);function Gt(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,o)=>Gt(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Xn(e)}}var Xn=e=>{const t={type:"integer",format:"unix-time"};for(const n of e.checks)switch(n.kind){case"min":t.minimum=n.value;break;case"max":t.maximum=n.value;break}return t};function Yn(e,t){return{...b(e.innerType._def,t),default:e.defaultValue()}}function Qn(e,t){return t.effectStrategy==="input"?b(e.schema._def,t):$()}function er(e){return{type:"string",enum:Array.from(e.values)}}var tr=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function nr(e,t){const n=[b(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),b(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a),r=[];return n.forEach(a=>{if(tr(a))r.push(...a.allOf);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:s,...l}=a;o=l}r.push(o)}}),r.length?{allOf:r}:void 0}function rr(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var ue=void 0,D={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ue===void 0&&(ue=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ue),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Xt(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value;break;case"max":n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":N(n,"email",r.message,t);break;case"format:idn-email":N(n,"idn-email",r.message,t);break;case"pattern:zod":C(n,D.email,r.message,t);break}break;case"url":N(n,"uri",r.message,t);break;case"uuid":N(n,"uuid",r.message,t);break;case"regex":C(n,r.regex,r.message,t);break;case"cuid":C(n,D.cuid,r.message,t);break;case"cuid2":C(n,D.cuid2,r.message,t);break;case"startsWith":C(n,RegExp(`^${ce(r.value,t)}`),r.message,t);break;case"endsWith":C(n,RegExp(`${ce(r.value,t)}$`),r.message,t);break;case"datetime":N(n,"date-time",r.message,t);break;case"date":N(n,"date",r.message,t);break;case"time":N(n,"time",r.message,t);break;case"duration":N(n,"duration",r.message,t);break;case"length":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"includes":{C(n,RegExp(ce(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&N(n,"ipv4",r.message,t),r.version!=="v4"&&N(n,"ipv6",r.message,t);break}case"base64url":C(n,D.base64url,r.message,t);break;case"jwt":C(n,D.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&C(n,D.ipv4Cidr,r.message,t),r.version!=="v4"&&C(n,D.ipv6Cidr,r.message,t);break}case"emoji":C(n,D.emoji(),r.message,t);break;case"ulid":{C(n,D.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{N(n,"binary",r.message,t);break}case"contentEncoding:base64":{n.contentEncoding="base64";break}case"pattern:zod":{C(n,D.base64,r.message,t);break}}break}case"nanoid":C(n,D.nanoid,r.message,t)}return n}function ce(e,t){return t.patternStrategy==="escape"?or(e):e}var ar=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function or(e){let t="";for(let n=0;n<e.length;n++)ar.has(e[n])||(t+="\\"),t+=e[n];return t}function N(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function C(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:it(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=it(t,r)}function it(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source;let o="",s=!1,l=!1,u=!1;for(let i=0;i<a.length;i++){if(s){o+=a[i],s=!1;continue}if(r.i){if(l){if(a[i].match(/[a-z]/)){u?(o+=a[i],o+=`${a[i-2]}-${a[i]}`.toUpperCase(),u=!1):a[i+1]==="-"&&((n=a[i+2])!=null&&n.match(/[a-z]/))?(o+=a[i],u=!0):o+=`${a[i]}${a[i].toUpperCase()}`;continue}}else if(a[i].match(/[a-z]/)){o+=`[${a[i]}${a[i].toUpperCase()}]`;continue}}if(r.m){if(a[i]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[i]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&a[i]==="."){o+=l?`${a[i]}\r
`:`[${a[i]}\r
]`;continue}o+=a[i],a[i]==="\\"?s=!0:l&&a[i]==="]"?l=!1:!l&&a[i]==="["&&(l=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function Yt(e,t){var n,r,a,o,s,l;const u={type:"object",additionalProperties:(n=b(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?n:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===f.ZodString&&((a=e.keyType._def.checks)!=null&&a.length)){const{type:i,...c}=Xt(e.keyType._def,t);return{...u,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===f.ZodEnum)return{...u,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===f.ZodBranded&&e.keyType._def.type._def.typeName===f.ZodString&&((l=e.keyType._def.type._def.checks)!=null&&l.length)){const{type:i,...c}=Kt(e.keyType._def,t);return{...u,propertyNames:c}}}return u}function ir(e,t){if(t.mapStrategy==="record")return Yt(e,t);const n=b(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||$(),r=b(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||$();return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function sr(e){const t=e.values,r=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(r.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function lr(){return{not:$()}}function ur(){return{type:"null"}}var ge={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function cr(e,t){const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in ge&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,o)=>{const s=ge[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((o,s,l)=>l.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:n.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(o=>!r.includes(o))],[])};return dr(e,t)}var dr=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>b(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function pr(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[ge[e.innerType._def.typeName],"null"]};const n=b(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function fr(e){const t={type:"number"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"int":t.type="integer";break;case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}function hr(e,t){const n={type:"object",properties:{}},r=[],a=e.shape();for(const s in a){let l=a[s];if(l===void 0||l._def===void 0)continue;const u=gr(l),i=b(l._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});i!==void 0&&(n.properties[s]=i,u||r.push(s))}r.length&&(n.required=r);const o=mr(e,t);return o!==void 0&&(n.additionalProperties=o),n}function mr(e,t){if(e.catchall._def.typeName!=="ZodNever")return b(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function gr(e){try{return e.isOptional()}catch{return!0}}var vr=(e,t)=>{var n;if(t.currentPath.toString()===((n=t.propertyPath)==null?void 0:n.toString()))return b(e.innerType._def,t);const r=b(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:$()},r]}:$()},yr=(e,t)=>{if(t.pipeStrategy==="input")return b(e.in._def,t);if(t.pipeStrategy==="output")return b(e.out._def,t);const n=b(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=b(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function _r(e,t){return b(e.type._def,t)}function br(e,t){const r={type:"array",uniqueItems:!0,items:b(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function kr(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>b(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:b(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>b(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function wr(){return{not:$()}}function Sr(){return $()}var Or=(e,t)=>b(e.innerType._def,t),Ar=(e,t,n)=>{switch(t){case f.ZodString:return Xt(e,n);case f.ZodNumber:return fr(e);case f.ZodObject:return hr(e,n);case f.ZodBigInt:return Wn(e);case f.ZodBoolean:return Kn();case f.ZodDate:return Gt(e,n);case f.ZodUndefined:return wr();case f.ZodNull:return ur();case f.ZodArray:return Jn(e,n);case f.ZodUnion:case f.ZodDiscriminatedUnion:return cr(e,n);case f.ZodIntersection:return nr(e,n);case f.ZodTuple:return kr(e,n);case f.ZodRecord:return Yt(e,n);case f.ZodLiteral:return rr(e);case f.ZodEnum:return er(e);case f.ZodNativeEnum:return sr(e);case f.ZodNullable:return pr(e,n);case f.ZodOptional:return vr(e,n);case f.ZodMap:return ir(e,n);case f.ZodSet:return br(e,n);case f.ZodLazy:return()=>e.getter()._def;case f.ZodPromise:return _r(e,n);case f.ZodNaN:case f.ZodNever:return lr();case f.ZodEffects:return Qn(e,n);case f.ZodAny:return $();case f.ZodUnknown:return Sr();case f.ZodDefault:return Yn(e,n);case f.ZodBranded:return Kt(e,n);case f.ZodReadonly:return Or(e,n);case f.ZodCatch:return Gn(e,n);case f.ZodPipeline:return yr(e,n);case f.ZodFunction:case f.ZodVoid:case f.ZodSymbol:return;default:return(r=>{})()}},xr=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function b(e,t,n=!1){var r;const a=t.seen.get(e);if(t.override){const u=(r=t.override)==null?void 0:r.call(t,e,t,a,n);if(u!==Bn)return u}if(a&&!n){const u=Tr(a,t);if(u!==void 0)return u}const o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);const s=Ar(e,e.typeName,t),l=typeof s=="function"?b(s(),t):s;if(l&&Cr(e,t,l),t.postProcess){const u=t.postProcess(l,e,t);return o.jsonSchema=l,u}return o.jsonSchema=l,l}var Tr=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:xr(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),$()):t.$refStrategy==="seen"?$():void 0}},Cr=(e,t,n)=>(e.description&&(n.description=e.description),n),Pr=e=>{const t=zn(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},Ir=(e,t)=>{var n;const r=Pr(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((i,[c,p])=>{var d;return{...i,[c]:(d=b(p._def,{...r,currentPath:[...r.basePath,r.definitionPath,c]},!0))!=null?d:$()}},{}):void 0;const o=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=(n=b(e._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1))!=null?n:$(),l=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;l!==void 0&&(s.title=l);const u=o===void 0?a?{...s,[r.definitionPath]:a}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...a,[o]:s}};return u.$schema="http://json-schema.org/draft-07/schema#",u},ve=Symbol.for("vercel.ai.schema");function ie(e,{validate:t}={}){return{[ve]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function Er(e){return typeof e=="object"&&e!==null&&ve in e&&e[ve]===!0&&"jsonSchema"in e&&"validate"in e}function $r(e){return e==null?ie({properties:{},additionalProperties:!1}):Er(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?Mr(e):Rr(e):e()}function Rr(e){return ie(()=>ke(e["~standard"].jsonSchema.input({target:"draft-07"})),{validate:async t=>{const n=await e["~standard"].validate(t);return"value"in n?{success:!0,value:n.value}:{success:!1,error:new W({value:t,cause:n.issues})}}})}function Dr(e,t){var n;const r=(n=void 0)!=null?n:!1;return ie(()=>Ir(e,{$refStrategy:r?"root":"none"}),{validate:async a=>{const o=await e.safeParseAsync(a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function Nr(e,t){var n;const r=(n=void 0)!=null?n:!1;return ie(()=>ke(un(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async a=>{const o=await cn(e,a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function jr(e){return"_zod"in e}function Mr(e,t){return jr(e)?Nr(e):Dr(e)}async function Ur({value:e,schema:t}){const n=await we({value:e,schema:t});if(!n.success)throw W.wrap({value:e,cause:n.error});return n.value}async function we({value:e,schema:t}){const n=$r(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};const r=await n.validate(e);return r.success?{success:!0,value:r.value,rawValue:e}:{success:!1,error:W.wrap({value:e,cause:r.error}),rawValue:e}}catch(r){return{success:!1,error:W.wrap({value:e,cause:r}),rawValue:e}}}async function Zr({text:e,schema:t}){try{const n=be(e);return t==null?n:Ur({value:n,schema:t})}catch(n){throw ae.isInstance(n)||W.isInstance(n)?n:new ae({text:e,cause:n})}}async function Qt({text:e,schema:t}){try{const n=be(e);return t==null?{success:!0,value:n,rawValue:n}:await we({value:n,schema:t})}catch(n){return{success:!1,error:ae.isInstance(n)?n:new ae({text:e,cause:n}),rawValue:void 0}}}function st(e){try{return be(e),!0}catch{return!1}}function Fr({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new ln).pipeThrough(new TransformStream({async transform({data:n},r){n!=="[DONE]"&&r.enqueue(await Qt({text:n,schema:t}))}}))}async function H({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;const r=await we({value:t[e],schema:n});if(!r.success)throw new Lt({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var Lr=()=>globalThis.fetch,z=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:o,fetch:s})=>en({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:o,fetch:s}),qr=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:o,fetch:s})=>en({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:o,fetch:s}),en=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:a,abortSignal:o,fetch:s=Lr()})=>{try{const l=await s(e,{method:"POST",headers:Wt(t,`ai-sdk/provider-utils/${Ln}`,Zn()),body:n.content,signal:o}),u=oe(l);if(!l.ok){let i;try{i=await a({response:l,url:e,requestBodyValues:n.values})}catch(c){throw me(c)||j.isInstance(c)?c:new j({message:"Failed to process error response",cause:c,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw i.value}try{return await r({response:l,url:e,requestBodyValues:n.values})}catch(i){throw i instanceof Error&&(me(i)||j.isInstance(i))?i:new j({message:"Failed to process successful response",cause:i,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(l){throw Un({error:l,url:e,requestBodyValues:n.values})}},K=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:a,requestBodyValues:o})=>{const s=await r.text(),l=oe(r);if(s.trim()==="")return{responseHeaders:l,value:new j({message:r.statusText,url:a,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,isRetryable:n?.(r)})};try{const u=await Zr({text:s,schema:e});return{responseHeaders:l,value:new j({message:t(u),url:a,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,data:u,isRetryable:n?.(r,u)})}}catch{return{responseHeaders:l,value:new j({message:r.statusText,url:a,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,isRetryable:n?.(r)})}}},tn=e=>async({response:t})=>{const n=oe(t);if(t.body==null)throw new Sn({});return{responseHeaders:n,value:Fr({stream:t.body,schema:e})}},G=e=>async({response:t,url:n,requestBodyValues:r})=>{const a=await t.text(),o=await Qt({text:a,schema:e}),s=oe(t);if(!o.success)throw new j({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:n,requestBodyValues:r});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}};function Hr(e){return e?.replace(/\/$/,"")}var Vr=y({error:y({message:h(),type:h().nullish(),param:bt().nullish(),code:_e([h(),w()]).nullish()})}),X={errorSchema:Vr,errorToMessage:e=>e.error.message};function lt(e){var t,n,r,a,o,s;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const l=(t=e.prompt_tokens)!=null?t:0,u=(n=e.completion_tokens)!=null?n:0,i=(a=(r=e.prompt_tokens_details)==null?void 0:r.cached_tokens)!=null?a:0,c=(s=(o=e.completion_tokens_details)==null?void 0:o.reasoning_tokens)!=null?s:0;return{inputTokens:{total:l,noCache:l-i,cacheRead:i,cacheWrite:void 0},outputTokens:{total:u,text:u-c,reasoning:c},raw:e}}function J(e){var t,n;return(n=(t=e?.providerOptions)==null?void 0:t.openaiCompatible)!=null?n:{}}function Br(e){switch(e){case"audio/wav":return"wav";case"audio/mp3":case"audio/mpeg":return"mp3";default:return null}}function zr(e){var t,n,r;const a=[];for(const{role:o,content:s,...l}of e){const u=J({...l});switch(o){case"system":{a.push({role:"system",content:s,...u});break}case"user":{if(s.length===1&&s[0].type==="text"){a.push({role:"user",content:s[0].text,...J(s[0])});break}a.push({role:"user",content:s.map(i=>{var c;const p=J(i);switch(i.type){case"text":return{type:"text",text:i.text,...p};case"file":{if(i.mediaType.startsWith("image/")){const d=i.mediaType==="image/*"?"image/jpeg":i.mediaType;return{type:"image_url",image_url:{url:i.data instanceof URL?i.data.toString():`data:${d};base64,${se(i.data)}`},...p}}if(i.mediaType.startsWith("audio/")){if(i.data instanceof URL)throw new q({functionality:"audio file parts with URLs"});const d=Br(i.mediaType);if(d===null)throw new q({functionality:`audio media type ${i.mediaType}`});return{type:"input_audio",input_audio:{data:se(i.data),format:d},...p}}if(i.mediaType==="application/pdf"){if(i.data instanceof URL)throw new q({functionality:"PDF file parts with URLs"});return{type:"file",file:{filename:(c=i.filename)!=null?c:"document.pdf",file_data:`data:application/pdf;base64,${se(i.data)}`},...p}}if(i.mediaType.startsWith("text/"))return{type:"text",text:i.data instanceof URL?i.data.toString():typeof i.data=="string"?i.data:new TextDecoder().decode(i.data),...p};throw new q({functionality:`file part media type ${i.mediaType}`})}}}),...u});break}case"assistant":{let i="",c="";const p=[];for(const d of s){const v=J(d);switch(d.type){case"text":{i+=d.text;break}case"reasoning":{c+=d.text;break}case"tool-call":{const _=(n=(t=d.providerOptions)==null?void 0:t.google)==null?void 0:n.thoughtSignature;p.push({id:d.toolCallId,type:"function",function:{name:d.toolName,arguments:JSON.stringify(d.input)},...v,..._?{extra_content:{google:{thought_signature:String(_)}}}:{}});break}}}a.push({role:"assistant",content:i,...c.length>0?{reasoning_content:c}:{},tool_calls:p.length>0?p:void 0,...u});break}case"tool":{for(const i of s){if(i.type==="tool-approval-response")continue;const c=i.output;let p;switch(c.type){case"text":case"error-text":p=c.value;break;case"execution-denied":p=(r=c.reason)!=null?r:"Tool execution denied.";break;case"content":case"json":case"error-json":p=JSON.stringify(c.value);break}const d=J(i);a.push({role:"tool",tool_call_id:i.toolCallId,content:p,...d})}break}default:{const i=o;throw new Error(`Unsupported role: ${i}`)}}}return a}function ut({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function ct(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var re=y({user:h().optional(),reasoningEffort:h().optional(),textVerbosity:h().optional(),strictJsonSchema:kt().optional()});function Jr({tools:e,toolChoice:t}){e=e?.length?e:void 0;const n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const o of e)o.type==="provider"?n.push({type:"unsupported",feature:`provider-defined tool ${o.id}`}):r.push({type:"function",function:{name:o.name,description:o.description,parameters:o.inputSchema,...o.strict!=null?{strict:o.strict}:{}}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const a=t.type;switch(a){case"auto":case"none":case"required":return{tools:r,toolChoice:a,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:{const o=a;throw new q({functionality:`tool choice type: ${o}`})}}}var Wr=class{constructor(e,t){this.specificationVersion="v3";var n,r;this.modelId=e,this.config=t;const a=(n=t.errorStructure)!=null?n:X;this.chunkSchema=Xr(a.errorSchema),this.failedResponseHandler=K(a),this.supportsStructuredOutputs=(r=t.supportsStructuredOutputs)!=null?r:!1}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)==null?void 0:t.call(e))!=null?n:{}}transformRequestBody(e){var t,n,r;return(r=(n=(t=this.config).transformRequestBody)==null?void 0:n.call(t,e))!=null?r:e}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:a,frequencyPenalty:o,presencePenalty:s,providerOptions:l,stopSequences:u,responseFormat:i,seed:c,toolChoice:p,tools:d}){var v,_,m,g,k;const O=[],T=await H({provider:"openai-compatible",providerOptions:l,schema:re});T!=null&&O.push({type:"other",message:"The 'openai-compatible' key in providerOptions is deprecated. Use 'openaiCompatible' instead."});const A=Object.assign(T??{},(v=await H({provider:"openaiCompatible",providerOptions:l,schema:re}))!=null?v:{},(_=await H({provider:this.providerOptionsName,providerOptions:l,schema:re}))!=null?_:{}),x=(m=A?.strictJsonSchema)!=null?m:!0;a!=null&&O.push({type:"unsupported",feature:"topK"}),i?.type==="json"&&i.schema!=null&&!this.supportsStructuredOutputs&&O.push({type:"unsupported",feature:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{tools:S,toolChoice:M,toolWarnings:Y}=Jr({tools:d,toolChoice:p});return{args:{model:this.modelId,user:A.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,response_format:i?.type==="json"?this.supportsStructuredOutputs===!0&&i.schema!=null?{type:"json_schema",json_schema:{schema:i.schema,strict:x,name:(g=i.name)!=null?g:"response",description:i.description}}:{type:"json_object"}:void 0,stop:u,seed:c,...Object.fromEntries(Object.entries((k=l?.[this.providerOptionsName])!=null?k:{}).filter(([Q])=>!Object.keys(re.shape).includes(Q))),reasoning_effort:A.reasoningEffort,verbosity:A.textVerbosity,messages:zr(e),tools:S,tool_choice:M},warnings:[...O,...Y]}}async doGenerate(e){var t,n,r,a,o,s,l,u;const{args:i,warnings:c}=await this.getArgs({...e}),p=this.transformRequestBody(i),d=JSON.stringify(p),{responseHeaders:v,value:_,rawValue:m}=await z({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:V(this.config.headers(),e.headers),body:p,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:G(Kr),abortSignal:e.abortSignal,fetch:this.config.fetch}),g=_.choices[0],k=[],O=g.message.content;O!=null&&O.length>0&&k.push({type:"text",text:O});const T=(t=g.message.reasoning_content)!=null?t:g.message.reasoning;if(T!=null&&T.length>0&&k.push({type:"reasoning",text:T}),g.message.tool_calls!=null)for(const S of g.message.tool_calls){const M=(r=(n=S.extra_content)==null?void 0:n.google)==null?void 0:r.thought_signature;k.push({type:"tool-call",toolCallId:(a=S.id)!=null?a:ne(),toolName:S.function.name,input:S.function.arguments,...M?{providerMetadata:{[this.providerOptionsName]:{thoughtSignature:M}}}:{}})}const A={[this.providerOptionsName]:{},...await((s=(o=this.config.metadataExtractor)==null?void 0:o.extractMetadata)==null?void 0:s.call(o,{parsedBody:m}))},x=(l=_.usage)==null?void 0:l.completion_tokens_details;return x?.accepted_prediction_tokens!=null&&(A[this.providerOptionsName].acceptedPredictionTokens=x?.accepted_prediction_tokens),x?.rejected_prediction_tokens!=null&&(A[this.providerOptionsName].rejectedPredictionTokens=x?.rejected_prediction_tokens),{content:k,finishReason:{unified:ct(g.finish_reason),raw:(u=g.finish_reason)!=null?u:void 0},usage:lt(_.usage),providerMetadata:A,request:{body:d},response:{...ut(_),headers:v,body:m},warnings:c}}async doStream(e){var t;const{args:n,warnings:r}=await this.getArgs({...e}),a=this.transformRequestBody({...n,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0}),o=(t=this.config.metadataExtractor)==null?void 0:t.createStreamExtractor(),{responseHeaders:s,value:l}=await z({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:V(this.config.headers(),e.headers),body:a,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:tn(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=[];let i={unified:"other",raw:void 0},c,p=!0;const d=this.providerOptionsName;let v=!1,_=!1;return{stream:l.pipeThrough(new TransformStream({start(m){m.enqueue({type:"stream-start",warnings:r})},transform(m,g){var k,O,T,A,x,S,M,Y,Q,Se,Oe,Ae,xe,Te,Ce,Pe,Ie,Ee;if(e.includeRawChunks&&g.enqueue({type:"raw",rawValue:m.rawValue}),!m.success){i={unified:"error",raw:void 0},g.enqueue({type:"error",error:m.error});return}if(o?.processChunk(m.rawValue),"error"in m.value){i={unified:"error",raw:void 0},g.enqueue({type:"error",error:m.value.error.message});return}const ee=m.value;p&&(p=!1,g.enqueue({type:"response-metadata",...ut(ee)})),ee.usage!=null&&(c=ee.usage);const F=ee.choices[0];if(F?.finish_reason!=null&&(i={unified:ct(F.finish_reason),raw:(k=F.finish_reason)!=null?k:void 0}),F?.delta==null)return;const B=F.delta,$e=(O=B.reasoning_content)!=null?O:B.reasoning;if($e&&(v||(g.enqueue({type:"reasoning-start",id:"reasoning-0"}),v=!0),g.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:$e})),B.content&&(v&&(g.enqueue({type:"reasoning-end",id:"reasoning-0"}),v=!1),_||(g.enqueue({type:"text-start",id:"txt-0"}),_=!0),g.enqueue({type:"text-delta",id:"txt-0",delta:B.content})),B.tool_calls!=null){v&&(g.enqueue({type:"reasoning-end",id:"reasoning-0"}),v=!1);for(const P of B.tool_calls){const te=(T=P.index)!=null?T:u.length;if(u[te]==null){if(P.id==null)throw new Ze({data:P,message:"Expected 'id' to be a string."});if(((A=P.function)==null?void 0:A.name)==null)throw new Ze({data:P,message:"Expected 'function.name' to be a string."});g.enqueue({type:"tool-input-start",id:P.id,toolName:P.function.name}),u[te]={id:P.id,type:"function",function:{name:P.function.name,arguments:(x=P.function.arguments)!=null?x:""},hasFinished:!1,thoughtSignature:(Y=(M=(S=P.extra_content)==null?void 0:S.google)==null?void 0:M.thought_signature)!=null?Y:void 0};const E=u[te];((Q=E.function)==null?void 0:Q.name)!=null&&((Se=E.function)==null?void 0:Se.arguments)!=null&&(E.function.arguments.length>0&&g.enqueue({type:"tool-input-delta",id:E.id,delta:E.function.arguments}),st(E.function.arguments)&&(g.enqueue({type:"tool-input-end",id:E.id}),g.enqueue({type:"tool-call",toolCallId:(Oe=E.id)!=null?Oe:ne(),toolName:E.function.name,input:E.function.arguments,...E.thoughtSignature?{providerMetadata:{[d]:{thoughtSignature:E.thoughtSignature}}}:{}}),E.hasFinished=!0));continue}const I=u[te];I.hasFinished||(((Ae=P.function)==null?void 0:Ae.arguments)!=null&&(I.function.arguments+=(Te=(xe=P.function)==null?void 0:xe.arguments)!=null?Te:""),g.enqueue({type:"tool-input-delta",id:I.id,delta:(Ce=P.function.arguments)!=null?Ce:""}),((Pe=I.function)==null?void 0:Pe.name)!=null&&((Ie=I.function)==null?void 0:Ie.arguments)!=null&&st(I.function.arguments)&&(g.enqueue({type:"tool-input-end",id:I.id}),g.enqueue({type:"tool-call",toolCallId:(Ee=I.id)!=null?Ee:ne(),toolName:I.function.name,input:I.function.arguments,...I.thoughtSignature?{providerMetadata:{[d]:{thoughtSignature:I.thoughtSignature}}}:{}}),I.hasFinished=!0))}}},flush(m){var g,k,O,T,A;v&&m.enqueue({type:"reasoning-end",id:"reasoning-0"}),_&&m.enqueue({type:"text-end",id:"txt-0"});for(const S of u.filter(M=>!M.hasFinished))m.enqueue({type:"tool-input-end",id:S.id}),m.enqueue({type:"tool-call",toolCallId:(g=S.id)!=null?g:ne(),toolName:S.function.name,input:S.function.arguments,...S.thoughtSignature?{providerMetadata:{[d]:{thoughtSignature:S.thoughtSignature}}}:{}});const x={[d]:{},...o?.buildMetadata()};((k=c?.completion_tokens_details)==null?void 0:k.accepted_prediction_tokens)!=null&&(x[d].acceptedPredictionTokens=(O=c?.completion_tokens_details)==null?void 0:O.accepted_prediction_tokens),((T=c?.completion_tokens_details)==null?void 0:T.rejected_prediction_tokens)!=null&&(x[d].rejectedPredictionTokens=(A=c?.completion_tokens_details)==null?void 0:A.rejected_prediction_tokens),m.enqueue({type:"finish",finishReason:i,usage:lt(c),providerMetadata:x})}})),request:{body:a},response:{headers:s}}}},nn=y({prompt_tokens:w().nullish(),completion_tokens:w().nullish(),total_tokens:w().nullish(),prompt_tokens_details:y({cached_tokens:w().nullish()}).nullish(),completion_tokens_details:y({reasoning_tokens:w().nullish(),accepted_prediction_tokens:w().nullish(),rejected_prediction_tokens:w().nullish()}).nullish()}).nullish(),Kr=_t({id:h().nullish(),created:w().nullish(),model:h().nullish(),choices:U(y({message:y({role:pn("assistant").nullish(),content:h().nullish(),reasoning_content:h().nullish(),reasoning:h().nullish(),tool_calls:U(y({id:h().nullish(),function:y({name:h(),arguments:h()}),extra_content:y({google:y({thought_signature:h().nullish()}).nullish()}).nullish()})).nullish()}),finish_reason:h().nullish()})),usage:nn}),Gr=_t({id:h().nullish(),created:w().nullish(),model:h().nullish(),choices:U(y({delta:y({role:dn(["assistant"]).nullish(),content:h().nullish(),reasoning_content:h().nullish(),reasoning:h().nullish(),tool_calls:U(y({index:w().nullish(),id:h().nullish(),function:y({name:h().nullish(),arguments:h().nullish()}),extra_content:y({google:y({thought_signature:h().nullish()}).nullish()}).nullish()})).nullish()}).nullish(),finish_reason:h().nullish()})),usage:nn}),Xr=e=>_e([Gr,e]);function dt(e){var t,n;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const r=(t=e.prompt_tokens)!=null?t:0,a=(n=e.completion_tokens)!=null?n:0;return{inputTokens:{total:r,noCache:r,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:a,text:a,reasoning:void 0},raw:e}}function Yr({prompt:e,user:t="user",assistant:n="assistant"}){let r="";e[0].role==="system"&&(r+=`${e[0].content}

`,e=e.slice(1));for(const{role:a,content:o}of e)switch(a){case"system":throw new mn({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const s=o.map(l=>{switch(l.type){case"text":return l.text}}).filter(Boolean).join("");r+=`${t}:
${s}

`;break}case"assistant":{const s=o.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new q({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${s}

`;break}case"tool":throw new q({functionality:"tool messages"});default:{const s=a;throw new Error(`Unsupported role: ${s}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}function pt({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function ft(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var Qr=y({echo:kt().optional(),logitBias:fe(h(),w()).optional(),suffix:h().optional(),user:h().optional()}),ea=class{constructor(e,t){this.specificationVersion="v3";var n;this.modelId=e,this.config=t;const r=(n=t.errorStructure)!=null?n:X;this.chunkSchema=na(r.errorSchema),this.failedResponseHandler=K(r)}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)==null?void 0:t.call(e))!=null?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:l,responseFormat:u,seed:i,providerOptions:c,tools:p,toolChoice:d}){var v;const _=[],m=(v=await H({provider:this.providerOptionsName,providerOptions:c,schema:Qr}))!=null?v:{};a!=null&&_.push({type:"unsupported",feature:"topK"}),p?.length&&_.push({type:"unsupported",feature:"tools"}),d!=null&&_.push({type:"unsupported",feature:"toolChoice"}),u!=null&&u.type!=="text"&&_.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:g,stopSequences:k}=Yr({prompt:e}),O=[...k??[],...l??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,suffix:m.suffix,user:m.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,seed:i,...c?.[this.providerOptionsName],prompt:g,stop:O.length>0?O:void 0},warnings:_}}async doGenerate(e){const{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:a,rawValue:o}=await z({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:V(this.config.headers(),e.headers),body:t,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:G(ta),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=a.choices[0],l=[];return s.text!=null&&s.text.length>0&&l.push({type:"text",text:s.text}),{content:l,usage:dt(a.usage),finishReason:{unified:ft(s.finish_reason),raw:s.finish_reason},request:{body:t},response:{...pt(a),headers:r,body:o},warnings:n}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},{responseHeaders:a,value:o}=await z({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:V(this.config.headers(),e.headers),body:r,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:tn(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch});let s={unified:"other",raw:void 0},l,u=!0;return{stream:o.pipeThrough(new TransformStream({start(i){i.enqueue({type:"stream-start",warnings:n})},transform(i,c){var p;if(e.includeRawChunks&&c.enqueue({type:"raw",rawValue:i.rawValue}),!i.success){s={unified:"error",raw:void 0},c.enqueue({type:"error",error:i.error});return}const d=i.value;if("error"in d){s={unified:"error",raw:void 0},c.enqueue({type:"error",error:d.error});return}u&&(u=!1,c.enqueue({type:"response-metadata",...pt(d)}),c.enqueue({type:"text-start",id:"0"})),d.usage!=null&&(l=d.usage);const v=d.choices[0];v?.finish_reason!=null&&(s={unified:ft(v.finish_reason),raw:(p=v.finish_reason)!=null?p:void 0}),v?.text!=null&&c.enqueue({type:"text-delta",id:"0",delta:v.text})},flush(i){u||i.enqueue({type:"text-end",id:"0"}),i.enqueue({type:"finish",finishReason:s,usage:dt(l)})}})),request:{body:r},response:{headers:a}}}},rn=y({prompt_tokens:w(),completion_tokens:w(),total_tokens:w()}),ta=y({id:h().nullish(),created:w().nullish(),model:h().nullish(),choices:U(y({text:h(),finish_reason:h()})),usage:rn.nullish()}),na=e=>_e([y({id:h().nullish(),created:w().nullish(),model:h().nullish(),choices:U(y({text:h(),finish_reason:h().nullish(),index:w()})),usage:rn.nullish()}),e]),de=y({dimensions:w().optional(),user:h().optional()}),ra=class{constructor(e,t){this.specificationVersion="v3",this.modelId=e,this.config=t}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.config.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.config.supportsParallelCalls)!=null?e:!0}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var a,o,s;const l=[],u=await H({provider:"openai-compatible",providerOptions:r,schema:de});u!=null&&l.push({type:"other",message:"The 'openai-compatible' key in providerOptions is deprecated. Use 'openaiCompatible' instead."});const i=Object.assign(u??{},(a=await H({provider:"openaiCompatible",providerOptions:r,schema:de}))!=null?a:{},(o=await H({provider:this.providerOptionsName,providerOptions:r,schema:de}))!=null?o:{});if(e.length>this.maxEmbeddingsPerCall)throw new yn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:c,value:p,rawValue:d}=await z({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:V(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:i.dimensions,user:i.user},failedResponseHandler:K((s=this.config.errorStructure)!=null?s:X),successfulResponseHandler:G(aa),abortSignal:n,fetch:this.config.fetch});return{warnings:l,embeddings:p.data.map(v=>v.embedding),usage:p.usage?{tokens:p.usage.prompt_tokens}:void 0,providerMetadata:p.providerMetadata,response:{headers:c,body:d}}}},aa=y({data:U(y({embedding:U(w())})),usage:y({prompt_tokens:w()}).nullish(),providerMetadata:fe(h(),fe(h(),bt())).optional()}),oa=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxImagesPerCall=10}get provider(){return this.config.provider}get providerOptionsKey(){return this.config.provider.split(".")[0].trim()}getArgs(e){return{...e[this.providerOptionsKey],...e[ia(this.providerOptionsKey)]}}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:a,providerOptions:o,headers:s,abortSignal:l,files:u,mask:i}){var c,p,d,v,_;const m=[];r!=null&&m.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),a!=null&&m.push({type:"unsupported",feature:"seed"});const g=(d=(p=(c=this.config._internal)==null?void 0:c.currentDate)==null?void 0:p.call(c))!=null?d:new Date,k=this.getArgs(o);if(u!=null&&u.length>0){const{value:A,responseHeaders:x}=await qr({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:V(this.config.headers(),s),formData:En({model:this.modelId,prompt:e,image:await Promise.all(u.map(S=>mt(S))),mask:i!=null?await mt(i):void 0,n:t,size:n,...k}),failedResponseHandler:K((v=this.config.errorStructure)!=null?v:X),successfulResponseHandler:G(ht),abortSignal:l,fetch:this.config.fetch});return{images:A.data.map(S=>S.b64_json),warnings:m,response:{timestamp:g,modelId:this.modelId,headers:x}}}const{value:O,responseHeaders:T}=await z({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:V(this.config.headers(),s),body:{model:this.modelId,prompt:e,n:t,size:n,...k,response_format:"b64_json"},failedResponseHandler:K((_=this.config.errorStructure)!=null?_:X),successfulResponseHandler:G(ht),abortSignal:l,fetch:this.config.fetch});return{images:O.data.map(A=>A.b64_json),warnings:m,response:{timestamp:g,modelId:this.modelId,headers:T}}}},ht=y({data:U(y({b64_json:h()}))});async function mt(e){if(e.type==="url")return Rn(e.url);const t=e.data instanceof Uint8Array?e.data:Pn(e.data);return new Blob([t],{type:e.mediaType})}function ia(e){return e.replace(/[_-]([a-z])/g,t=>t[1].toUpperCase())}var sa="2.0.21";function la(e){const t=Hr(e.baseURL),n=e.name,r={...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`},...e.headers},a=()=>Wt(r,`ai-sdk/openai-compatible/${sa}`),o=d=>({provider:`${n}.${d}`,url:({path:v})=>{const _=new URL(`${t}${v}`);return e.queryParams&&(_.search=new URLSearchParams(e.queryParams).toString()),_.toString()},headers:a,fetch:e.fetch}),s=d=>l(d),l=d=>new Wr(d,{...o("chat"),includeUsage:e.includeUsage,supportsStructuredOutputs:e.supportsStructuredOutputs,transformRequestBody:e.transformRequestBody,metadataExtractor:e.metadataExtractor}),u=d=>new ea(d,{...o("completion"),includeUsage:e.includeUsage}),i=d=>new ra(d,{...o("embedding")}),c=d=>new oa(d,o("image")),p=d=>s(d);return p.specificationVersion="v3",p.languageModel=s,p.chatModel=l,p.completionModel=u,p.embeddingModel=i,p.textEmbeddingModel=i,p.imageModel=c,p}var ua={};function an(){return(void 0)(),(void 0)((void 0)(),".config","github-copilot")}function pe(e){try{if(!(void 0)(e))return null;const t=(void 0)(e,"utf-8");return JSON.parse(t)}catch{return null}}function ca(e,t="github.com"){const n=[];for(const[a,o]of Object.entries(e))if((a===t||a.startsWith(`${t}:`))&&typeof o=="object"&&o!==null){const s=o;typeof s.oauth_token=="string"&&n.push({token:s.oauth_token,isOAuth:s.oauth_token.startsWith("gho_")})}const r=n.find(a=>a.isOAuth);return r?r.token:n.length>0?n[0].token:null}function da(e,t="github.com"){const n=e[t];if(typeof n=="object"&&n!==null){const r=n;if(typeof r.oauth_token=="string")return r.oauth_token}for(const r of Object.keys(e))if(r.startsWith(`${t}:`)){const a=e[r];if(typeof a=="string"&&(a.startsWith("gho_")||a.startsWith("ghu_")))return a}return null}var on=(void 0)((void 0)(),".ai-sdk-github-auth.json");function pa(e){try{const t={oauth_token:e,updated_at:new Date().toISOString()};(void 0)(on,JSON.stringify(t,null,2),{mode:384})}catch{}}function fa(e="github.com"){const t=an(),n=(void 0)(t,"apps.json"),r=pe(n);if(r){const l=ca(r,e);if(l)return l}const a=(void 0)(t,"hosts.json"),o=pe(a);if(o){const l=da(o,e);if(l)return l}const s=pe(on);return s?.oauth_token?s.oauth_token:null}function _a(){const e=an();return{appsJson:(void 0)(e,"apps.json"),hostsJson:(void 0)(e,"hosts.json")}}var gt="Iv1.b507a08c87ecfe98",vt={"User-Agent":"GitHubCopilotChat/0.32.4","Editor-Version":"vscode/1.105.1","Editor-Plugin-Version":"copilot-chat/0.32.4","Copilot-Integration-Id":"vscode-chat"},ha=300*1e3;function ma(e){return e.replace(/^https?:\/\//,"").replace(/\/$/,"")}function yt(e){return{deviceCodeUrl:`https://${e}/login/device/code`,accessTokenUrl:`https://${e}/login/oauth/access_token`,copilotTokenUrl:`https://api.${e}/copilot_internal/v2/token`}}var sn=class{oauthToken=null;cachedToken=null;domain;debug;constructor(e={}){this.debug=e.debug??!1,this.domain=e.enterpriseUrl?ma(e.enterpriseUrl):"github.com",e.oauthToken?(this.oauthToken=e.oauthToken,this.log("Using provided OAuth token")):(this.oauthToken=fa(this.domain),this.oauthToken?this.log("Found OAuth token in CLI config"):this.log("No OAuth token found in CLI config"))}log(e){this.debug&&console.log(`[CopilotAuth] ${e}`)}hasOAuthToken(){return this.oauthToken!==null}async getValidToken(){if(this.cachedToken&&this.cachedToken.expiresAt>Date.now()+ha)return this.log("Using cached Copilot token"),this.cachedToken.token;if(!this.oauthToken)throw new Error("No OAuth token available. Run initiateDeviceFlow() first or provide an oauthToken in options.");this.log("Exchanging OAuth token for Copilot token...");const e=yt(this.domain),t=await fetch(e.copilotTokenUrl,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${this.oauthToken}`,...vt}});if(!t.ok){const r=await t.text();throw new Error(`Token exchange failed (${t.status}): ${r}`)}const n=await t.json();return this.cachedToken={token:n.token,expiresAt:n.expires_at*1e3},this.log(`Copilot token obtained, expires at ${new Date(this.cachedToken.expiresAt).toISOString()}`),this.cachedToken.token}async initiateDeviceFlow(){const e=yt(this.domain);this.log("Initiating device flow...");const t=await fetch(e.deviceCodeUrl,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GitHubCopilotChat/0.35.0"},body:JSON.stringify({client_id:gt,scope:"read:user"})});if(!t.ok){const r=await t.text();throw new Error(`Device flow initiation failed (${t.status}): ${r}`)}const n=await t.json();return this.log(`Device flow initiated. User code: ${n.user_code}`),{verificationUri:n.verification_uri,userCode:n.user_code,pollForToken:async()=>this.pollDeviceFlow(n.device_code,n.interval,e.accessTokenUrl)}}async pollDeviceFlow(e,t,n){for(;;){const r=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GitHubCopilotChat/0.35.0"},body:JSON.stringify({client_id:gt,device_code:e,grant_type:"urn:ietf:params:oauth:grant-type:device_code"})});if(!r.ok)return this.log("Device flow polling failed"),!1;const a=await r.json();if(a.access_token)return this.oauthToken=a.access_token,pa(a.access_token),this.log("Device flow completed successfully and token saved."),!0;if(a.error==="authorization_pending"){await new Promise(o=>setTimeout(o,t*1e3));continue}if(a.error)return this.log(`Device flow error: ${a.error} - ${a.error_description}`),!1;await new Promise(o=>setTimeout(o,t*1e3))}}getCopilotHeaders(){return{...vt}}};function ye(e={}){const t=new sn(e),n=e.debug??!1,r=e.baseURL??(e.enterpriseUrl?`https://copilot-api.${e.enterpriseUrl.replace(/^https?:\/\//,"").replace(/\/$/,"")}`:"https://api.githubcopilot.com");return la({name:"github-copilot",baseURL:r,headers:e.headers,fetch:async(o,s)=>{let l=o.toString(),u=!1,i=typeof s?.body=="string"?s.body:"";if((i.includes('"model":"gpt-5-codex')||i.includes("codex"))&&(u=!0),u?l.endsWith("/responses")||(l=l.replace(/\/chat\/completions$/,"/responses")):l.endsWith("/responses")&&(l=l.replace("/responses","/chat/completions")),i&&!u)try{const m=JSON.parse(i);if(m.tools&&Array.isArray(m.tools)){let g=!1;for(const k of m.tools)k.function&&k.function.parameters&&!k.function.parameters.type&&(k.function.parameters.type="object",g=!0);g&&(s={...s,body:JSON.stringify(m)})}}catch{}const c=await t.getValidToken(),p=t.getCopilotHeaders(),d=s?.headers||{},v=Object.fromEntries(Object.entries(d).filter(([m])=>m.toLowerCase()!=="authorization"&&m.toLowerCase()!=="api-key")),_={...p,...v,Authorization:`Bearer ${c}`,"Openai-Intent":"conversation-edits","X-Initiator":"agent"};return delete _["x-api-key"],(n||ua.DEBUG_PROVIDER)&&(console.log(`[CopilotFetch] URL: ${l}`),console.log(`[CopilotFetch] Token: ${c.substring(0,10)}...`)),fetch(l,{...s,headers:_})}})}async function ba(e={}){const t=new sn(e);if(t.hasOAuthToken())return{provider:ye(e),verificationUri:"",userCode:"",waitForAuth:async()=>!0};const{verificationUri:n,userCode:r,pollForToken:a}=await t.initiateDeviceFlow(),o=()=>ye(e);let s=null;return{provider:new Proxy(function(){},{apply:(u,i,c)=>(s||(s=o()),s(...c)),get:(u,i)=>(s||(s=o()),s[i])}),verificationUri:n,userCode:r,waitForAuth:a}}var ka=ye;export{sn as AuthManager,ye as createCopilot,ba as createCopilotWithDeviceFlow,ka as default,_a as getConfigPaths,fa as readCliToken};
//# sourceMappingURL=index-Cu1c-UE2.js.map
