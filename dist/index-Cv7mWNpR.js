import{O as de}from"./index-DWUDNqdD.js";import{c as D,w as _e,N as he,s as U,g as ne,a as me,z as j,p as ie,b as W,d as L,j as re,k as le,h as ge,n as fe,U as Q,q as ye,v as oe}from"./index-DVzO2118.js";import{o as t,a as b,s as e,n as a,b as Z,c as M,e as $,_ as F,l as c,d as ue}from"./main-B2AV-kr0.js";import"./__vite-browser-external-2447137e-qv044l9q.js";function xe(n){const d=[],y=[];for(const{role:u,content:i}of n)switch(u){case"system":{d.push({role:"system",content:i});break}case"user":{if(i.length===1&&i[0].type==="text"){d.push({role:"user",content:i[0].text});break}d.push({role:"user",content:i.map(l=>{switch(l.type){case"text":return{type:"text",text:l.text};case"file":if(l.mediaType.startsWith("image/")){const h=l.mediaType==="image/*"?"image/jpeg":l.mediaType;return{type:"image_url",image_url:{url:l.data instanceof URL?l.data.toString():`data:${h};base64,${fe(l.data)}`}}}else throw new Q({functionality:`file part media type ${l.mediaType}`})}})});break}case"assistant":{let l="";const h=[];for(const o of i)switch(o.type){case"text":{l+=o.text;break}case"tool-call":{h.push({id:o.toolCallId,type:"function",function:{name:o.toolName,arguments:JSON.stringify(o.input)}});break}}d.push({role:"assistant",content:l,tool_calls:h.length>0?h:void 0});break}case"tool":{for(const l of i){const h=l.output;let o;switch(h.type){case"text":case"error-text":o=h.value;break;case"content":case"json":case"error-json":o=JSON.stringify(h.value);break}d.push({role:"tool",tool_call_id:l.toolCallId,content:o})}break}default:{const l=u;throw new Error(`Unsupported role: ${l}`)}}return{messages:d,warnings:y}}function J({id:n,model:d,created:y,created_at:u}){const i=y??u;return{id:n??void 0,modelId:d??void 0,timestamp:i!=null?new Date(i*1e3):void 0}}function se(n){switch(n){case"stop":return"stop";case"length":return"length";case"tool_calls":case"function_call":return"tool-calls";case"content_filter":return"content-filter";default:return"unknown"}}var ve=t({type:c("web"),country:e().length(2).optional(),excludedWebsites:b(e()).max(5).optional(),allowedWebsites:b(e()).max(5).optional(),safeSearch:$().optional()}),be=t({type:c("x"),excludedXHandles:b(e()).optional(),includedXHandles:b(e()).optional(),postFavoriteCount:a().int().optional(),postViewCount:a().int().optional(),xHandles:b(e()).optional()}),we=t({type:c("news"),country:e().length(2).optional(),excludedWebsites:b(e()).max(5).optional(),safeSearch:$().optional()}),ke=t({type:c("rss"),links:b(e().url()).max(1)}),Se=ue("type",[ve,be,we,ke]),Te=t({reasoningEffort:F(["low","high"]).optional(),parallel_function_calling:$().optional(),searchParameters:t({mode:F(["off","auto","on"]),returnCitations:$().optional(),fromDate:e().optional(),toDate:e().optional(),maxSearchResults:a().min(1).max(50).optional(),sources:b(Se).optional()}).optional()}),ce=t({error:t({message:e(),type:e().nullish(),param:M().nullish(),code:Z([e(),a()]).nullish()})}),z=ye({errorSchema:ce,errorToMessage:n=>n.error.message});function Ie({tools:n,toolChoice:d}){n=n?.length?n:void 0;const y=[];if(n==null)return{tools:void 0,toolChoice:void 0,toolWarnings:y};const u=[];for(const l of n)l.type==="provider-defined"?y.push({type:"unsupported-tool",tool:l}):u.push({type:"function",function:{name:l.name,description:l.description,parameters:l.inputSchema}});if(d==null)return{tools:u,toolChoice:void 0,toolWarnings:y};const i=d.type;switch(i){case"auto":case"none":return{tools:u,toolChoice:i,toolWarnings:y};case"required":return{tools:u,toolChoice:"required",toolWarnings:y};case"tool":return{tools:u,toolChoice:{type:"function",function:{name:d.toolName}},toolWarnings:y};default:{const l=i;throw new Q({functionality:`tool choice type: ${l}`})}}}var Ce=class{constructor(n,d){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=n,this.config=d}get provider(){return this.config.provider}async getArgs({prompt:n,maxOutputTokens:d,temperature:y,topP:u,topK:i,frequencyPenalty:l,presencePenalty:h,stopSequences:o,seed:r,responseFormat:_,providerOptions:I,tools:v,toolChoice:R}){var g,x,C;const S=[],p=(g=await ie({provider:"xai",providerOptions:I,schema:Te}))!=null?g:{};i!=null&&S.push({type:"unsupported-setting",setting:"topK"}),l!=null&&S.push({type:"unsupported-setting",setting:"frequencyPenalty"}),h!=null&&S.push({type:"unsupported-setting",setting:"presencePenalty"}),o!=null&&S.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:A,warnings:q}=xe(n);S.push(...q);const{tools:f,toolChoice:w,toolWarnings:N}=Ie({tools:v,toolChoice:R});return S.push(...N),{args:{model:this.modelId,max_tokens:d,temperature:y,top_p:u,seed:r,reasoning_effort:p.reasoningEffort,parallel_function_calling:p.parallel_function_calling,response_format:_?.type==="json"?_.schema!=null?{type:"json_schema",json_schema:{name:(x=_.name)!=null?x:"response",schema:_.schema,strict:!0}}:{type:"json_object"}:void 0,search_parameters:p.searchParameters?{mode:p.searchParameters.mode,return_citations:p.searchParameters.returnCitations,from_date:p.searchParameters.fromDate,to_date:p.searchParameters.toDate,max_search_results:p.searchParameters.maxSearchResults,sources:(C=p.searchParameters.sources)==null?void 0:C.map(m=>{var E;return{type:m.type,...m.type==="web"&&{country:m.country,excluded_websites:m.excludedWebsites,allowed_websites:m.allowedWebsites,safe_search:m.safeSearch},...m.type==="x"&&{excluded_x_handles:m.excludedXHandles,included_x_handles:(E=m.includedXHandles)!=null?E:m.xHandles,post_favorite_count:m.postFavoriteCount,post_view_count:m.postViewCount},...m.type==="news"&&{country:m.country,excluded_websites:m.excludedWebsites,safe_search:m.safeSearch},...m.type==="rss"&&{links:m.links}}})}:void 0,messages:A,tools:f,tool_choice:w},warnings:S}}async doGenerate(n){var d,y,u,i,l;const{args:h,warnings:o}=await this.getArgs(n),{responseHeaders:r,value:_,rawValue:I}=await W({url:`${(d=this.config.baseURL)!=null?d:"https://api.x.ai/v1"}/chat/completions`,headers:L(this.config.headers(),n.headers),body:h,failedResponseHandler:z,successfulResponseHandler:re(qe),abortSignal:n.abortSignal,fetch:this.config.fetch}),v=_.choices[0],R=[];if(v.message.content!=null&&v.message.content.length>0){let g=v.message.content;const x=h.messages[h.messages.length-1];x?.role==="assistant"&&g===x.content&&(g=""),g.length>0&&R.push({type:"text",text:g})}if(v.message.reasoning_content!=null&&v.message.reasoning_content.length>0&&R.push({type:"reasoning",text:v.message.reasoning_content}),v.message.tool_calls!=null)for(const g of v.message.tool_calls)R.push({type:"tool-call",toolCallId:g.id,toolName:g.function.name,input:g.function.arguments});if(_.citations!=null)for(const g of _.citations)R.push({type:"source",sourceType:"url",id:this.config.generateId(),url:g});return{content:R,finishReason:se(v.finish_reason),usage:{inputTokens:_.usage.prompt_tokens,outputTokens:_.usage.completion_tokens,totalTokens:_.usage.total_tokens,reasoningTokens:(u=(y=_.usage.completion_tokens_details)==null?void 0:y.reasoning_tokens)!=null?u:void 0,cachedInputTokens:(l=(i=_.usage.prompt_tokens_details)==null?void 0:i.cached_tokens)!=null?l:void 0},request:{body:h},response:{...J(_),headers:r,body:I},warnings:o}}async doStream(n){var d;const{args:y,warnings:u}=await this.getArgs(n),i={...y,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:l,value:h}=await W({url:`${(d=this.config.baseURL)!=null?d:"https://api.x.ai/v1"}/chat/completions`,headers:L(this.config.headers(),n.headers),body:i,failedResponseHandler:z,successfulResponseHandler:le(Re),abortSignal:n.abortSignal,fetch:this.config.fetch});let o="unknown";const r={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0};let _=!0;const I={},v={},R=this;return{stream:h.pipeThrough(new TransformStream({start(g){g.enqueue({type:"stream-start",warnings:u})},transform(g,x){var C,S,p,A;if(n.includeRawChunks&&x.enqueue({type:"raw",rawValue:g.rawValue}),!g.success){x.enqueue({type:"error",error:g.error});return}const q=g.value;if(_&&(x.enqueue({type:"response-metadata",...J(q)}),_=!1),q.citations!=null)for(const k of q.citations)x.enqueue({type:"source",sourceType:"url",id:R.config.generateId(),url:k});q.usage!=null&&(r.inputTokens=q.usage.prompt_tokens,r.outputTokens=q.usage.completion_tokens,r.totalTokens=q.usage.total_tokens,r.reasoningTokens=(S=(C=q.usage.completion_tokens_details)==null?void 0:C.reasoning_tokens)!=null?S:void 0,r.cachedInputTokens=(A=(p=q.usage.prompt_tokens_details)==null?void 0:p.cached_tokens)!=null?A:void 0);const f=q.choices[0];if(f?.finish_reason!=null&&(o=se(f.finish_reason)),f?.delta==null)return;const w=f.delta,N=f.index;if(w.content!=null&&w.content.length>0){const k=w.content,m=i.messages[i.messages.length-1];if(m?.role==="assistant"&&k===m.content)return;const E=`text-${q.id||N}`;I[E]==null&&(I[E]={type:"text"},x.enqueue({type:"text-start",id:E})),x.enqueue({type:"text-delta",id:E,delta:k})}if(w.reasoning_content!=null&&w.reasoning_content.length>0){const k=`reasoning-${q.id||N}`;if(v[k]===w.reasoning_content)return;v[k]=w.reasoning_content,I[k]==null&&(I[k]={type:"reasoning"},x.enqueue({type:"reasoning-start",id:k})),x.enqueue({type:"reasoning-delta",id:k,delta:w.reasoning_content})}if(w.tool_calls!=null)for(const k of w.tool_calls){const m=k.id;x.enqueue({type:"tool-input-start",id:m,toolName:k.function.name}),x.enqueue({type:"tool-input-delta",id:m,delta:k.function.arguments}),x.enqueue({type:"tool-input-end",id:m}),x.enqueue({type:"tool-call",toolCallId:m,toolName:k.function.name,input:k.function.arguments})}},flush(g){for(const[x,C]of Object.entries(I))g.enqueue({type:C.type==="text"?"text-end":"reasoning-end",id:x});g.enqueue({type:"finish",finishReason:o,usage:r})}})),request:{body:i},response:{headers:l}}}},pe=t({prompt_tokens:a(),completion_tokens:a(),total_tokens:a(),prompt_tokens_details:t({text_tokens:a().nullish(),audio_tokens:a().nullish(),image_tokens:a().nullish(),cached_tokens:a().nullish()}).nullish(),completion_tokens_details:t({reasoning_tokens:a().nullish(),audio_tokens:a().nullish(),accepted_prediction_tokens:a().nullish(),rejected_prediction_tokens:a().nullish()}).nullish()}),qe=t({id:e().nullish(),created:a().nullish(),model:e().nullish(),choices:b(t({message:t({role:c("assistant"),content:e().nullish(),reasoning_content:e().nullish(),tool_calls:b(t({id:e(),type:c("function"),function:t({name:e(),arguments:e()})})).nullish()}),index:a(),finish_reason:e().nullish()})),object:c("chat.completion"),usage:pe,citations:b(e().url()).nullish()}),Re=t({id:e().nullish(),created:a().nullish(),model:e().nullish(),choices:b(t({delta:t({role:F(["assistant"]).optional(),content:e().nullish(),reasoning_content:e().nullish(),tool_calls:b(t({id:e(),type:c("function"),function:t({name:e(),arguments:e()})})).nullish()}),finish_reason:e().nullish(),index:a()})),usage:pe.nullish(),citations:b(e().url()).nullish()}),B=Z([t({type:c("url_citation"),url:e(),title:e().optional()}),t({type:e()})]),K=t({type:e(),text:e().optional(),logprobs:b(M()).optional(),annotations:b(B).optional()}),G=t({type:e(),text:e()}),O=t({name:e().optional(),arguments:e().optional(),input:e().optional(),call_id:e().optional(),id:e(),status:e(),action:M().optional()}),Y=ue("type",[t({type:c("web_search_call"),...O.shape}),t({type:c("x_search_call"),...O.shape}),t({type:c("code_interpreter_call"),...O.shape}),t({type:c("code_execution_call"),...O.shape}),t({type:c("view_image_call"),...O.shape}),t({type:c("view_x_video_call"),...O.shape}),t({type:c("custom_tool_call"),...O.shape}),t({type:c("message"),role:e(),content:b(K),id:e(),status:e()}),t({type:c("function_call"),name:e(),arguments:e(),call_id:e(),id:e()}),t({type:c("reasoning"),id:e(),summary:b(G),status:e()})]),Ne=t({input_tokens:a(),output_tokens:a(),total_tokens:a().optional(),input_tokens_details:t({cached_tokens:a().optional()}).optional(),output_tokens_details:t({reasoning_tokens:a().optional()}).optional(),num_sources_used:a().optional(),num_server_side_tools_used:a().optional()}),X=t({id:e().nullish(),created_at:a().nullish(),model:e().nullish(),object:c("response"),output:b(Y),usage:Ne,status:e()}),Ae=Z([t({type:c("response.created"),response:X.partial({usage:!0,status:!0})}),t({type:c("response.in_progress"),response:X.partial({usage:!0,status:!0})}),t({type:c("response.output_item.added"),item:Y,output_index:a()}),t({type:c("response.output_item.done"),item:Y,output_index:a()}),t({type:c("response.content_part.added"),item_id:e(),output_index:a(),content_index:a(),part:K}),t({type:c("response.content_part.done"),item_id:e(),output_index:a(),content_index:a(),part:K}),t({type:c("response.output_text.delta"),item_id:e(),output_index:a(),content_index:a(),delta:e(),logprobs:b(M()).optional()}),t({type:c("response.output_text.done"),item_id:e(),output_index:a(),content_index:a(),text:e(),logprobs:b(M()).optional(),annotations:b(B).optional()}),t({type:c("response.output_text.annotation.added"),item_id:e(),output_index:a(),content_index:a(),annotation_index:a(),annotation:B}),t({type:c("response.reasoning_summary_part.added"),item_id:e(),output_index:a(),summary_index:a(),part:G}),t({type:c("response.reasoning_summary_part.done"),item_id:e(),output_index:a(),summary_index:a(),part:G}),t({type:c("response.reasoning_summary_text.delta"),item_id:e(),output_index:a(),summary_index:a(),delta:e()}),t({type:c("response.reasoning_summary_text.done"),item_id:e(),output_index:a(),summary_index:a(),text:e()}),t({type:c("response.web_search_call.in_progress"),item_id:e(),output_index:a()}),t({type:c("response.web_search_call.searching"),item_id:e(),output_index:a()}),t({type:c("response.web_search_call.completed"),item_id:e(),output_index:a()}),t({type:c("response.x_search_call.in_progress"),item_id:e(),output_index:a()}),t({type:c("response.x_search_call.searching"),item_id:e(),output_index:a()}),t({type:c("response.x_search_call.completed"),item_id:e(),output_index:a()}),t({type:c("response.code_execution_call.in_progress"),item_id:e(),output_index:a()}),t({type:c("response.code_execution_call.executing"),item_id:e(),output_index:a()}),t({type:c("response.code_execution_call.completed"),item_id:e(),output_index:a()}),t({type:c("response.code_interpreter_call.in_progress"),item_id:e(),output_index:a()}),t({type:c("response.code_interpreter_call.executing"),item_id:e(),output_index:a()}),t({type:c("response.code_interpreter_call.completed"),item_id:e(),output_index:a()}),t({type:c("response.done"),response:X}),t({type:c("response.completed"),response:X})]);function ae(n){switch(n){case"stop":case"completed":return"stop";case"length":return"length";case"tool_calls":case"function_call":return"tool-calls";case"content_filter":return"content-filter";default:return"unknown"}}var He=t({reasoningEffort:F(["low","medium","high"]).optional(),store:$().optional(),previousResponseId:e().optional()});async function Ee({prompt:n}){var d,y,u,i;const l=[],h=[];for(const o of n)switch(o.role){case"system":{l.push({role:"system",content:o.content});break}case"user":{let r="";for(const _ of o.content)switch(_.type){case"text":{r+=_.text;break}case"file":{h.push({type:"other",message:`xAI Responses API does not support ${_.type} in user messages`});break}default:h.push({type:"other",message:"xAI Responses API does not support this content type in user messages"})}l.push({role:"user",content:r});break}case"assistant":{for(const r of o.content)switch(r.type){case"text":{const _=typeof((y=(d=r.providerOptions)==null?void 0:d.xai)==null?void 0:y.itemId)=="string"?r.providerOptions.xai.itemId:void 0;l.push({role:"assistant",content:r.text,id:_});break}case"tool-call":{if(r.providerExecuted)break;const _=typeof((i=(u=r.providerOptions)==null?void 0:u.xai)==null?void 0:i.itemId)=="string"?r.providerOptions.xai.itemId:void 0;l.push({type:"function_call",id:_??r.toolCallId,call_id:r.toolCallId,name:r.toolName,arguments:JSON.stringify(r.input),status:"completed"});break}case"tool-result":break;case"reasoning":case"file":{h.push({type:"other",message:`xAI Responses API does not support ${r.type} in assistant messages`});break}default:h.push({type:"other",message:"xAI Responses API does not support this content type in assistant messages"})}break}case"tool":{for(const r of o.content){const _=r.output;let I;switch(_.type){case"text":case"error-text":I=_.value;break;case"json":case"error-json":I=JSON.stringify(_.value);break;case"content":I=_.value.map(v=>v.type==="text"?v.text:"").join("");break;default:I=""}l.push({type:"function_call_output",call_id:r.toolCallId,output:I})}break}default:h.push({type:"other",message:"unsupported message role"})}return{input:l,inputWarnings:h}}var $e=U(()=>j(t({allowedDomains:b(e()).max(5).optional(),excludedDomains:b(e()).max(5).optional(),enableImageUnderstanding:$().optional()}))),Pe=U(()=>j(t({query:e(),sources:b(t({title:e(),url:e(),snippet:e()}))}))),Oe=D({id:"xai.web_search",name:"web_search",inputSchema:U(()=>j(t({}))),outputSchema:Pe}),Ue=(n={})=>Oe(n),je=U(()=>j(t({allowedXHandles:b(e()).max(10).optional(),excludedXHandles:b(e()).max(10).optional(),fromDate:e().optional(),toDate:e().optional(),enableImageUnderstanding:$().optional(),enableVideoUnderstanding:$().optional()}))),Ve=U(()=>j(t({query:e(),posts:b(t({author:e(),text:e(),url:e(),likes:a()}))}))),Xe=D({id:"xai.x_search",name:"x_search",inputSchema:U(()=>j(t({}))),outputSchema:Ve}),Me=(n={})=>Xe(n);async function De({tools:n,toolChoice:d}){const y=n?.length?n:void 0,u=[];if(y==null)return{tools:void 0,toolChoice:void 0,toolWarnings:u};const i=[],l=new Map;for(const o of y)if(l.set(o.name,o),o.type==="provider-defined")switch(o.id){case"xai.web_search":{const r=await oe({value:o.args,schema:$e});i.push({type:"web_search",allowed_domains:r.allowedDomains,excluded_domains:r.excludedDomains,enable_image_understanding:r.enableImageUnderstanding});break}case"xai.x_search":{const r=await oe({value:o.args,schema:je});i.push({type:"x_search",allowed_x_handles:r.allowedXHandles,excluded_x_handles:r.excludedXHandles,from_date:r.fromDate,to_date:r.toDate,enable_image_understanding:r.enableImageUnderstanding,enable_video_understanding:r.enableVideoUnderstanding});break}case"xai.code_execution":{i.push({type:"code_interpreter"});break}case"xai.view_image":{i.push({type:"view_image"});break}case"xai.view_x_video":{i.push({type:"view_x_video"});break}case"xai.file_search":{i.push({type:"file_search"});break}case"xai.mcp":{i.push({type:"mcp"});break}default:{u.push({type:"unsupported-tool",tool:o});break}}else i.push({type:"function",function:{name:o.name,description:o.description,parameters:o.inputSchema}});if(d==null)return{tools:i,toolChoice:void 0,toolWarnings:u};const h=d.type;switch(h){case"auto":case"none":return{tools:i,toolChoice:h,toolWarnings:u};case"required":return{tools:i,toolChoice:"required",toolWarnings:u};case"tool":{const o=l.get(d.toolName);if(o==null)return{tools:i,toolChoice:void 0,toolWarnings:u};if(o.type==="provider-defined")switch(o.id){case"xai.web_search":return{tools:i,toolChoice:{type:"web_search"},toolWarnings:u};case"xai.x_search":return{tools:i,toolChoice:{type:"x_search"},toolWarnings:u};case"xai.code_execution":return{tools:i,toolChoice:{type:"code_interpreter"},toolWarnings:u};case"xai.view_image":return{tools:i,toolChoice:{type:"view_image"},toolWarnings:u};case"xai.view_x_video":return{tools:i,toolChoice:{type:"view_x_video"},toolWarnings:u};case"xai.file_search":return{tools:i,toolChoice:{type:"file_search"},toolWarnings:u};case"xai.mcp":return{tools:i,toolChoice:{type:"mcp"},toolWarnings:u};default:return u.push({type:"unsupported-tool",tool:o}),{tools:i,toolChoice:void 0,toolWarnings:u}}return{tools:i,toolChoice:{type:"function",name:o.name},toolWarnings:u}}default:{const o=h;throw new Q({functionality:`tool choice type: ${o}`})}}}var We=class{constructor(n,d){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=n,this.config=d}get provider(){return this.config.provider}async getArgs({prompt:n,maxOutputTokens:d,temperature:y,topP:u,stopSequences:i,seed:l,providerOptions:h,tools:o,toolChoice:r}){var _,I,v,R;const g=[],x=(_=await ie({provider:"xai",providerOptions:h,schema:He}))!=null?_:{};i!=null&&g.push({type:"unsupported-setting",setting:"stopSequences"});const C=(I=o?.find(m=>m.type==="provider-defined"&&m.id==="xai.web_search"))==null?void 0:I.name,S=(v=o?.find(m=>m.type==="provider-defined"&&m.id==="xai.x_search"))==null?void 0:v.name,p=(R=o?.find(m=>m.type==="provider-defined"&&m.id==="xai.code_execution"))==null?void 0:R.name,{input:A,inputWarnings:q}=await Ee({prompt:n});g.push(...q);const{tools:f,toolChoice:w,toolWarnings:N}=await De({tools:o,toolChoice:r});g.push(...N);const k={model:this.modelId,input:A,max_tokens:d,temperature:y,top_p:u,seed:l,...x.reasoningEffort!=null&&{reasoning:{effort:x.reasoningEffort}},...x.store===!1&&{store:x.store,include:["reasoning.encrypted_content"]},...x.previousResponseId!=null&&{previous_response_id:x.previousResponseId}};return f&&f.length>0&&(k.tools=f),w!=null&&(k.tool_choice=w),{args:k,warnings:g,webSearchToolName:C,xSearchToolName:S,codeExecutionToolName:p}}async doGenerate(n){var d,y,u,i,l,h,o,r;const{args:_,warnings:I,webSearchToolName:v,xSearchToolName:R,codeExecutionToolName:g}=await this.getArgs(n),{responseHeaders:x,value:C,rawValue:S}=await W({url:`${(d=this.config.baseURL)!=null?d:"https://api.x.ai/v1"}/responses`,headers:L(this.config.headers(),n.headers),body:_,failedResponseHandler:z,successfulResponseHandler:re(X),abortSignal:n.abortSignal,fetch:this.config.fetch}),p=[],A=["web_search","web_search_with_snippets","browse_page"],q=["x_user_search","x_keyword_search","x_semantic_search","x_thread_fetch"];for(const f of C.output){if(f.type==="web_search_call"||f.type==="x_search_call"||f.type==="code_interpreter_call"||f.type==="code_execution_call"||f.type==="view_image_call"||f.type==="view_x_video_call"||f.type==="custom_tool_call"){let w=(y=f.name)!=null?y:"";A.includes((u=f.name)!=null?u:"")?w=v??"web_search":q.includes((i=f.name)!=null?i:"")?w=R??"x_search":f.name==="code_execution"&&(w=g??"code_execution");const N=f.type==="custom_tool_call"?(l=f.input)!=null?l:"":(h=f.arguments)!=null?h:"";p.push({type:"tool-call",toolCallId:f.id,toolName:w,input:N,providerExecuted:!0});continue}switch(f.type){case"message":{for(const w of f.content)if(w.text&&p.push({type:"text",text:w.text}),w.annotations)for(const N of w.annotations)N.type==="url_citation"&&"url"in N&&p.push({type:"source",sourceType:"url",id:this.config.generateId(),url:N.url,title:(o=N.title)!=null?o:N.url});break}case"function_call":{p.push({type:"tool-call",toolCallId:f.call_id,toolName:f.name,input:f.arguments});break}}}return{content:p,finishReason:ae(C.status),usage:{inputTokens:C.usage.input_tokens,outputTokens:C.usage.output_tokens,totalTokens:C.usage.total_tokens,reasoningTokens:(r=C.usage.output_tokens_details)==null?void 0:r.reasoning_tokens},request:{body:_},response:{...J(C),headers:x,body:S},warnings:I}}async doStream(n){var d;const{args:y,warnings:u,webSearchToolName:i,xSearchToolName:l,codeExecutionToolName:h}=await this.getArgs(n),o={...y,stream:!0},{responseHeaders:r,value:_}=await W({url:`${(d=this.config.baseURL)!=null?d:"https://api.x.ai/v1"}/responses`,headers:L(this.config.headers(),n.headers),body:o,failedResponseHandler:z,successfulResponseHandler:le(Ae),abortSignal:n.abortSignal,fetch:this.config.fetch});let I="unknown";const v={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let R=!0;const g={},x=new Set,C=this;return{stream:_.pipeThrough(new TransformStream({start(S){S.enqueue({type:"stream-start",warnings:u})},transform(S,p){var A,q,f,w,N,k,m,E,ee;if(n.includeRawChunks&&p.enqueue({type:"raw",rawValue:S.rawValue}),!S.success){p.enqueue({type:"error",error:S.error});return}const T=S.value;if(T.type==="response.created"||T.type==="response.in_progress"){R&&(p.enqueue({type:"response-metadata",...J(T.response)}),R=!1);return}if(T.type==="response.reasoning_summary_part.added"){const s=`reasoning-${T.item_id}`;p.enqueue({type:"reasoning-start",id:s})}if(T.type==="response.reasoning_summary_text.delta"){const s=`reasoning-${T.item_id}`;p.enqueue({type:"reasoning-delta",id:s,delta:T.delta});return}if(T.type==="response.reasoning_summary_text.done"){const s=`reasoning-${T.item_id}`;p.enqueue({type:"reasoning-end",id:s})}if(T.type==="response.output_text.delta"){const s=`text-${T.item_id}`;g[s]==null&&(g[s]={type:"text"},p.enqueue({type:"text-start",id:s})),p.enqueue({type:"text-delta",id:s,delta:T.delta});return}if(T.type==="response.output_text.done"){if(T.annotations)for(const s of T.annotations)s.type==="url_citation"&&"url"in s&&p.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:s.url,title:(A=s.title)!=null?A:s.url});return}if(T.type==="response.output_text.annotation.added"){const s=T.annotation;s.type==="url_citation"&&"url"in s&&p.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:s.url,title:(q=s.title)!=null?q:s.url});return}if(T.type==="response.done"||T.type==="response.completed"){const s=T.response;s.usage&&(v.inputTokens=s.usage.input_tokens,v.outputTokens=s.usage.output_tokens,v.totalTokens=s.usage.total_tokens,v.reasoningTokens=(f=s.usage.output_tokens_details)==null?void 0:f.reasoning_tokens),s.status&&(I=ae(s.status));return}if(T.type==="response.output_item.added"||T.type==="response.output_item.done"){const s=T.item;if(s.type==="web_search_call"||s.type==="x_search_call"||s.type==="code_interpreter_call"||s.type==="code_execution_call"||s.type==="view_image_call"||s.type==="view_x_video_call"||s.type==="custom_tool_call"){if(!x.has(s.id)){x.add(s.id);const P=["web_search","web_search_with_snippets","browse_page"],H=["x_user_search","x_keyword_search","x_semantic_search","x_thread_fetch"];let V=(w=s.name)!=null?w:"";P.includes((N=s.name)!=null?N:"")?V=i??"web_search":H.includes((k=s.name)!=null?k:"")?V=l??"x_search":s.name==="code_execution"&&(V=h??"code_execution");const te=s.type==="custom_tool_call"?(m=s.input)!=null?m:"":(E=s.arguments)!=null?E:"";p.enqueue({type:"tool-input-start",id:s.id,toolName:V}),p.enqueue({type:"tool-input-delta",id:s.id,delta:te}),p.enqueue({type:"tool-input-end",id:s.id}),p.enqueue({type:"tool-call",toolCallId:s.id,toolName:V,input:te,providerExecuted:!0})}return}if(s.type==="message")for(const P of s.content){if(P.text&&P.text.length>0){const H=`text-${s.id}`;g[H]==null&&(g[H]={type:"text"},p.enqueue({type:"text-start",id:H})),p.enqueue({type:"text-delta",id:H,delta:P.text})}if(P.annotations)for(const H of P.annotations)H.type==="url_citation"&&"url"in H&&p.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:H.url,title:(ee=H.title)!=null?ee:H.url})}else s.type==="function_call"&&(x.has(s.call_id)||(x.add(s.call_id),p.enqueue({type:"tool-input-start",id:s.call_id,toolName:s.name}),p.enqueue({type:"tool-input-delta",id:s.call_id,delta:s.arguments}),p.enqueue({type:"tool-input-end",id:s.call_id}),p.enqueue({type:"tool-call",toolCallId:s.call_id,toolName:s.name,input:s.arguments})))}},flush(S){for(const[p,A]of Object.entries(g))A.type==="text"&&S.enqueue({type:"text-end",id:p});S.enqueue({type:"finish",finishReason:I,usage:v})}})),request:{body:o},response:{headers:r}}}},Le=t({output:e().describe("the output of the code execution"),error:e().optional().describe("any error that occurred")}),Fe=D({id:"xai.code_execution",name:"code_execution",inputSchema:t({}).describe("no input parameters"),outputSchema:Le}),Je=(n={})=>Fe(n),ze=t({description:e().describe("description of the image"),objects:b(e()).optional().describe("objects detected in the image")}),Be=D({id:"xai.view_image",name:"view_image",inputSchema:t({}).describe("no input parameters"),outputSchema:ze}),Ke=(n={})=>Be(n),Ge=t({transcript:e().optional().describe("transcript of the video"),description:e().describe("description of the video content"),duration:a().optional().describe("duration in seconds")}),Ye=D({id:"xai.view_x_video",name:"view_x_video",inputSchema:t({}).describe("no input parameters"),outputSchema:Ge}),Qe=(n={})=>Ye(n),Ze={codeExecution:Je,viewImage:Ke,viewXVideo:Qe,webSearch:Ue,xSearch:Me},et="2.0.39",tt={errorSchema:ce,errorToMessage:n=>n.error.message};function nt(n={}){var d;const y=_e((d=n.baseURL)!=null?d:"https://api.x.ai/v1"),u=()=>me({Authorization:`Bearer ${ge({apiKey:n.apiKey,environmentVariableName:"XAI_API_KEY",description:"xAI API key"})}`,...n.headers},`ai-sdk/xai/${et}`),i=r=>new Ce(r,{provider:"xai.chat",baseURL:y,headers:u,generateId:ne,fetch:n.fetch}),l=r=>new We(r,{provider:"xai.responses",baseURL:y,headers:u,generateId:ne,fetch:n.fetch}),h=r=>new de(r,{provider:"xai.image",url:({path:_})=>`${y}${_}`,headers:u,fetch:n.fetch,errorStructure:tt}),o=r=>i(r);return o.specificationVersion="v2",o.languageModel=i,o.chat=i,o.responses=l,o.textEmbeddingModel=r=>{throw new he({modelId:r,modelType:"textEmbeddingModel"})},o.imageModel=h,o.image=h,o.tools=Ze,o}var rt=nt();export{et as VERSION,Je as codeExecution,nt as createXai,Ke as viewImage,Qe as viewXVideo,Ue as webSearch,Me as xSearch,rt as xai,Ze as xaiTools};
//# sourceMappingURL=index-Cv7mWNpR.js.map
