import{w as Q,N as V,a as X,q as Z,p as ee,b as $,d as K,j as ne,g as U,k as te,I as P,i as z,h as se,U as oe,s as ie,z as ae}from"./index-DVzO2118.js";import{o as g,_ as B,b as W,c as le,s as r,n as S,a as D,l as ue}from"./main-B2AV-kr0.js";import"./__vite-browser-external-2447137e-qv044l9q.js";function re({prompt:e,responseFormat:i}){const t=[],d=[];i?.type==="json"&&(i.schema==null?t.push({role:"system",content:"Return JSON."}):t.push({role:"system",content:"Return JSON that conforms to the following schema: "+JSON.stringify(i.schema)}));let p=-1;for(let s=e.length-1;s>=0;s--)if(e[s].role==="user"){p=s;break}let a=-1;for(const{role:s,content:f}of e)switch(a++,s){case"system":{t.push({role:"system",content:f});break}case"user":{let n="";for(const l of f)l.type==="text"?n+=l.text:d.push({type:"other",message:`Unsupported user message part type: ${l.type}`});t.push({role:"user",content:n});break}case"assistant":{let n="",l;const m=[];for(const u of f)switch(u.type){case"text":{n+=u.text;break}case"reasoning":{if(a<=p)break;l==null?l=u.text:l+=u.text;break}case"tool-call":{m.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.input)}});break}}t.push({role:"assistant",content:n,reasoning_content:l,tool_calls:m.length>0?m:void 0});break}case"tool":{for(const n of f){const l=n.output;let m;switch(l.type){case"text":case"error-text":m=l.value;break;case"content":case"json":case"error-json":m=JSON.stringify(l.value);break}t.push({role:"tool",tool_call_id:n.toolCallId,content:m})}break}default:{d.push({type:"other",message:`Unsupported message role: ${s}`});break}}return{messages:t,warnings:d}}var G=g({prompt_tokens:S().nullish(),completion_tokens:S().nullish(),prompt_cache_hit_tokens:S().nullish(),prompt_cache_miss_tokens:S().nullish(),total_tokens:S().nullish(),completion_tokens_details:g({reasoning_tokens:S().nullish()}).nullish()}).nullish(),Y=g({error:g({message:r(),type:r().nullish(),param:le().nullish(),code:W([r(),S()]).nullish()})}),de=g({id:r().nullish(),created:S().nullish(),model:r().nullish(),choices:D(g({message:g({role:ue("assistant").nullish(),content:r().nullish(),reasoning_content:r().nullish(),tool_calls:D(g({id:r().nullish(),function:g({name:r(),arguments:r()})})).nullish()}),finish_reason:r().nullish()})),usage:G}),ce=ie(()=>ae(W([g({id:r().nullish(),created:S().nullish(),model:r().nullish(),choices:D(g({delta:g({role:B(["assistant"]).nullish(),content:r().nullish(),reasoning_content:r().nullish(),tool_calls:D(g({index:S(),id:r().nullish(),function:g({name:r().nullish(),arguments:r().nullish()})})).nullish()}).nullish(),finish_reason:r().nullish()})),usage:G}),Y]))),pe=g({thinking:g({type:B(["enabled","disabled"]).optional()}).optional()});function he({tools:e,toolChoice:i}){e=e?.length?e:void 0;const t=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:t};const d=[];for(const a of e)a.type==="provider-defined"?t.push({type:"unsupported-tool",tool:a}):d.push({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema}});if(i==null)return{tools:d,toolChoice:void 0,toolWarnings:t};const p=i.type;switch(p){case"auto":case"none":case"required":return{tools:d,toolChoice:p,toolWarnings:t};case"tool":return{tools:d,toolChoice:{type:"function",function:{name:i.toolName}},toolWarnings:t};default:{const a=p;throw new oe({functionality:`tool choice type: ${a}`})}}}function L({id:e,model:i,created:t}){return{id:e??void 0,modelId:i??void 0,timestamp:t!=null?new Date(t*1e3):void 0}}function F(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"tool_calls":return"tool-calls";case"insufficient_system_resource":return"error";default:return"unknown"}}var fe=class{constructor(e,i){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=i,this.failedResponseHandler=Z({errorSchema:Y,errorToMessage:t=>t.error.message})}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async getArgs({prompt:e,maxOutputTokens:i,temperature:t,topP:d,topK:p,frequencyPenalty:a,presencePenalty:s,providerOptions:f,stopSequences:n,responseFormat:l,tools:m,toolChoice:u,seed:R}){var c,o;const k=(c=await ee({provider:this.providerOptionsName,providerOptions:f,schema:pe}))!=null?c:{},{messages:C,warnings:v}=re({prompt:e,responseFormat:l});p!=null&&v.push({type:"unsupported-setting",setting:"topK"}),R!=null&&v.push({type:"unsupported-setting",setting:"seed"});const{tools:q,toolChoice:T,toolWarnings:h}=he({tools:m,toolChoice:u});return{args:{model:this.modelId,max_tokens:i,temperature:t,top_p:d,frequency_penalty:a,presence_penalty:s,response_format:l?.type==="json"?{type:"json_object"}:void 0,stop:n,messages:C,tools:q,tool_choice:T,thinking:((o=k.thinking)==null?void 0:o.type)!=null?{type:k.thinking.type}:void 0},warnings:[...v,...h]}}async doGenerate(e){var i,t,d,p,a,s,f,n,l,m,u,R,c,o,k,C;const{args:v,warnings:q}=await this.getArgs({...e}),{responseHeaders:T,value:h,rawValue:N}=await $({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:K(this.config.headers(),e.headers),body:v,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:ne(de),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=h.choices[0],y=[],I=b.message.reasoning_content;if(I!=null&&I.length>0&&y.push({type:"reasoning",text:I}),b.message.tool_calls!=null)for(const H of b.message.tool_calls)y.push({type:"tool-call",toolCallId:(i=H.id)!=null?i:U(),toolName:H.function.name,input:H.function.arguments});const E=b.message.content;return E!=null&&E.length>0&&y.push({type:"text",text:E}),{content:y,finishReason:F(b.finish_reason),usage:{inputTokens:(d=(t=h.usage)==null?void 0:t.prompt_tokens)!=null?d:void 0,outputTokens:(a=(p=h.usage)==null?void 0:p.completion_tokens)!=null?a:void 0,totalTokens:(f=(s=h.usage)==null?void 0:s.total_tokens)!=null?f:void 0,reasoningTokens:(m=(l=(n=h.usage)==null?void 0:n.completion_tokens_details)==null?void 0:l.reasoning_tokens)!=null?m:void 0,cachedInputTokens:(R=(u=h.usage)==null?void 0:u.prompt_cache_hit_tokens)!=null?R:void 0},providerMetadata:{[this.providerOptionsName]:{promptCacheHitTokens:(o=(c=h.usage)==null?void 0:c.prompt_cache_hit_tokens)!=null?o:null,promptCacheMissTokens:(C=(k=h.usage)==null?void 0:k.prompt_cache_miss_tokens)!=null?C:null}},request:{body:v},response:{...L(h),headers:T,body:N},warnings:q}}async doStream(e){const{args:i,warnings:t}=await this.getArgs({...e}),d={...i,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:p,value:a}=await $({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:K(this.config.headers(),e.headers),body:d,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:te(ce),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=[];let f="unknown",n,l=!0;const m=this.providerOptionsName;let u=!1,R=!1;return{stream:a.pipeThrough(new TransformStream({start(c){c.enqueue({type:"stream-start",warnings:t})},transform(c,o){var k,C,v,q,T,h,N,b,y,I,E,H;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:c.rawValue}),!c.success){f="error",o.enqueue({type:"error",error:c.error});return}const M=c.value;if("error"in M){f="error",o.enqueue({type:"error",error:M.error.message});return}l&&(l=!1,o.enqueue({type:"response-metadata",...L(M)})),M.usage!=null&&(n=M.usage);const O=M.choices[0];if(O?.finish_reason!=null&&(f=F(O.finish_reason)),O?.delta==null)return;const A=O.delta,J=A.reasoning_content;if(J&&(u||(o.enqueue({type:"reasoning-start",id:"reasoning-0"}),u=!0),o.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:J})),A.content&&(R||(o.enqueue({type:"text-start",id:"txt-0"}),R=!0),u&&(o.enqueue({type:"reasoning-end",id:"reasoning-0"}),u=!1),o.enqueue({type:"text-delta",id:"txt-0",delta:A.content})),A.tool_calls!=null){u&&(o.enqueue({type:"reasoning-end",id:"reasoning-0"}),u=!1);for(const _ of A.tool_calls){const j=_.index;if(s[j]==null){if(_.id==null)throw new P({data:_,message:"Expected 'id' to be a string."});if(((k=_.function)==null?void 0:k.name)==null)throw new P({data:_,message:"Expected 'function.name' to be a string."});o.enqueue({type:"tool-input-start",id:_.id,toolName:_.function.name}),s[j]={id:_.id,type:"function",function:{name:_.function.name,arguments:(C=_.function.arguments)!=null?C:""},hasFinished:!1};const x=s[j];((v=x.function)==null?void 0:v.name)!=null&&((q=x.function)==null?void 0:q.arguments)!=null&&(x.function.arguments.length>0&&o.enqueue({type:"tool-input-delta",id:x.id,delta:x.function.arguments}),z(x.function.arguments)&&(o.enqueue({type:"tool-input-end",id:x.id}),o.enqueue({type:"tool-call",toolCallId:(T=x.id)!=null?T:U(),toolName:x.function.name,input:x.function.arguments}),x.hasFinished=!0));continue}const w=s[j];w.hasFinished||(((h=_.function)==null?void 0:h.arguments)!=null&&(w.function.arguments+=(b=(N=_.function)==null?void 0:N.arguments)!=null?b:""),o.enqueue({type:"tool-input-delta",id:w.id,delta:(y=_.function.arguments)!=null?y:""}),((I=w.function)==null?void 0:I.name)!=null&&((E=w.function)==null?void 0:E.arguments)!=null&&z(w.function.arguments)&&(o.enqueue({type:"tool-input-end",id:w.id}),o.enqueue({type:"tool-call",toolCallId:(H=w.id)!=null?H:U(),toolName:w.function.name,input:w.function.arguments}),w.hasFinished=!0))}}},flush(c){var o,k,C,v,q,T,h,N,b;u&&c.enqueue({type:"reasoning-end",id:"reasoning-0"}),R&&c.enqueue({type:"text-end",id:"txt-0"});for(const y of s.filter(I=>!I.hasFinished))c.enqueue({type:"tool-input-end",id:y.id}),c.enqueue({type:"tool-call",toolCallId:(o=y.id)!=null?o:U(),toolName:y.function.name,input:y.function.arguments});c.enqueue({type:"finish",finishReason:f,usage:{inputTokens:(k=n?.prompt_tokens)!=null?k:void 0,outputTokens:(C=n?.completion_tokens)!=null?C:void 0,totalTokens:(v=n?.total_tokens)!=null?v:void 0,reasoningTokens:(T=(q=n?.completion_tokens_details)==null?void 0:q.reasoning_tokens)!=null?T:void 0,cachedInputTokens:(h=n?.prompt_cache_hit_tokens)!=null?h:void 0},providerMetadata:{[m]:{promptCacheHitTokens:(N=n?.prompt_cache_hit_tokens)!=null?N:null,promptCacheMissTokens:(b=n?.prompt_cache_miss_tokens)!=null?b:null}}})}})),request:{body:d},response:{headers:p}}}},ge="1.0.31";function me(e={}){var i;const t=Q((i=e.baseURL)!=null?i:"https://api.deepseek.com"),d=()=>X({Authorization:`Bearer ${se({apiKey:e.apiKey,environmentVariableName:"DEEPSEEK_API_KEY",description:"DeepSeek API key"})}`,...e.headers},`ai-sdk/deepseek/${ge}`),p=s=>new fe(s,{provider:"deepseek.chat",url:({path:f})=>`${t}${f}`,headers:d,fetch:e.fetch}),a=s=>p(s);return a.languageModel=p,a.chat=p,a.textEmbeddingModel=s=>{throw new V({modelId:s,modelType:"textEmbeddingModel"})},a.imageModel=s=>{throw new V({modelId:s,modelType:"imageModel"})},a}var ke=me();export{ge as VERSION,me as createDeepSeek,ke as deepseek};
//# sourceMappingURL=index-BoNGrpWd.js.map
