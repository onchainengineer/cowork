import{e as X,m as le,d as W,f as ee,b as L,w as _e,N as me,j as O,g as se,a as ge,z as V,p as ue,h as ce,i as fe,k as ye,U as te,v as ae}from"./index-DnAsjnwa.js";import{o as t,u as B,f as U,s as e,n,a as v,l as c,r as K,b as P,_ as F,d as pe}from"./main-D0Ooo9fF.js";import"./stream-EztMLV5l.js";import"./__vite-browser-external-2447137e-CirRYW17.js";t({user:e().optional(),reasoningEffort:e().optional(),textVerbosity:e().optional()});var xe=t({error:t({message:e(),type:e().nullish(),param:U().nullish(),code:B([e(),n()]).nullish()})}),ve={errorSchema:xe,errorToMessage:o=>o.error.message},be=t({prompt_tokens:n().nullish(),completion_tokens:n().nullish(),total_tokens:n().nullish(),prompt_tokens_details:t({cached_tokens:n().nullish()}).nullish(),completion_tokens_details:t({reasoning_tokens:n().nullish(),accepted_prediction_tokens:n().nullish(),rejected_prediction_tokens:n().nullish()}).nullish()}).nullish();t({id:e().nullish(),created:n().nullish(),model:e().nullish(),choices:v(t({message:t({role:c("assistant").nullish(),content:e().nullish(),reasoning_content:e().nullish(),reasoning:e().nullish(),tool_calls:v(t({id:e().nullish(),function:t({name:e(),arguments:e()})})).nullish()}),finish_reason:e().nullish()})),usage:be});t({echo:P().optional(),logitBias:K(e(),n()).optional(),suffix:e().optional(),user:e().optional()});var we=t({prompt_tokens:n(),completion_tokens:n(),total_tokens:n()});t({id:e().nullish(),created:n().nullish(),model:e().nullish(),choices:v(t({text:e(),finish_reason:e()})),usage:we.nullish()});t({dimensions:n().optional(),user:e().optional()});t({data:v(t({embedding:v(n())})),usage:t({prompt_tokens:n()}).nullish(),providerMetadata:K(e(),K(e(),U())).optional()});var ke=class{constructor(o,p){this.modelId=o,this.config=p,this.specificationVersion="v2",this.maxImagesPerCall=10}get provider(){return this.config.provider}async doGenerate({prompt:o,n:p,size:f,aspectRatio:u,seed:i,providerOptions:l,headers:_,abortSignal:s}){var r,h,k,b,R;const m=[];u!=null&&m.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),i!=null&&m.push({type:"unsupported-setting",setting:"seed"});const y=(k=(h=(r=this.config._internal)==null?void 0:r.currentDate)==null?void 0:h.call(r))!=null?k:new Date,{value:C,responseHeaders:S}=await X({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:W(this.config.headers(),_),body:{model:this.modelId,prompt:o,n:p,size:f,...(b=l.openai)!=null?b:{},response_format:"b64_json"},failedResponseHandler:le((R=this.config.errorStructure)!=null?R:ve),successfulResponseHandler:ee(Se),abortSignal:s,fetch:this.config.fetch});return{images:C.data.map(d=>d.b64_json),warnings:m,response:{timestamp:y,modelId:this.modelId,headers:S}}}},Se=t({data:v(t({b64_json:e()}))});function Te(o){const p=[],f=[];for(const{role:u,content:i}of o)switch(u){case"system":{p.push({role:"system",content:i});break}case"user":{if(i.length===1&&i[0].type==="text"){p.push({role:"user",content:i[0].text});break}p.push({role:"user",content:i.map(l=>{switch(l.type){case"text":return{type:"text",text:l.text};case"file":if(l.mediaType.startsWith("image/")){const _=l.mediaType==="image/*"?"image/jpeg":l.mediaType;return{type:"image_url",image_url:{url:l.data instanceof URL?l.data.toString():`data:${_};base64,${ye(l.data)}`}}}else throw new te({functionality:`file part media type ${l.mediaType}`})}})});break}case"assistant":{let l="";const _=[];for(const s of i)switch(s.type){case"text":{l+=s.text;break}case"tool-call":{_.push({id:s.toolCallId,type:"function",function:{name:s.toolName,arguments:JSON.stringify(s.input)}});break}}p.push({role:"assistant",content:l,tool_calls:_.length>0?_:void 0});break}case"tool":{for(const l of i){const _=l.output;let s;switch(_.type){case"text":case"error-text":s=_.value;break;case"content":case"json":case"error-json":s=JSON.stringify(_.value);break}p.push({role:"tool",tool_call_id:l.toolCallId,content:s})}break}default:{const l=u;throw new Error(`Unsupported role: ${l}`)}}return{messages:p,warnings:f}}function J({id:o,model:p,created:f,created_at:u}){const i=f??u;return{id:o??void 0,modelId:p??void 0,timestamp:i!=null?new Date(i*1e3):void 0}}function ie(o){switch(o){case"stop":return"stop";case"length":return"length";case"tool_calls":case"function_call":return"tool-calls";case"content_filter":return"content-filter";default:return"unknown"}}var Ie=t({type:c("web"),country:e().length(2).optional(),excludedWebsites:v(e()).max(5).optional(),allowedWebsites:v(e()).max(5).optional(),safeSearch:P().optional()}),Ce=t({type:c("x"),excludedXHandles:v(e()).optional(),includedXHandles:v(e()).optional(),postFavoriteCount:n().int().optional(),postViewCount:n().int().optional(),xHandles:v(e()).optional()}),Re=t({type:c("news"),country:e().length(2).optional(),excludedWebsites:v(e()).max(5).optional(),safeSearch:P().optional()}),qe=t({type:c("rss"),links:v(e().url()).max(1)}),He=pe("type",[Ie,Ce,Re,qe]),Ne=t({reasoningEffort:F(["low","high"]).optional(),parallel_function_calling:P().optional(),searchParameters:t({mode:F(["off","auto","on"]),returnCitations:P().optional(),fromDate:e().optional(),toDate:e().optional(),maxSearchResults:n().min(1).max(50).optional(),sources:v(He).optional()}).optional()}),de=t({error:t({message:e(),type:e().nullish(),param:U().nullish(),code:B([e(),n()]).nullish()})}),z=le({errorSchema:de,errorToMessage:o=>o.error.message});function Ae({tools:o,toolChoice:p}){o=o?.length?o:void 0;const f=[];if(o==null)return{tools:void 0,toolChoice:void 0,toolWarnings:f};const u=[];for(const l of o)l.type==="provider-defined"?f.push({type:"unsupported-tool",tool:l}):u.push({type:"function",function:{name:l.name,description:l.description,parameters:l.inputSchema}});if(p==null)return{tools:u,toolChoice:void 0,toolWarnings:f};const i=p.type;switch(i){case"auto":case"none":return{tools:u,toolChoice:i,toolWarnings:f};case"required":return{tools:u,toolChoice:"required",toolWarnings:f};case"tool":return{tools:u,toolChoice:{type:"function",function:{name:p.toolName}},toolWarnings:f};default:{const l=i;throw new te({functionality:`tool choice type: ${l}`})}}}var Ee=class{constructor(o,p){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=o,this.config=p}get provider(){return this.config.provider}async getArgs({prompt:o,maxOutputTokens:p,temperature:f,topP:u,topK:i,frequencyPenalty:l,presencePenalty:_,stopSequences:s,seed:r,responseFormat:h,providerOptions:k,tools:b,toolChoice:R}){var m,y,C;const S=[],d=(m=await ue({provider:"xai",providerOptions:k,schema:Ne}))!=null?m:{};i!=null&&S.push({type:"unsupported-setting",setting:"topK"}),l!=null&&S.push({type:"unsupported-setting",setting:"frequencyPenalty"}),_!=null&&S.push({type:"unsupported-setting",setting:"presencePenalty"}),s!=null&&S.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:N,warnings:q}=Te(o);S.push(...q);const{tools:x,toolChoice:w,toolWarnings:H}=Ae({tools:b,toolChoice:R});return S.push(...H),{args:{model:this.modelId,max_tokens:p,temperature:f,top_p:u,seed:r,reasoning_effort:d.reasoningEffort,parallel_function_calling:d.parallel_function_calling,response_format:h?.type==="json"?h.schema!=null?{type:"json_schema",json_schema:{name:(y=h.name)!=null?y:"response",schema:h.schema,strict:!0}}:{type:"json_object"}:void 0,search_parameters:d.searchParameters?{mode:d.searchParameters.mode,return_citations:d.searchParameters.returnCitations,from_date:d.searchParameters.fromDate,to_date:d.searchParameters.toDate,max_search_results:d.searchParameters.maxSearchResults,sources:(C=d.searchParameters.sources)==null?void 0:C.map(g=>{var E;return{type:g.type,...g.type==="web"&&{country:g.country,excluded_websites:g.excludedWebsites,allowed_websites:g.allowedWebsites,safe_search:g.safeSearch},...g.type==="x"&&{excluded_x_handles:g.excludedXHandles,included_x_handles:(E=g.includedXHandles)!=null?E:g.xHandles,post_favorite_count:g.postFavoriteCount,post_view_count:g.postViewCount},...g.type==="news"&&{country:g.country,excluded_websites:g.excludedWebsites,safe_search:g.safeSearch},...g.type==="rss"&&{links:g.links}}})}:void 0,messages:N,tools:x,tool_choice:w},warnings:S}}async doGenerate(o){var p,f,u,i,l;const{args:_,warnings:s}=await this.getArgs(o),{responseHeaders:r,value:h,rawValue:k}=await X({url:`${(p=this.config.baseURL)!=null?p:"https://api.x.ai/v1"}/chat/completions`,headers:W(this.config.headers(),o.headers),body:_,failedResponseHandler:z,successfulResponseHandler:ee(Pe),abortSignal:o.abortSignal,fetch:this.config.fetch}),b=h.choices[0],R=[];if(b.message.content!=null&&b.message.content.length>0){let m=b.message.content;const y=_.messages[_.messages.length-1];y?.role==="assistant"&&m===y.content&&(m=""),m.length>0&&R.push({type:"text",text:m})}if(b.message.reasoning_content!=null&&b.message.reasoning_content.length>0&&R.push({type:"reasoning",text:b.message.reasoning_content}),b.message.tool_calls!=null)for(const m of b.message.tool_calls)R.push({type:"tool-call",toolCallId:m.id,toolName:m.function.name,input:m.function.arguments});if(h.citations!=null)for(const m of h.citations)R.push({type:"source",sourceType:"url",id:this.config.generateId(),url:m});return{content:R,finishReason:ie(b.finish_reason),usage:{inputTokens:h.usage.prompt_tokens,outputTokens:h.usage.completion_tokens,totalTokens:h.usage.total_tokens,reasoningTokens:(u=(f=h.usage.completion_tokens_details)==null?void 0:f.reasoning_tokens)!=null?u:void 0,cachedInputTokens:(l=(i=h.usage.prompt_tokens_details)==null?void 0:i.cached_tokens)!=null?l:void 0},request:{body:_},response:{...J(h),headers:r,body:k},warnings:s}}async doStream(o){var p;const{args:f,warnings:u}=await this.getArgs(o),i={...f,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:l,value:_}=await X({url:`${(p=this.config.baseURL)!=null?p:"https://api.x.ai/v1"}/chat/completions`,headers:W(this.config.headers(),o.headers),body:i,failedResponseHandler:z,successfulResponseHandler:ce($e),abortSignal:o.abortSignal,fetch:this.config.fetch});let s="unknown";const r={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0};let h=!0;const k={},b={},R=this;return{stream:_.pipeThrough(new TransformStream({start(m){m.enqueue({type:"stream-start",warnings:u})},transform(m,y){var C,S,d,N;if(o.includeRawChunks&&y.enqueue({type:"raw",rawValue:m.rawValue}),!m.success){y.enqueue({type:"error",error:m.error});return}const q=m.value;if(h&&(y.enqueue({type:"response-metadata",...J(q)}),h=!1),q.citations!=null)for(const T of q.citations)y.enqueue({type:"source",sourceType:"url",id:R.config.generateId(),url:T});q.usage!=null&&(r.inputTokens=q.usage.prompt_tokens,r.outputTokens=q.usage.completion_tokens,r.totalTokens=q.usage.total_tokens,r.reasoningTokens=(S=(C=q.usage.completion_tokens_details)==null?void 0:C.reasoning_tokens)!=null?S:void 0,r.cachedInputTokens=(N=(d=q.usage.prompt_tokens_details)==null?void 0:d.cached_tokens)!=null?N:void 0);const x=q.choices[0];if(x?.finish_reason!=null&&(s=ie(x.finish_reason)),x?.delta==null)return;const w=x.delta,H=x.index;if(w.content!=null&&w.content.length>0){const T=w.content,g=i.messages[i.messages.length-1];if(g?.role==="assistant"&&T===g.content)return;const E=`text-${q.id||H}`;k[E]==null&&(k[E]={type:"text"},y.enqueue({type:"text-start",id:E})),y.enqueue({type:"text-delta",id:E,delta:T})}if(w.reasoning_content!=null&&w.reasoning_content.length>0){const T=`reasoning-${q.id||H}`;if(b[T]===w.reasoning_content)return;b[T]=w.reasoning_content,k[T]==null&&(k[T]={type:"reasoning"},y.enqueue({type:"reasoning-start",id:T})),y.enqueue({type:"reasoning-delta",id:T,delta:w.reasoning_content})}if(w.tool_calls!=null)for(const T of w.tool_calls){const g=T.id;y.enqueue({type:"tool-input-start",id:g,toolName:T.function.name}),y.enqueue({type:"tool-input-delta",id:g,delta:T.function.arguments}),y.enqueue({type:"tool-input-end",id:g}),y.enqueue({type:"tool-call",toolCallId:g,toolName:T.function.name,input:T.function.arguments})}},flush(m){for(const[y,C]of Object.entries(k))m.enqueue({type:C.type==="text"?"text-end":"reasoning-end",id:y});m.enqueue({type:"finish",finishReason:s,usage:r})}})),request:{body:i},response:{headers:l}}}},he=t({prompt_tokens:n(),completion_tokens:n(),total_tokens:n(),prompt_tokens_details:t({text_tokens:n().nullish(),audio_tokens:n().nullish(),image_tokens:n().nullish(),cached_tokens:n().nullish()}).nullish(),completion_tokens_details:t({reasoning_tokens:n().nullish(),audio_tokens:n().nullish(),accepted_prediction_tokens:n().nullish(),rejected_prediction_tokens:n().nullish()}).nullish()}),Pe=t({id:e().nullish(),created:n().nullish(),model:e().nullish(),choices:v(t({message:t({role:c("assistant"),content:e().nullish(),reasoning_content:e().nullish(),tool_calls:v(t({id:e(),type:c("function"),function:t({name:e(),arguments:e()})})).nullish()}),index:n(),finish_reason:e().nullish()})),object:c("chat.completion"),usage:he,citations:v(e().url()).nullish()}),$e=t({id:e().nullish(),created:n().nullish(),model:e().nullish(),choices:v(t({delta:t({role:F(["assistant"]).optional(),content:e().nullish(),reasoning_content:e().nullish(),tool_calls:v(t({id:e(),type:c("function"),function:t({name:e(),arguments:e()})})).nullish()}),finish_reason:e().nullish(),index:n()})),usage:he.nullish(),citations:v(e().url()).nullish()}),G=B([t({type:c("url_citation"),url:e(),title:e().optional()}),t({type:e()})]),Y=t({type:e(),text:e().optional(),logprobs:v(U()).optional(),annotations:v(G).optional()}),Q=t({type:e(),text:e()}),j=t({name:e().optional(),arguments:e().optional(),input:e().optional(),call_id:e().optional(),id:e(),status:e(),action:U().optional()}),Z=pe("type",[t({type:c("web_search_call"),...j.shape}),t({type:c("x_search_call"),...j.shape}),t({type:c("code_interpreter_call"),...j.shape}),t({type:c("code_execution_call"),...j.shape}),t({type:c("view_image_call"),...j.shape}),t({type:c("view_x_video_call"),...j.shape}),t({type:c("custom_tool_call"),...j.shape}),t({type:c("message"),role:e(),content:v(Y),id:e(),status:e()}),t({type:c("function_call"),name:e(),arguments:e(),call_id:e(),id:e()}),t({type:c("reasoning"),id:e(),summary:v(Q),status:e()})]),je=t({input_tokens:n(),output_tokens:n(),total_tokens:n().optional(),input_tokens_details:t({cached_tokens:n().optional()}).optional(),output_tokens_details:t({reasoning_tokens:n().optional()}).optional(),num_sources_used:n().optional(),num_server_side_tools_used:n().optional()}),M=t({id:e().nullish(),created_at:n().nullish(),model:e().nullish(),object:c("response"),output:v(Z),usage:je,status:e()}),Ue=B([t({type:c("response.created"),response:M.partial({usage:!0,status:!0})}),t({type:c("response.in_progress"),response:M.partial({usage:!0,status:!0})}),t({type:c("response.output_item.added"),item:Z,output_index:n()}),t({type:c("response.output_item.done"),item:Z,output_index:n()}),t({type:c("response.content_part.added"),item_id:e(),output_index:n(),content_index:n(),part:Y}),t({type:c("response.content_part.done"),item_id:e(),output_index:n(),content_index:n(),part:Y}),t({type:c("response.output_text.delta"),item_id:e(),output_index:n(),content_index:n(),delta:e(),logprobs:v(U()).optional()}),t({type:c("response.output_text.done"),item_id:e(),output_index:n(),content_index:n(),text:e(),logprobs:v(U()).optional(),annotations:v(G).optional()}),t({type:c("response.output_text.annotation.added"),item_id:e(),output_index:n(),content_index:n(),annotation_index:n(),annotation:G}),t({type:c("response.reasoning_summary_part.added"),item_id:e(),output_index:n(),summary_index:n(),part:Q}),t({type:c("response.reasoning_summary_part.done"),item_id:e(),output_index:n(),summary_index:n(),part:Q}),t({type:c("response.reasoning_summary_text.delta"),item_id:e(),output_index:n(),summary_index:n(),delta:e()}),t({type:c("response.reasoning_summary_text.done"),item_id:e(),output_index:n(),summary_index:n(),text:e()}),t({type:c("response.web_search_call.in_progress"),item_id:e(),output_index:n()}),t({type:c("response.web_search_call.searching"),item_id:e(),output_index:n()}),t({type:c("response.web_search_call.completed"),item_id:e(),output_index:n()}),t({type:c("response.x_search_call.in_progress"),item_id:e(),output_index:n()}),t({type:c("response.x_search_call.searching"),item_id:e(),output_index:n()}),t({type:c("response.x_search_call.completed"),item_id:e(),output_index:n()}),t({type:c("response.code_execution_call.in_progress"),item_id:e(),output_index:n()}),t({type:c("response.code_execution_call.executing"),item_id:e(),output_index:n()}),t({type:c("response.code_execution_call.completed"),item_id:e(),output_index:n()}),t({type:c("response.code_interpreter_call.in_progress"),item_id:e(),output_index:n()}),t({type:c("response.code_interpreter_call.executing"),item_id:e(),output_index:n()}),t({type:c("response.code_interpreter_call.completed"),item_id:e(),output_index:n()}),t({type:c("response.done"),response:M}),t({type:c("response.completed"),response:M})]);function re(o){switch(o){case"stop":case"completed":return"stop";case"length":return"length";case"tool_calls":case"function_call":return"tool-calls";case"content_filter":return"content-filter";default:return"unknown"}}var Oe=t({reasoningEffort:F(["low","medium","high"]).optional(),store:P().optional(),previousResponseId:e().optional()});async function Ve({prompt:o}){var p,f,u,i;const l=[],_=[];for(const s of o)switch(s.role){case"system":{l.push({role:"system",content:s.content});break}case"user":{let r="";for(const h of s.content)switch(h.type){case"text":{r+=h.text;break}case"file":{_.push({type:"other",message:`xAI Responses API does not support ${h.type} in user messages`});break}default:_.push({type:"other",message:"xAI Responses API does not support this content type in user messages"})}l.push({role:"user",content:r});break}case"assistant":{for(const r of s.content)switch(r.type){case"text":{const h=typeof((f=(p=r.providerOptions)==null?void 0:p.xai)==null?void 0:f.itemId)=="string"?r.providerOptions.xai.itemId:void 0;l.push({role:"assistant",content:r.text,id:h});break}case"tool-call":{if(r.providerExecuted)break;const h=typeof((i=(u=r.providerOptions)==null?void 0:u.xai)==null?void 0:i.itemId)=="string"?r.providerOptions.xai.itemId:void 0;l.push({type:"function_call",id:h??r.toolCallId,call_id:r.toolCallId,name:r.toolName,arguments:JSON.stringify(r.input),status:"completed"});break}case"tool-result":break;case"reasoning":case"file":{_.push({type:"other",message:`xAI Responses API does not support ${r.type} in assistant messages`});break}default:_.push({type:"other",message:"xAI Responses API does not support this content type in assistant messages"})}break}case"tool":{for(const r of s.content){const h=r.output;let k;switch(h.type){case"text":case"error-text":k=h.value;break;case"json":case"error-json":k=JSON.stringify(h.value);break;case"content":k=h.value.map(b=>b.type==="text"?b.text:"").join("");break;default:k=""}l.push({type:"function_call_output",call_id:r.toolCallId,output:k})}break}default:_.push({type:"other",message:"unsupported message role"})}return{input:l,inputWarnings:_}}var De=O(()=>V(t({allowedDomains:v(e()).max(5).optional(),excludedDomains:v(e()).max(5).optional(),enableImageUnderstanding:P().optional()}))),Me=O(()=>V(t({query:e(),sources:v(t({title:e(),url:e(),snippet:e()}))}))),Xe=L({id:"xai.web_search",name:"web_search",inputSchema:O(()=>V(t({}))),outputSchema:Me}),We=(o={})=>Xe(o),Le=O(()=>V(t({allowedXHandles:v(e()).max(10).optional(),excludedXHandles:v(e()).max(10).optional(),fromDate:e().optional(),toDate:e().optional(),enableImageUnderstanding:P().optional(),enableVideoUnderstanding:P().optional()}))),Fe=O(()=>V(t({query:e(),posts:v(t({author:e(),text:e(),url:e(),likes:n()}))}))),Je=L({id:"xai.x_search",name:"x_search",inputSchema:O(()=>V(t({}))),outputSchema:Fe}),ze=(o={})=>Je(o);async function Be({tools:o,toolChoice:p}){const f=o?.length?o:void 0,u=[];if(f==null)return{tools:void 0,toolChoice:void 0,toolWarnings:u};const i=[],l=new Map;for(const s of f)if(l.set(s.name,s),s.type==="provider-defined")switch(s.id){case"xai.web_search":{const r=await ae({value:s.args,schema:De});i.push({type:"web_search",allowed_domains:r.allowedDomains,excluded_domains:r.excludedDomains,enable_image_understanding:r.enableImageUnderstanding});break}case"xai.x_search":{const r=await ae({value:s.args,schema:Le});i.push({type:"x_search",allowed_x_handles:r.allowedXHandles,excluded_x_handles:r.excludedXHandles,from_date:r.fromDate,to_date:r.toDate,enable_image_understanding:r.enableImageUnderstanding,enable_video_understanding:r.enableVideoUnderstanding});break}case"xai.code_execution":{i.push({type:"code_interpreter"});break}case"xai.view_image":{i.push({type:"view_image"});break}case"xai.view_x_video":{i.push({type:"view_x_video"});break}case"xai.file_search":{i.push({type:"file_search"});break}case"xai.mcp":{i.push({type:"mcp"});break}default:{u.push({type:"unsupported-tool",tool:s});break}}else i.push({type:"function",function:{name:s.name,description:s.description,parameters:s.inputSchema}});if(p==null)return{tools:i,toolChoice:void 0,toolWarnings:u};const _=p.type;switch(_){case"auto":case"none":return{tools:i,toolChoice:_,toolWarnings:u};case"required":return{tools:i,toolChoice:"required",toolWarnings:u};case"tool":{const s=l.get(p.toolName);if(s==null)return{tools:i,toolChoice:void 0,toolWarnings:u};if(s.type==="provider-defined")switch(s.id){case"xai.web_search":return{tools:i,toolChoice:{type:"web_search"},toolWarnings:u};case"xai.x_search":return{tools:i,toolChoice:{type:"x_search"},toolWarnings:u};case"xai.code_execution":return{tools:i,toolChoice:{type:"code_interpreter"},toolWarnings:u};case"xai.view_image":return{tools:i,toolChoice:{type:"view_image"},toolWarnings:u};case"xai.view_x_video":return{tools:i,toolChoice:{type:"view_x_video"},toolWarnings:u};case"xai.file_search":return{tools:i,toolChoice:{type:"file_search"},toolWarnings:u};case"xai.mcp":return{tools:i,toolChoice:{type:"mcp"},toolWarnings:u};default:return u.push({type:"unsupported-tool",tool:s}),{tools:i,toolChoice:void 0,toolWarnings:u}}return{tools:i,toolChoice:{type:"function",name:s.name},toolWarnings:u}}default:{const s=_;throw new te({functionality:`tool choice type: ${s}`})}}}var Ke=class{constructor(o,p){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=o,this.config=p}get provider(){return this.config.provider}async getArgs({prompt:o,maxOutputTokens:p,temperature:f,topP:u,stopSequences:i,seed:l,providerOptions:_,tools:s,toolChoice:r}){var h,k,b,R;const m=[],y=(h=await ue({provider:"xai",providerOptions:_,schema:Oe}))!=null?h:{};i!=null&&m.push({type:"unsupported-setting",setting:"stopSequences"});const C=(k=s?.find(g=>g.type==="provider-defined"&&g.id==="xai.web_search"))==null?void 0:k.name,S=(b=s?.find(g=>g.type==="provider-defined"&&g.id==="xai.x_search"))==null?void 0:b.name,d=(R=s?.find(g=>g.type==="provider-defined"&&g.id==="xai.code_execution"))==null?void 0:R.name,{input:N,inputWarnings:q}=await Ve({prompt:o});m.push(...q);const{tools:x,toolChoice:w,toolWarnings:H}=await Be({tools:s,toolChoice:r});m.push(...H);const T={model:this.modelId,input:N,max_tokens:p,temperature:f,top_p:u,seed:l,...y.reasoningEffort!=null&&{reasoning:{effort:y.reasoningEffort}},...y.store===!1&&{store:y.store,include:["reasoning.encrypted_content"]},...y.previousResponseId!=null&&{previous_response_id:y.previousResponseId}};return x&&x.length>0&&(T.tools=x),w!=null&&(T.tool_choice=w),{args:T,warnings:m,webSearchToolName:C,xSearchToolName:S,codeExecutionToolName:d}}async doGenerate(o){var p,f,u,i,l,_,s,r;const{args:h,warnings:k,webSearchToolName:b,xSearchToolName:R,codeExecutionToolName:m}=await this.getArgs(o),{responseHeaders:y,value:C,rawValue:S}=await X({url:`${(p=this.config.baseURL)!=null?p:"https://api.x.ai/v1"}/responses`,headers:W(this.config.headers(),o.headers),body:h,failedResponseHandler:z,successfulResponseHandler:ee(M),abortSignal:o.abortSignal,fetch:this.config.fetch}),d=[],N=["web_search","web_search_with_snippets","browse_page"],q=["x_user_search","x_keyword_search","x_semantic_search","x_thread_fetch"];for(const x of C.output){if(x.type==="web_search_call"||x.type==="x_search_call"||x.type==="code_interpreter_call"||x.type==="code_execution_call"||x.type==="view_image_call"||x.type==="view_x_video_call"||x.type==="custom_tool_call"){let w=(f=x.name)!=null?f:"";N.includes((u=x.name)!=null?u:"")?w=b??"web_search":q.includes((i=x.name)!=null?i:"")?w=R??"x_search":x.name==="code_execution"&&(w=m??"code_execution");const H=x.type==="custom_tool_call"?(l=x.input)!=null?l:"":(_=x.arguments)!=null?_:"";d.push({type:"tool-call",toolCallId:x.id,toolName:w,input:H,providerExecuted:!0});continue}switch(x.type){case"message":{for(const w of x.content)if(w.text&&d.push({type:"text",text:w.text}),w.annotations)for(const H of w.annotations)H.type==="url_citation"&&"url"in H&&d.push({type:"source",sourceType:"url",id:this.config.generateId(),url:H.url,title:(s=H.title)!=null?s:H.url});break}case"function_call":{d.push({type:"tool-call",toolCallId:x.call_id,toolName:x.name,input:x.arguments});break}}}return{content:d,finishReason:re(C.status),usage:{inputTokens:C.usage.input_tokens,outputTokens:C.usage.output_tokens,totalTokens:C.usage.total_tokens,reasoningTokens:(r=C.usage.output_tokens_details)==null?void 0:r.reasoning_tokens},request:{body:h},response:{...J(C),headers:y,body:S},warnings:k}}async doStream(o){var p;const{args:f,warnings:u,webSearchToolName:i,xSearchToolName:l,codeExecutionToolName:_}=await this.getArgs(o),s={...f,stream:!0},{responseHeaders:r,value:h}=await X({url:`${(p=this.config.baseURL)!=null?p:"https://api.x.ai/v1"}/responses`,headers:W(this.config.headers(),o.headers),body:s,failedResponseHandler:z,successfulResponseHandler:ce(Ue),abortSignal:o.abortSignal,fetch:this.config.fetch});let k="unknown";const b={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let R=!0;const m={},y=new Set,C=this;return{stream:h.pipeThrough(new TransformStream({start(S){S.enqueue({type:"stream-start",warnings:u})},transform(S,d){var N,q,x,w,H,T,g,E,ne;if(o.includeRawChunks&&d.enqueue({type:"raw",rawValue:S.rawValue}),!S.success){d.enqueue({type:"error",error:S.error});return}const I=S.value;if(I.type==="response.created"||I.type==="response.in_progress"){R&&(d.enqueue({type:"response-metadata",...J(I.response)}),R=!1);return}if(I.type==="response.reasoning_summary_part.added"){const a=`reasoning-${I.item_id}`;d.enqueue({type:"reasoning-start",id:a})}if(I.type==="response.reasoning_summary_text.delta"){const a=`reasoning-${I.item_id}`;d.enqueue({type:"reasoning-delta",id:a,delta:I.delta});return}if(I.type==="response.reasoning_summary_text.done"){const a=`reasoning-${I.item_id}`;d.enqueue({type:"reasoning-end",id:a})}if(I.type==="response.output_text.delta"){const a=`text-${I.item_id}`;m[a]==null&&(m[a]={type:"text"},d.enqueue({type:"text-start",id:a})),d.enqueue({type:"text-delta",id:a,delta:I.delta});return}if(I.type==="response.output_text.done"){if(I.annotations)for(const a of I.annotations)a.type==="url_citation"&&"url"in a&&d.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:a.url,title:(N=a.title)!=null?N:a.url});return}if(I.type==="response.output_text.annotation.added"){const a=I.annotation;a.type==="url_citation"&&"url"in a&&d.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:a.url,title:(q=a.title)!=null?q:a.url});return}if(I.type==="response.done"||I.type==="response.completed"){const a=I.response;a.usage&&(b.inputTokens=a.usage.input_tokens,b.outputTokens=a.usage.output_tokens,b.totalTokens=a.usage.total_tokens,b.reasoningTokens=(x=a.usage.output_tokens_details)==null?void 0:x.reasoning_tokens),a.status&&(k=re(a.status));return}if(I.type==="response.output_item.added"||I.type==="response.output_item.done"){const a=I.item;if(a.type==="web_search_call"||a.type==="x_search_call"||a.type==="code_interpreter_call"||a.type==="code_execution_call"||a.type==="view_image_call"||a.type==="view_x_video_call"||a.type==="custom_tool_call"){if(!y.has(a.id)){y.add(a.id);const $=["web_search","web_search_with_snippets","browse_page"],A=["x_user_search","x_keyword_search","x_semantic_search","x_thread_fetch"];let D=(w=a.name)!=null?w:"";$.includes((H=a.name)!=null?H:"")?D=i??"web_search":A.includes((T=a.name)!=null?T:"")?D=l??"x_search":a.name==="code_execution"&&(D=_??"code_execution");const oe=a.type==="custom_tool_call"?(g=a.input)!=null?g:"":(E=a.arguments)!=null?E:"";d.enqueue({type:"tool-input-start",id:a.id,toolName:D}),d.enqueue({type:"tool-input-delta",id:a.id,delta:oe}),d.enqueue({type:"tool-input-end",id:a.id}),d.enqueue({type:"tool-call",toolCallId:a.id,toolName:D,input:oe,providerExecuted:!0})}return}if(a.type==="message")for(const $ of a.content){if($.text&&$.text.length>0){const A=`text-${a.id}`;m[A]==null&&(m[A]={type:"text"},d.enqueue({type:"text-start",id:A})),d.enqueue({type:"text-delta",id:A,delta:$.text})}if($.annotations)for(const A of $.annotations)A.type==="url_citation"&&"url"in A&&d.enqueue({type:"source",sourceType:"url",id:C.config.generateId(),url:A.url,title:(ne=A.title)!=null?ne:A.url})}else a.type==="function_call"&&(y.has(a.call_id)||(y.add(a.call_id),d.enqueue({type:"tool-input-start",id:a.call_id,toolName:a.name}),d.enqueue({type:"tool-input-delta",id:a.call_id,delta:a.arguments}),d.enqueue({type:"tool-input-end",id:a.call_id}),d.enqueue({type:"tool-call",toolCallId:a.call_id,toolName:a.name,input:a.arguments})))}},flush(S){for(const[d,N]of Object.entries(m))N.type==="text"&&S.enqueue({type:"text-end",id:d});S.enqueue({type:"finish",finishReason:k,usage:b})}})),request:{body:s},response:{headers:r}}}},Ge=t({output:e().describe("the output of the code execution"),error:e().optional().describe("any error that occurred")}),Ye=L({id:"xai.code_execution",name:"code_execution",inputSchema:t({}).describe("no input parameters"),outputSchema:Ge}),Qe=(o={})=>Ye(o),Ze=t({description:e().describe("description of the image"),objects:v(e()).optional().describe("objects detected in the image")}),et=L({id:"xai.view_image",name:"view_image",inputSchema:t({}).describe("no input parameters"),outputSchema:Ze}),tt=(o={})=>et(o),nt=t({transcript:e().optional().describe("transcript of the video"),description:e().describe("description of the video content"),duration:n().optional().describe("duration in seconds")}),ot=L({id:"xai.view_x_video",name:"view_x_video",inputSchema:t({}).describe("no input parameters"),outputSchema:nt}),st=(o={})=>ot(o),at={codeExecution:Qe,viewImage:tt,viewXVideo:st,webSearch:We,xSearch:ze},it="2.0.39",rt={errorSchema:de,errorToMessage:o=>o.error.message};function lt(o={}){var p;const f=_e((p=o.baseURL)!=null?p:"https://api.x.ai/v1"),u=()=>ge({Authorization:`Bearer ${fe({apiKey:o.apiKey,environmentVariableName:"XAI_API_KEY",description:"xAI API key"})}`,...o.headers},`ai-sdk/xai/${it}`),i=r=>new Ee(r,{provider:"xai.chat",baseURL:f,headers:u,generateId:se,fetch:o.fetch}),l=r=>new Ke(r,{provider:"xai.responses",baseURL:f,headers:u,generateId:se,fetch:o.fetch}),_=r=>new ke(r,{provider:"xai.image",url:({path:h})=>`${f}${h}`,headers:u,fetch:o.fetch,errorStructure:rt}),s=r=>i(r);return s.specificationVersion="v2",s.languageModel=i,s.chat=i,s.responses=l,s.textEmbeddingModel=r=>{throw new me({modelId:r,modelType:"textEmbeddingModel"})},s.imageModel=_,s.image=_,s.tools=at,s}var ht=lt();export{it as VERSION,Qe as codeExecution,lt as createXai,tt as viewImage,st as viewXVideo,We as webSearch,ze as xSearch,ht as xai,at as xaiTools};
//# sourceMappingURL=index-ecgG2mIu.js.map
