import{u as j,c as he,s as T,z as F,v as ge,U as W,q as ae,l as Ce,y as ce,B as le,a as we,C as qe,d as te,g as Ge,p as me,x as re,b as de,T as Ve,w as Le,D as Je,n as Se,j as ke,F as Xe,G as Qe,H as Ze,J as Ye}from"./index-DcBAKXZ_.js";import{o as i,a as U,s as r,n as f,_ as $,d as ue,t as _e,l as b,e as q,b as K,r as Y,c as et,u as G}from"./main-C7IUlwtB.js";import"./__vite-browser-external-2447137e-qv044l9q.js";var tt=T(()=>F(i({type:b("error"),error:i({type:r(),message:r()})})));ae({errorSchema:tt,errorToMessage:e=>e.error.message});i({citations:i({enabled:q()}).optional(),title:r().optional(),context:r().optional()});i({sendReasoning:q().optional(),structuredOutputMode:$(["outputFormat","jsonTool","auto"]).optional(),thinking:i({type:K([b("enabled"),b("disabled")]),budgetTokens:f().optional()}).optional(),disableParallelToolUse:q().optional(),cacheControl:i({type:b("ephemeral"),ttl:K([b("5m"),b("1h")]).optional()}).optional(),container:i({id:r().optional(),skills:U(i({type:K([b("anthropic"),b("custom")]),skillId:r(),version:r().optional()})).optional()}).optional(),effort:$(["low","medium","high"]).optional()});var Ae=4;function nt(e){var t;const n=e?.anthropic;return(t=n?.cacheControl)!=null?t:n?.cache_control}var ot=class{constructor(){this.breakpointCount=0,this.warnings=[]}getCacheControl(e,t){const n=nt(e);if(n){if(!t.canCache){this.warnings.push({type:"unsupported-setting",setting:"cacheControl",details:`cache_control cannot be set on ${t.type}. It will be ignored.`});return}if(this.breakpointCount++,this.breakpointCount>Ae){this.warnings.push({type:"unsupported-setting",setting:"cacheControl",details:`Maximum ${Ae} cache breakpoints exceeded (found ${this.breakpointCount}). This breakpoint will be ignored.`});return}return n}}getWarnings(){return this.warnings}},st=T(()=>F(i({maxCharacters:f().optional()}))),at=T(()=>F(i({command:$(["view","create","str_replace","insert"]),path:r(),file_text:r().optional(),insert_line:f().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:U(f().int()).optional()}))),rt=j({id:"anthropic.text_editor_20250728",name:"str_replace_based_edit_tool",inputSchema:at}),it=(e={})=>rt(e),ct=T(()=>F(i({maxUses:f().optional(),allowedDomains:U(r()).optional(),blockedDomains:U(r()).optional(),userLocation:i({type:b("approximate"),city:r().optional(),region:r().optional(),country:r().optional(),timezone:r().optional()}).optional()}))),lt=T(()=>F(U(i({url:r(),title:r(),pageAge:r().nullable(),encryptedContent:r(),type:b("web_search_result")})))),dt=T(()=>F(i({query:r()}))),ut=he({id:"anthropic.web_search_20250305",name:"web_search",inputSchema:dt,outputSchema:lt}),pt=(e={})=>ut(e),ht=T(()=>F(i({maxUses:f().optional(),allowedDomains:U(r()).optional(),blockedDomains:U(r()).optional(),citations:i({enabled:q()}).optional(),maxContentTokens:f().optional()}))),mt=T(()=>F(i({type:b("web_fetch_result"),url:r(),content:i({type:b("document"),title:r(),citations:i({enabled:q()}).optional(),source:K([i({type:b("base64"),mediaType:b("application/pdf"),data:r()}),i({type:b("text"),mediaType:b("text/plain"),data:r()})])}),retrievedAt:r().nullable()}))),gt=T(()=>F(i({url:r()}))),ft=he({id:"anthropic.web_fetch_20250910",name:"web_fetch",inputSchema:gt,outputSchema:mt}),xt=(e={})=>ft(e);async function yt({tools:e,toolChoice:t,disableParallelToolUse:n,cacheControlValidator:s}){e=e?.length?e:void 0;const a=[],o=new Set,l=s||new ot;if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};const c=[];for(const h of e)switch(h.type){case"function":{const p=l.getCacheControl(h.providerOptions,{type:"tool definition",canCache:!0});c.push({name:h.name,description:h.description,input_schema:h.inputSchema,cache_control:p});break}case"provider-defined":{switch(h.id){case"anthropic.code_execution_20250522":{o.add("code-execution-2025-05-22"),c.push({type:"code_execution_20250522",name:"code_execution",cache_control:void 0});break}case"anthropic.code_execution_20250825":{o.add("code-execution-2025-08-25"),c.push({type:"code_execution_20250825",name:"code_execution"});break}case"anthropic.computer_20250124":{o.add("computer-use-2025-01-24"),c.push({name:"computer",type:"computer_20250124",display_width_px:h.args.displayWidthPx,display_height_px:h.args.displayHeightPx,display_number:h.args.displayNumber,cache_control:void 0});break}case"anthropic.computer_20241022":{o.add("computer-use-2024-10-22"),c.push({name:"computer",type:"computer_20241022",display_width_px:h.args.displayWidthPx,display_height_px:h.args.displayHeightPx,display_number:h.args.displayNumber,cache_control:void 0});break}case"anthropic.text_editor_20250124":{o.add("computer-use-2025-01-24"),c.push({name:"str_replace_editor",type:"text_editor_20250124",cache_control:void 0});break}case"anthropic.text_editor_20241022":{o.add("computer-use-2024-10-22"),c.push({name:"str_replace_editor",type:"text_editor_20241022",cache_control:void 0});break}case"anthropic.text_editor_20250429":{o.add("computer-use-2025-01-24"),c.push({name:"str_replace_based_edit_tool",type:"text_editor_20250429",cache_control:void 0});break}case"anthropic.text_editor_20250728":{const p=await ge({value:h.args,schema:st});c.push({name:"str_replace_based_edit_tool",type:"text_editor_20250728",max_characters:p.maxCharacters,cache_control:void 0});break}case"anthropic.bash_20250124":{o.add("computer-use-2025-01-24"),c.push({name:"bash",type:"bash_20250124",cache_control:void 0});break}case"anthropic.bash_20241022":{o.add("computer-use-2024-10-22"),c.push({name:"bash",type:"bash_20241022",cache_control:void 0});break}case"anthropic.memory_20250818":{o.add("context-management-2025-06-27"),c.push({name:"memory",type:"memory_20250818"});break}case"anthropic.web_fetch_20250910":{o.add("web-fetch-2025-09-10");const p=await ge({value:h.args,schema:ht});c.push({type:"web_fetch_20250910",name:"web_fetch",max_uses:p.maxUses,allowed_domains:p.allowedDomains,blocked_domains:p.blockedDomains,citations:p.citations,max_content_tokens:p.maxContentTokens,cache_control:void 0});break}case"anthropic.web_search_20250305":{const p=await ge({value:h.args,schema:ct});c.push({type:"web_search_20250305",name:"web_search",max_uses:p.maxUses,allowed_domains:p.allowedDomains,blocked_domains:p.blockedDomains,user_location:p.userLocation,cache_control:void 0});break}default:{a.push({type:"unsupported-tool",tool:h});break}}break}default:{a.push({type:"unsupported-tool",tool:h});break}}if(t==null)return{tools:c,toolChoice:n?{type:"auto",disable_parallel_tool_use:n}:void 0,toolWarnings:a,betas:o};const d=t.type;switch(d){case"auto":return{tools:c,toolChoice:{type:"auto",disable_parallel_tool_use:n},toolWarnings:a,betas:o};case"required":return{tools:c,toolChoice:{type:"any",disable_parallel_tool_use:n},toolWarnings:a,betas:o};case"none":return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};case"tool":return{tools:c,toolChoice:{type:"tool",name:t.toolName,disable_parallel_tool_use:n},toolWarnings:a,betas:o};default:{const h=d;throw new W({functionality:`tool choice type: ${h}`})}}}var _t=T(()=>F(i({type:b("code_execution_result"),stdout:r(),stderr:r(),return_code:f()}))),bt=T(()=>F(i({code:r()}))),vt=he({id:"anthropic.code_execution_20250522",name:"code_execution",inputSchema:bt,outputSchema:_t}),wt=(e={})=>vt(e),kt=T(()=>F(ue("type",[i({type:b("bash_code_execution_result"),content:U(i({type:b("bash_code_execution_output"),file_id:r()})),stdout:r(),stderr:r(),return_code:f()}),i({type:b("bash_code_execution_tool_result_error"),error_code:r()}),i({type:b("text_editor_code_execution_tool_result_error"),error_code:r()}),i({type:b("text_editor_code_execution_view_result"),content:r(),file_type:r(),num_lines:f().nullable(),start_line:f().nullable(),total_lines:f().nullable()}),i({type:b("text_editor_code_execution_create_result"),is_file_update:q()}),i({type:b("text_editor_code_execution_str_replace_result"),lines:U(r()).nullable(),new_lines:f().nullable(),new_start:f().nullable(),old_lines:f().nullable(),old_start:f().nullable()})]))),Bt=T(()=>F(ue("type",[i({type:b("bash_code_execution"),command:r()}),ue("command",[i({type:b("text_editor_code_execution"),command:b("view"),path:r()}),i({type:b("text_editor_code_execution"),command:b("create"),path:r(),file_text:r().nullish()}),i({type:b("text_editor_code_execution"),command:b("str_replace"),path:r(),old_str:r(),new_str:r()})])]))),Ct=he({id:"anthropic.code_execution_20250825",name:"code_execution",inputSchema:Bt,outputSchema:kt}),St=(e={})=>Ct(e),At=T(()=>F(i({command:r(),restart:q().optional()}))),Dt=j({id:"anthropic.bash_20241022",name:"bash",inputSchema:At}),Et=T(()=>F(i({command:r(),restart:q().optional()}))),Tt=j({id:"anthropic.bash_20250124",name:"bash",inputSchema:Et}),Ft=T(()=>F(i({action:$(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:U(f().int()).optional(),text:r().optional()}))),It=j({id:"anthropic.computer_20241022",name:"computer",inputSchema:Ft}),Ut=T(()=>F(i({action:$(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:_e([f().int(),f().int()]).optional(),duration:f().optional(),scroll_amount:f().optional(),scroll_direction:$(["up","down","left","right"]).optional(),start_coordinate:_e([f().int(),f().int()]).optional(),text:r().optional()}))),Rt=j({id:"anthropic.computer_20250124",name:"computer",inputSchema:Ut}),Mt=T(()=>F(ue("command",[i({command:b("view"),path:r(),view_range:_e([f(),f()]).optional()}),i({command:b("create"),path:r(),file_text:r()}),i({command:b("str_replace"),path:r(),old_str:r(),new_str:r()}),i({command:b("insert"),path:r(),insert_line:f(),insert_text:r()}),i({command:b("delete"),path:r()}),i({command:b("rename"),old_path:r(),new_path:r()})]))),Ot=j({id:"anthropic.memory_20250818",name:"memory",inputSchema:Mt}),Ht=T(()=>F(i({command:$(["view","create","str_replace","insert","undo_edit"]),path:r(),file_text:r().optional(),insert_line:f().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:U(f().int()).optional()}))),$t=j({id:"anthropic.text_editor_20241022",name:"str_replace_editor",inputSchema:Ht}),qt=T(()=>F(i({command:$(["view","create","str_replace","insert","undo_edit"]),path:r(),file_text:r().optional(),insert_line:f().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:U(f().int()).optional()}))),Nt=j({id:"anthropic.text_editor_20250124",name:"str_replace_editor",inputSchema:qt}),Wt=T(()=>F(i({command:$(["view","create","str_replace","insert"]),path:r(),file_text:r().optional(),insert_line:f().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:U(f().int()).optional()}))),Kt=j({id:"anthropic.text_editor_20250429",name:"str_replace_based_edit_tool",inputSchema:Wt}),Ne={bash_20241022:Dt,bash_20250124:Tt,codeExecution_20250522:wt,codeExecution_20250825:St,computer_20241022:It,computer_20250124:Rt,memory_20250818:Ot,textEditor_20241022:$t,textEditor_20250124:Nt,textEditor_20250429:Kt,textEditor_20250728:it,webFetch_20250910:xt,webSearch_20250305:pt};function jt(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}const zt=e=>new TextEncoder().encode(e);typeof Buffer<"u"&&Buffer.from;function Pt(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)}var We=(function(){function e(){this.checksum=4294967295}return e.prototype.update=function(t){var n,s;try{for(var a=jt(t),o=a.next();!o.done;o=a.next()){var l=o.value;this.checksum=this.checksum>>>8^Vt[(this.checksum^l)&255]}}catch(c){n={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return this},e.prototype.digest=function(){return(this.checksum^4294967295)>>>0},e})(),Gt=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],Vt=Pt(Gt);const Ke={},be={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),Ke[e]=t,be[t]=e}function Lt(e){if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const s=e.slice(n,n+2).toLowerCase();if(s in be)t[n/2]=be[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return t}function ee(e){let t="";for(let n=0;n<e.byteLength;n++)t+=Ke[e[n]];return t}class se{bytes;constructor(t){if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let s=7,a=Math.abs(Math.round(t));s>-1&&a>0;s--,a/=256)n[s]=a;return t<0&&De(n),new se(n)}valueOf(){const t=this.bytes.slice(0),n=t[0]&128;return n&&De(t),parseInt(ee(t),16)*(n?-1:1)}toString(){return String(this.valueOf())}}function De(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,e[t]===0);t--);}class Jt{toUtf8;fromUtf8;constructor(t,n){this.toUtf8=t,this.fromUtf8=n}format(t){const n=[];for(const o of Object.keys(t)){const l=this.fromUtf8(o);n.push(Uint8Array.from([l.byteLength]),l,this.formatHeaderValue(t[o]))}const s=new Uint8Array(n.reduce((o,l)=>o+l.byteLength,0));let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,t.value,!1),new Uint8Array(n.buffer);case"integer":const s=new DataView(new ArrayBuffer(5));return s.setUint8(0,4),s.setInt32(1,t.value,!1),new Uint8Array(s.buffer);case"long":const a=new Uint8Array(9);return a[0]=5,a.set(t.value.bytes,1),a;case"binary":const o=new DataView(new ArrayBuffer(3+t.value.byteLength));o.setUint8(0,6),o.setUint16(1,t.value.byteLength,!1);const l=new Uint8Array(o.buffer);return l.set(t.value,3),l;case"string":const c=this.fromUtf8(t.value),d=new DataView(new ArrayBuffer(3+c.byteLength));d.setUint8(0,7),d.setUint16(1,c.byteLength,!1);const h=new Uint8Array(d.buffer);return h.set(c,3),h;case"timestamp":const p=new Uint8Array(9);return p[0]=8,p.set(se.fromNumber(t.value.valueOf()).bytes,1),p;case"uuid":if(!sn.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);const u=new Uint8Array(17);return u[0]=9,u.set(Lt(t.value.replace(/\-/g,"")),1),u}}parse(t){const n={};let s=0;for(;s<t.byteLength;){const a=t.getUint8(s++),o=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+s,a));switch(s+=a,t.getUint8(s++)){case 0:n[o]={type:Te,value:!0};break;case 1:n[o]={type:Te,value:!1};break;case 2:n[o]={type:Xt,value:t.getInt8(s++)};break;case 3:n[o]={type:Qt,value:t.getInt16(s,!1)},s+=2;break;case 4:n[o]={type:Zt,value:t.getInt32(s,!1)},s+=4;break;case 5:n[o]={type:Yt,value:new se(new Uint8Array(t.buffer,t.byteOffset+s,8))},s+=8;break;case 6:const l=t.getUint16(s,!1);s+=2,n[o]={type:en,value:new Uint8Array(t.buffer,t.byteOffset+s,l)},s+=l;break;case 7:const c=t.getUint16(s,!1);s+=2,n[o]={type:tn,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+s,c))},s+=c;break;case 8:n[o]={type:nn,value:new Date(new se(new Uint8Array(t.buffer,t.byteOffset+s,8)).valueOf())},s+=8;break;case 9:const d=new Uint8Array(t.buffer,t.byteOffset+s,16);s+=16,n[o]={type:on,value:`${ee(d.subarray(0,4))}-${ee(d.subarray(4,6))}-${ee(d.subarray(6,8))}-${ee(d.subarray(8,10))}-${ee(d.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return n}}var Ee;(function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"})(Ee||(Ee={}));const Te="boolean",Xt="byte",Qt="short",Zt="integer",Yt="long",en="binary",tn="string",nn="timestamp",on="uuid",sn=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,je=4,P=je*2,Q=4,an=P+Q*2;function rn({byteLength:e,byteOffset:t,buffer:n}){if(e<an)throw new Error("Provided message too short to accommodate event stream message overhead");const s=new DataView(n,t,e),a=s.getUint32(0,!1);if(e!==a)throw new Error("Reported message length does not match received message length");const o=s.getUint32(je,!1),l=s.getUint32(P,!1),c=s.getUint32(e-Q,!1),d=new We().update(new Uint8Array(n,t,P));if(l!==d.digest())throw new Error(`The prelude checksum specified in the message (${l}) does not match the calculated CRC32 checksum (${d.digest()})`);if(d.update(new Uint8Array(n,t+P,e-(P+Q))),c!==d.digest())throw new Error(`The message checksum (${d.digest()}) did not match the expected value of ${c}`);return{headers:new DataView(n,t+P+Q,o),body:new Uint8Array(n,t+P+Q+o,a-o-(P+Q+Q))}}class cn{headerMarshaller;messageBuffer;isEndOfStream;constructor(t,n){this.headerMarshaller=new Jt(t,n),this.messageBuffer=[],this.isEndOfStream=!1}feed(t){this.messageBuffer.push(this.decode(t))}endOfStream(){this.isEndOfStream=!0}getMessage(){const t=this.messageBuffer.pop(),n=this.isEndOfStream;return{getMessage(){return t},isEndOfStream(){return n}}}getAvailableMessages(){const t=this.messageBuffer;this.messageBuffer=[];const n=this.isEndOfStream;return{getMessages(){return t},isEndOfStream(){return n}}}encode({headers:t,body:n}){const s=this.headerMarshaller.format(t),a=s.byteLength+n.byteLength+16,o=new Uint8Array(a),l=new DataView(o.buffer,o.byteOffset,o.byteLength),c=new We;return l.setUint32(0,a,!1),l.setUint32(4,s.byteLength,!1),l.setUint32(8,c.update(o.subarray(0,8)).digest(),!1),o.set(s,12),o.set(n,s.byteLength+12),l.setUint32(a-4,c.update(o.subarray(8,a-4)).digest(),!1),o}decode(t){const{headers:n,body:s}=rn(t);return{headers:this.headerMarshaller.parse(n),body:s}}formatHeaders(t){return this.headerMarshaller.format(t)}}const ln=e=>new TextEncoder().encode(e),dn=e=>{if(typeof e=="string")return e;if(typeof e!="object"||typeof e.byteOffset!="number"||typeof e.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};const ve=new TextEncoder,un={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},pn=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class hn{constructor({method:t,url:n,headers:s,body:a,accessKeyId:o,secretAccessKey:l,sessionToken:c,service:d,region:h,cache:p,datetime:u,signQuery:g,appendSessionToken:m,allHeaders:D,singleEncode:y}){if(n==null)throw new TypeError("url is a required option");if(o==null)throw new TypeError("accessKeyId is a required option");if(l==null)throw new TypeError("secretAccessKey is a required option");this.method=t||(a?"POST":"GET"),this.url=new URL(n),this.headers=new Headers(s||{}),this.body=a,this.accessKeyId=o,this.secretAccessKey=l,this.sessionToken=c;let k,x;(!d||!h)&&([k,x]=mn(this.url,this.headers)),this.service=d||k||"",this.region=h||x||"us-east-1",this.cache=p||new Map,this.datetime=u||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=g,this.appendSessionToken=m||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service==="s3"&&!this.signQuery&&!this.headers.has("X-Amz-Content-Sha256")&&this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const C=this.signQuery?this.url.searchParams:this.headers;if(C.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&C.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(_=>D||!pn.has(_)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(_=>_+":"+(_==="host"?this.url.host:(this.headers.get(_)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service==="s3"&&!C.has("X-Amz-Expires")&&C.set("X-Amz-Expires","86400"),C.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),C.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),C.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");y||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=Ue(this.encodedPath);const v=new Set;this.encodedSearch=[...this.url.searchParams].filter(([_])=>{if(!_)return!1;if(this.service==="s3"){if(v.has(_))return!1;v.add(_)}return!0}).map(_=>_.map(A=>Ue(encodeURIComponent(A)))).sort(([_,A],[I,M])=>_<I?-1:_>I?1:A<M?-1:A>M?1:0).map(_=>_.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const t=this.datetime.slice(0,8),n=[this.secretAccessKey,t,this.region,this.service].join();let s=this.cache.get(n);if(!s){const a=await oe("AWS4"+this.secretAccessKey,t),o=await oe(a,this.region),l=await oe(o,this.service);s=await oe(l,"aws4_request"),this.cache.set(n,s)}return fe(await oe(s,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,fe(await Fe(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let t=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(t==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");t=fe(await Fe(this.body||""))}return t}}async function oe(e,t){const n=await crypto.subtle.importKey("raw",typeof e=="string"?ve.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",n,ve.encode(t))}async function Fe(e){return crypto.subtle.digest("SHA-256",typeof e=="string"?ve.encode(e):e)}const Ie=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function fe(e){const t=new Uint8Array(e);let n="";for(let s=0;s<t.length;s++){const a=t[s];n+=Ie[a>>>4&15],n+=Ie[a&15]}return n}function Ue(e){return e.replace(/[!'()*]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())}function mn(e,t){const{hostname:n,pathname:s}=e;if(n.endsWith(".on.aws")){const c=n.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return c!=null?["lambda",c[1]||""]:["",""]}if(n.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(n.endsWith(".backblazeb2.com")){const c=n.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return c!=null?["s3",c[1]||""]:["",""]}const a=n.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/);let o=a&&a[1]||"",l=a&&a[2];if(l==="us-gov")l="us-gov-west-1";else if(l==="s3"||l==="s3-accelerate")l="us-east-1",o="s3";else if(o==="iot")n.startsWith("iot.")?o="execute-api":n.startsWith("data.jobs.iot.")?o="iot-jobs-data":o=s==="/mqtt"?"iotdevicegateway":"iotdata";else if(o==="autoscaling"){const c=(t.get("X-Amz-Target")||"").split(".")[0];c==="AnyScaleFrontendService"?o="application-autoscaling":c==="AnyScaleScalingPlannerFrontendService"&&(o="autoscaling-plans")}else l==null&&o.startsWith("s3-")?(l=o.slice(3).replace(/^fips-|^external-1/,""),o="s3"):o.endsWith("-fips")?o=o.slice(0,-5):l&&/-\d$/.test(o)&&!/-\d$/.test(l)&&([o,l]=[l,o]);return[un[o]||o,l||""]}var Be="3.0.65",xe={cachePoint:{type:"default"}},gn=["stop","stop_sequence","end_turn","length","max_tokens","content-filter","content_filtered","guardrail_intervened","tool-calls","tool_use"],Re={"image/jpeg":"jpeg","image/png":"png","image/gif":"gif","image/webp":"webp"},Me={"application/pdf":"pdf","text/csv":"csv","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","text/html":"html","text/plain":"txt","text/markdown":"md"},fn=i({citations:i({enabled:q()}).optional()}),xn=i({additionalModelRequestFields:Y(r(),et()).optional(),reasoningConfig:i({type:K([b("enabled"),b("disabled")]).optional(),budgetTokens:f().optional()}).optional(),anthropicBeta:U(r()).optional()}),pe=i({message:r(),type:r().nullish()}),yn=e=>async({response:t})=>{const n=Xe(t);if(t.body==null)throw new Qe({});const s=new cn(dn,ln);let a=new Uint8Array(0);const o=new TextDecoder;return{responseHeaders:n,value:t.body.pipeThrough(new TransformStream({async transform(l,c){var d,h;const p=new Uint8Array(a.length+l.length);for(p.set(a),p.set(l,a.length),a=p;a.length>=4;){const u=new DataView(a.buffer,a.byteOffset,a.byteLength).getUint32(0,!1);if(a.length<u)break;try{const g=a.subarray(0,u),m=s.decode(g);if(a=a.slice(u),((d=m.headers[":message-type"])==null?void 0:d.value)==="event"){const D=o.decode(m.body),y=await Ze({text:D});if(!y.success){c.enqueue(y);break}delete y.value.p;let k={[(h=m.headers[":event-type"])==null?void 0:h.value]:y.value};const x=await Ye({value:k,schema:e});x.success?c.enqueue({success:!0,value:x.value,rawValue:k}):c.enqueue(x)}}catch{break}}}}))}};async function _n({tools:e,toolChoice:t,modelId:n}){var s;const a=[],o=new Set;if(e==null||e.length===0)return{toolConfig:{},additionalTools:void 0,betas:o,toolWarnings:a};const l=e.filter(y=>y.type==="provider-defined"&&y.id==="anthropic.web_search_20250305"?(a.push({type:"unsupported-tool",tool:y,details:"The web_search_20250305 tool is not supported on Amazon Bedrock."}),!1):!0);if(l.length===0)return{toolConfig:{},additionalTools:void 0,betas:o,toolWarnings:a};const c=n.includes("anthropic."),d=l.filter(y=>y.type==="provider-defined"),h=l.filter(y=>y.type==="function");let p;const u=[],g=c&&d.length>0;if(g){h.length>0&&a.push({type:"unsupported-setting",setting:"tools",details:"Mixed Anthropic provider-defined tools and standard function tools are not supported in a single call to Bedrock. Only Anthropic tools will be used."});const{toolChoice:y,toolWarnings:k,betas:x}=await yt({tools:d,toolChoice:t});a.push(...k),x.forEach(C=>o.add(C)),y&&(p={tool_choice:y});for(const C of d){const v=Object.values(Ne).find(_=>_({}).id===C.id);if(v!=null){const _=v({});u.push({toolSpec:{name:C.name,inputSchema:{json:Je(_.inputSchema).jsonSchema}}})}else a.push({type:"unsupported-tool",tool:C})}}else for(const y of d)a.push({type:"unsupported-tool",tool:y});for(const y of h)u.push({toolSpec:{name:y.name,...((s=y.description)==null?void 0:s.trim())!==""?{description:y.description}:{},inputSchema:{json:y.inputSchema}}});let m;if(!g&&u.length>0&&t){const y=t.type;switch(y){case"auto":m={auto:{}};break;case"required":m={any:{}};break;case"none":u.length=0,m=void 0;break;case"tool":m={tool:{name:t.toolName}};break;default:{const k=y;throw new W({functionality:`tool choice type: ${k}`})}}}return{toolConfig:u.length>0?{tools:u,toolChoice:m}:{},additionalTools:p,betas:o,toolWarnings:a}}function ye(e){var t;return(t=e?.bedrock)==null?void 0:t.cachePoint}async function bn(e){var t,n;const s=await me({provider:"bedrock",providerOptions:e,schema:fn});return(n=(t=s?.citations)==null?void 0:t.enabled)!=null?n:!1}async function vn(e){var t;const n=kn(e);let s=[];const a=[];let o=0;const l=()=>`document-${++o}`;for(let c=0;c<n.length;c++){const d=n[c],h=c===n.length-1,p=d.type;switch(p){case"system":{if(a.length>0)throw new W({functionality:"Multiple system messages that are separated by user/assistant messages"});for(const u of d.messages)s.push({text:u.content}),ye(u.providerOptions)&&s.push(xe);break}case"user":{const u=[];for(const g of d.messages){const{role:m,content:D,providerOptions:y}=g;switch(m){case"user":{for(let k=0;k<D.length;k++){const x=D[k];switch(x.type){case"text":{u.push({text:x.text});break}case"file":{if(x.data instanceof URL)throw new W({functionality:"File URL data"});if(x.mediaType.startsWith("image/"))u.push({image:{format:Oe(x.mediaType),source:{bytes:Se(x.data)}}});else{if(!x.mediaType)throw new W({functionality:"file without mime type",message:"File mime type is required in user message part content"});const C=await bn(x.providerOptions);u.push({document:{format:wn(x.mediaType),name:(t=x.filename)!=null?t:l(),source:{bytes:Se(x.data)},...C&&{citations:{enabled:!0}}}})}break}}}break}case"tool":{for(const k of D){let x;const C=k.output;switch(C.type){case"content":{x=C.value.map(v=>{switch(v.type){case"text":return{text:v.text};case"media":if(!v.mediaType.startsWith("image/"))throw new W({functionality:`media type: ${v.mediaType}`});return{image:{format:Oe(v.mediaType),source:{bytes:v.data}}}}});break}case"text":case"error-text":x=[{text:C.value}];break;case"json":case"error-json":default:x=[{text:JSON.stringify(C.value)}];break}u.push({toolResult:{toolUseId:k.toolCallId,content:x}})}break}default:{const k=m;throw new Error(`Unsupported role: ${k}`)}}ye(y)&&u.push(xe)}a.push({role:"user",content:u});break}case"assistant":{const u=[];for(let g=0;g<d.messages.length;g++){const m=d.messages[g],D=g===d.messages.length-1,{content:y}=m;for(let k=0;k<y.length;k++){const x=y[k],C=k===y.length-1;switch(x.type){case"text":{if(!x.text.trim())break;u.push({text:He(h,D,C,x.text)});break}case"reasoning":{const v=await me({provider:"bedrock",providerOptions:x.providerOptions,schema:En});v!=null&&(v.signature!=null?u.push({reasoningContent:{reasoningText:{text:He(h,D,C,x.text),signature:v.signature}}}):v.redactedData!=null&&u.push({reasoningContent:{redactedReasoning:{data:v.redactedData}}}));break}case"tool-call":{u.push({toolUse:{toolUseId:x.toolCallId,name:x.toolName,input:x.input}});break}}}ye(m.providerOptions)&&u.push(xe)}a.push({role:"assistant",content:u});break}default:{const u=p;throw new Error(`Unsupported type: ${u}`)}}}return{system:s,messages:a}}function Oe(e){if(!e)throw new W({functionality:"image without mime type",message:"Image mime type is required in user message part content"});const t=Re[e];if(!t)throw new W({functionality:`image mime type: ${e}`,message:`Unsupported image mime type: ${e}, expected one of: ${Object.keys(Re).join(", ")}`});return t}function wn(e){const t=Me[e];if(!t)throw new W({functionality:`file mime type: ${e}`,message:`Unsupported file mime type: ${e}, expected one of: ${Object.keys(Me).join(", ")}`});return t}function He(e,t,n,s){return e&&t&&n?s.trim():s}function kn(e){const t=[];let n;for(const s of e){const{role:a}=s;switch(a){case"system":{n?.type!=="system"&&(n={type:"system",messages:[]},t.push(n)),n.messages.push(s);break}case"assistant":{n?.type!=="assistant"&&(n={type:"assistant",messages:[]},t.push(n)),n.messages.push(s);break}case"user":{n?.type!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(s);break}case"tool":{n?.type!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(s);break}default:{const o=a;throw new Error(`Unsupported role: ${o}`)}}}return t}function $e(e,t){switch(e){case"stop_sequence":case"end_turn":return"stop";case"max_tokens":return"length";case"content_filtered":case"guardrail_intervened":return"content-filter";case"tool_use":return t?"stop":"tool-calls";default:return"unknown"}}var Bn=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.provider="amazon-bedrock",this.supportedUrls={}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:s,topK:a,frequencyPenalty:o,presencePenalty:l,stopSequences:c,responseFormat:d,seed:h,tools:p,toolChoice:u,providerOptions:g}){var m,D,y,k,x,C,v;const _=(m=await me({provider:"bedrock",providerOptions:g,schema:xn}))!=null?m:{},A=[];o!=null&&A.push({type:"unsupported-setting",setting:"frequencyPenalty"}),l!=null&&A.push({type:"unsupported-setting",setting:"presencePenalty"}),h!=null&&A.push({type:"unsupported-setting",setting:"seed"}),n!=null&&n>1?(A.push({type:"unsupported-setting",setting:"temperature",details:`${n} exceeds bedrock maximum of 1.0. clamped to 1.0`}),n=1):n!=null&&n<0&&(A.push({type:"unsupported-setting",setting:"temperature",details:`${n} is below bedrock minimum of 0. clamped to 0`}),n=0),d!=null&&d.type!=="text"&&d.type!=="json"&&A.push({type:"unsupported-setting",setting:"responseFormat",details:"Only text and json response formats are supported."});const I=d?.type==="json"&&d.schema!=null?{type:"function",name:"json",description:"Respond with a JSON object.",inputSchema:d.schema}:void 0,{toolConfig:M,additionalTools:E,toolWarnings:H,betas:V}=await _n({tools:I?[...p??[],I]:p,toolChoice:I!=null?{type:"required"}:u,modelId:this.modelId});if(A.push(...H),E&&(_.additionalModelRequestFields={..._.additionalModelRequestFields,...E}),V.size>0||_.anthropicBeta){const N=(D=_.anthropicBeta)!=null?D:[],O=V.size>0?[...N,...Array.from(V)]:N;_.additionalModelRequestFields={..._.additionalModelRequestFields,anthropic_beta:O}}const L=((y=_.reasoningConfig)==null?void 0:y.type)==="enabled",J=(k=_.reasoningConfig)==null?void 0:k.budgetTokens,R={...t!=null&&{maxTokens:t},...n!=null&&{temperature:n},...s!=null&&{topP:s},...a!=null&&{topK:a},...c!=null&&{stopSequences:c}};L&&J!=null&&(R.maxTokens!=null?R.maxTokens+=J:R.maxTokens=J+4096,_.additionalModelRequestFields={..._.additionalModelRequestFields,thinking:{type:(x=_.reasoningConfig)==null?void 0:x.type,budget_tokens:J}}),L&&R.temperature!=null&&(delete R.temperature,A.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported when thinking is enabled"})),L&&R.topP!=null&&(delete R.topP,A.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported when thinking is enabled"})),L&&R.topK!=null&&(delete R.topK,A.push({type:"unsupported-setting",setting:"topK",details:"topK is not supported when thinking is enabled"}));const ie=((v=(C=M.tools)==null?void 0:C.length)!=null?v:0)>0||E;let z=e;ie||e.some(O=>"content"in O&&Array.isArray(O.content)&&O.content.some(ne=>ne.type==="tool-call"||ne.type==="tool-result"))&&(z=e.map(O=>O.role==="system"?O:{...O,content:O.content.filter(ne=>ne.type!=="tool-call"&&ne.type!=="tool-result")}).filter(O=>O.role==="system"||O.content.length>0),A.push({type:"unsupported-setting",setting:"toolContent",details:"Tool calls and results removed from conversation because Bedrock does not support tool content without active tools."}));const{system:w,messages:Z}=await vn(z),{reasoningConfig:X,additionalModelRequestFields:B,...S}=g?.bedrock||{};return{command:{system:w,messages:Z,additionalModelRequestFields:_.additionalModelRequestFields,...Object.keys(R).length>0&&{inferenceConfig:R},...S,...M.tools!==void 0&&M.tools.length>0?{toolConfig:M}:{}},warnings:A,usesJsonResponseTool:I!=null,betas:V}}async getHeaders({headers:e}){return te(await re(this.config.headers),e)}async doGenerate(e){var t,n,s,a,o,l,c,d,h,p,u,g,m,D;const{command:y,warnings:k,usesJsonResponseTool:x}=await this.getArgs(e),C=`${this.getUrl(this.modelId)}/converse`,{value:v,responseHeaders:_}=await de({url:C,headers:await this.getHeaders({headers:e.headers}),body:y,failedResponseHandler:ae({errorSchema:pe,errorToMessage:E=>{var H;return`${(H=E.message)!=null?H:"Unknown error"}`}}),successfulResponseHandler:ke(An),abortSignal:e.abortSignal,fetch:this.config.fetch}),A=[];let I=!1;for(const E of v.output.message.content){if(E.text&&A.push({type:"text",text:E.text}),E.reasoningContent)if("reasoningText"in E.reasoningContent){const H={type:"reasoning",text:E.reasoningContent.reasoningText.text};E.reasoningContent.reasoningText.signature&&(H.providerMetadata={bedrock:{signature:E.reasoningContent.reasoningText.signature}}),A.push(H)}else"redactedReasoning"in E.reasoningContent&&A.push({type:"reasoning",text:"",providerMetadata:{bedrock:{redactedData:(t=E.reasoningContent.redactedReasoning.data)!=null?t:""}}});E.toolUse&&(x&&E.toolUse.name==="json"?(I=!0,A.push({type:"text",text:JSON.stringify(E.toolUse.input)})):A.push({type:"tool-call",toolCallId:(s=(n=E.toolUse)==null?void 0:n.toolUseId)!=null?s:this.config.generateId(),toolName:(o=(a=E.toolUse)==null?void 0:a.name)!=null?o:`tool-${this.config.generateId()}`,input:JSON.stringify((c=(l=E.toolUse)==null?void 0:l.input)!=null?c:"")}))}const M=v.trace||v.usage||I?{bedrock:{...v.trace&&typeof v.trace=="object"?{trace:v.trace}:{},...((d=v.usage)==null?void 0:d.cacheWriteInputTokens)!=null&&{usage:{cacheWriteInputTokens:v.usage.cacheWriteInputTokens}},...I&&{isJsonResponseFromTool:!0}}}:void 0;return{content:A,finishReason:$e(v.stopReason,I),usage:{inputTokens:(h=v.usage)==null?void 0:h.inputTokens,outputTokens:(p=v.usage)==null?void 0:p.outputTokens,totalTokens:((u=v.usage)==null?void 0:u.inputTokens)+((g=v.usage)==null?void 0:g.outputTokens),cachedInputTokens:(D=(m=v.usage)==null?void 0:m.cacheReadInputTokens)!=null?D:void 0},response:{headers:_},warnings:k,...M&&{providerMetadata:M}}}async doStream(e){const{command:t,warnings:n,usesJsonResponseTool:s}=await this.getArgs(e),a=`${this.getUrl(this.modelId)}/converse-stream`,{value:o,responseHeaders:l}=await de({url:a,headers:await this.getHeaders({headers:e.headers}),body:t,failedResponseHandler:ae({errorSchema:pe,errorToMessage:g=>`${g.type}: ${g.message}`}),successfulResponseHandler:yn(Dn),abortSignal:e.abortSignal,fetch:this.config.fetch});let c="unknown";const d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let h,p=!1;const u={};return{stream:o.pipeThrough(new TransformStream({start(g){g.enqueue({type:"stream-start",warnings:n})},transform(g,m){var D,y,k,x,C,v,_,A,I,M,E,H,V,L,J,R,ie;function z(B){c="error",m.enqueue({type:"error",error:B})}if(e.includeRawChunks&&m.enqueue({type:"raw",rawValue:g.rawValue}),!g.success){z(g.error);return}const w=g.value;if(w.internalServerException){z(w.internalServerException);return}if(w.modelStreamErrorException){z(w.modelStreamErrorException);return}if(w.throttlingException){z(w.throttlingException);return}if(w.validationException){z(w.validationException);return}if(w.messageStop&&(c=$e(w.messageStop.stopReason,p)),w.metadata){d.inputTokens=(y=(D=w.metadata.usage)==null?void 0:D.inputTokens)!=null?y:d.inputTokens,d.outputTokens=(x=(k=w.metadata.usage)==null?void 0:k.outputTokens)!=null?x:d.outputTokens,d.totalTokens=((C=d.inputTokens)!=null?C:0)+((v=d.outputTokens)!=null?v:0),d.cachedInputTokens=(A=(_=w.metadata.usage)==null?void 0:_.cacheReadInputTokens)!=null?A:d.cachedInputTokens;const B=((I=w.metadata.usage)==null?void 0:I.cacheWriteInputTokens)!=null?{usage:{cacheWriteInputTokens:w.metadata.usage.cacheWriteInputTokens}}:void 0,S=w.metadata.trace?{trace:w.metadata.trace}:void 0;(B||S)&&(h={bedrock:{...B,...S}})}if(((M=w.contentBlockStart)==null?void 0:M.contentBlockIndex)!=null&&!((H=(E=w.contentBlockStart)==null?void 0:E.start)!=null&&H.toolUse)){const B=w.contentBlockStart.contentBlockIndex;u[B]={type:"text"},m.enqueue({type:"text-start",id:String(B)})}if((V=w.contentBlockDelta)!=null&&V.delta&&"text"in w.contentBlockDelta.delta&&w.contentBlockDelta.delta.text){const B=w.contentBlockDelta.contentBlockIndex||0;u[B]==null&&(u[B]={type:"text"},m.enqueue({type:"text-start",id:String(B)})),m.enqueue({type:"text-delta",id:String(B),delta:w.contentBlockDelta.delta.text})}if(((L=w.contentBlockStop)==null?void 0:L.contentBlockIndex)!=null){const B=w.contentBlockStop.contentBlockIndex,S=u[B];S!=null&&(S.type==="reasoning"?m.enqueue({type:"reasoning-end",id:String(B)}):S.type==="text"?m.enqueue({type:"text-end",id:String(B)}):S.type==="tool-call"&&(S.isJsonResponseTool?(p=!0,m.enqueue({type:"text-start",id:String(B)}),m.enqueue({type:"text-delta",id:String(B),delta:S.jsonText}),m.enqueue({type:"text-end",id:String(B)})):(m.enqueue({type:"tool-input-end",id:S.toolCallId}),m.enqueue({type:"tool-call",toolCallId:S.toolCallId,toolName:S.toolName,input:S.jsonText}))),delete u[B])}if((J=w.contentBlockDelta)!=null&&J.delta&&"reasoningContent"in w.contentBlockDelta.delta&&w.contentBlockDelta.delta.reasoningContent){const B=w.contentBlockDelta.contentBlockIndex||0,S=w.contentBlockDelta.delta.reasoningContent;"text"in S&&S.text?(u[B]==null&&(u[B]={type:"reasoning"},m.enqueue({type:"reasoning-start",id:String(B)})),m.enqueue({type:"reasoning-delta",id:String(B),delta:S.text})):"signature"in S&&S.signature?m.enqueue({type:"reasoning-delta",id:String(B),delta:"",providerMetadata:{bedrock:{signature:S.signature}}}):"data"in S&&S.data&&m.enqueue({type:"reasoning-delta",id:String(B),delta:"",providerMetadata:{bedrock:{redactedData:S.data}}})}const Z=w.contentBlockStart;if(((R=Z?.start)==null?void 0:R.toolUse)!=null){const B=Z.start.toolUse,S=Z.contentBlockIndex,N=s&&B.name==="json";u[S]={type:"tool-call",toolCallId:B.toolUseId,toolName:B.name,jsonText:"",isJsonResponseTool:N},N||m.enqueue({type:"tool-input-start",id:B.toolUseId,toolName:B.name})}const X=w.contentBlockDelta;if(X?.delta&&"toolUse"in X.delta&&X.delta.toolUse){const B=X.contentBlockIndex,S=u[B];if(S?.type==="tool-call"){const N=(ie=X.delta.toolUse.input)!=null?ie:"";S.isJsonResponseTool||m.enqueue({type:"tool-input-delta",id:S.toolCallId,delta:N}),S.jsonText+=N}}},flush(g){p&&(h?h.bedrock={...h.bedrock,isJsonResponseFromTool:!0}:h={bedrock:{isJsonResponseFromTool:!0}}),g.enqueue({type:"finish",finishReason:c,usage:d,...h&&{providerMetadata:h}})}})),response:{headers:l}}}getUrl(e){const t=encodeURIComponent(e);return`${this.config.baseUrl()}/model/${t}`}},ze=K([$(gn),r()]),Pe=i({toolUseId:r(),name:r(),input:G()}),Cn=i({signature:r().nullish(),text:r()}),Sn=i({data:r()}),An=i({metrics:i({latencyMs:f()}).nullish(),output:i({message:i({content:U(i({text:r().nullish(),toolUse:Pe.nullish(),reasoningContent:K([i({reasoningText:Cn}),i({redactedReasoning:Sn})]).nullish()})),role:r()})}),stopReason:ze,trace:G().nullish(),usage:i({inputTokens:f(),outputTokens:f(),totalTokens:f(),cacheReadInputTokens:f().nullish(),cacheWriteInputTokens:f().nullish()})}),Dn=i({contentBlockDelta:i({contentBlockIndex:f(),delta:K([i({text:r()}),i({toolUse:i({input:r()})}),i({reasoningContent:i({text:r()})}),i({reasoningContent:i({signature:r()})}),i({reasoningContent:i({data:r()})})]).nullish()}).nullish(),contentBlockStart:i({contentBlockIndex:f(),start:i({toolUse:Pe.nullish()}).nullish()}).nullish(),contentBlockStop:i({contentBlockIndex:f()}).nullish(),internalServerException:Y(r(),G()).nullish(),messageStop:i({additionalModelResponseFields:Y(r(),G()).nullish(),stopReason:ze}).nullish(),metadata:i({trace:G().nullish(),usage:i({cacheReadInputTokens:f().nullish(),cacheWriteInputTokens:f().nullish(),inputTokens:f(),outputTokens:f()}).nullish()}).nullish(),modelStreamErrorException:Y(r(),G()).nullish(),throttlingException:Y(r(),G()).nullish(),validationException:Y(r(),G()).nullish()}),En=i({signature:r().optional(),redactedData:r().optional()}),Tn=i({dimensions:K([b(1024),b(512),b(256)]).optional(),normalize:q().optional()}),Fn=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.provider="amazon-bedrock",this.maxEmbeddingsPerCall=1,this.supportsParallelCalls=!0}getUrl(e){const t=encodeURIComponent(e);return`${this.config.baseUrl()}/model/${t}/invoke`}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:s}){var a;if(e.length>this.maxEmbeddingsPerCall)throw new Ve({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const o=(a=await me({provider:"bedrock",providerOptions:s,schema:Tn}))!=null?a:{},l={inputText:e[0],dimensions:o.dimensions,normalize:o.normalize},c=this.getUrl(this.modelId),{value:d}=await de({url:c,headers:await re(te(await re(this.config.headers),t)),body:l,failedResponseHandler:ae({errorSchema:pe,errorToMessage:h=>`${h.type}: ${h.message}`}),successfulResponseHandler:ke(In),fetch:this.config.fetch,abortSignal:n});return{embeddings:[d.embedding],usage:{tokens:d.inputTextTokenCount}}}},In=i({embedding:U(f()),inputTextTokenCount:f()}),Un={"amazon.nova-canvas-v1:0":5},Rn=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.provider="amazon-bedrock"}get maxImagesPerCall(){var e;return(e=Un[this.modelId])!=null?e:1}getUrl(e){const t=encodeURIComponent(e);return`${this.config.baseUrl()}/model/${t}/invoke`}async doGenerate({prompt:e,n:t,size:n,aspectRatio:s,seed:a,providerOptions:o,headers:l,abortSignal:c}){var d,h,p,u,g,m,D;const y=[],[k,x]=n?n.split("x").map(Number):[],C={taskType:"TEXT_IMAGE",textToImageParams:{text:e,...(d=o?.bedrock)!=null&&d.negativeText?{negativeText:o.bedrock.negativeText}:{},...(h=o?.bedrock)!=null&&h.style?{style:o.bedrock.style}:{}},imageGenerationConfig:{...k?{width:k}:{},...x?{height:x}:{},...a?{seed:a}:{},...t?{numberOfImages:t}:{},...(p=o?.bedrock)!=null&&p.quality?{quality:o.bedrock.quality}:{},...(u=o?.bedrock)!=null&&u.cfgScale?{cfgScale:o.bedrock.cfgScale}:{}}};s!=null&&y.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."});const v=(D=(m=(g=this.config._internal)==null?void 0:g.currentDate)==null?void 0:m.call(g))!=null?D:new Date,{value:_,responseHeaders:A}=await de({url:this.getUrl(this.modelId),headers:await re(te(await re(this.config.headers),l)),body:C,failedResponseHandler:ae({errorSchema:pe,errorToMessage:I=>`${I.type}: ${I.message}`}),successfulResponseHandler:ke(Mn),abortSignal:c,fetch:this.config.fetch});return{images:_.images,warnings:y,response:{timestamp:v,modelId:this.modelId,headers:A}}}},Mn=i({images:U(r())});function On(e,t=globalThis.fetch){return async(n,s)=>{var a,o;const l=n instanceof Request?n:void 0,c=te(le(l?.headers),le(s?.headers)),d=we(c,`ai-sdk/amazon-bedrock/${Be}`,qe());let h=(a=s?.body)!=null?a:void 0;if(h===void 0&&l&&l.body!==null)try{h=await l.clone().text()}catch{}const p=(o=s?.method)!=null?o:l?.method;if(p?.toUpperCase()!=="POST"||!h)return t(n,{...s,headers:d});const u=typeof n=="string"?n:n instanceof URL?n.href:n.url,g=Hn(h),m=await e(),y=await new hn({url:u,method:"POST",headers:Object.entries(d),body:g,region:m.region,accessKeyId:m.accessKeyId,secretAccessKey:m.secretAccessKey,sessionToken:m.sessionToken,service:"bedrock"}).sign(),k=le(y.headers),x=te(d,k);return t(n,{...s,body:g,headers:x})}}function Hn(e){return typeof e=="string"?e:e instanceof Uint8Array?new TextDecoder().decode(e):e instanceof ArrayBuffer?new TextDecoder().decode(new Uint8Array(e)):JSON.stringify(e)}function $n(e,t=globalThis.fetch){return async(n,s)=>{const a=le(s?.headers),o=we(a,`ai-sdk/amazon-bedrock/${Be}`,qe()),l=te(o,{Authorization:`Bearer ${e}`});return t(n,{...s,headers:l})}}function qn(e={}){const t=Ce({settingValue:e.apiKey,environmentVariableName:"AWS_BEARER_TOKEN_BEDROCK"}),n=t&&t.trim().length>0?t.trim():void 0,s=n?$n(n,e.fetch):On(async()=>{const p=ce({settingValue:e.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"});if(e.credentialProvider)try{return{...await e.credentialProvider(),region:p}}catch(u){const g=u instanceof Error?u.message:String(u);throw new Error(`AWS credential provider failed: ${g}. Please ensure your credential provider returns valid AWS credentials with accessKeyId and secretAccessKey properties.`)}try{return{region:p,accessKeyId:ce({settingValue:e.accessKeyId,settingName:"accessKeyId",environmentVariableName:"AWS_ACCESS_KEY_ID",description:"AWS access key ID"}),secretAccessKey:ce({settingValue:e.secretAccessKey,settingName:"secretAccessKey",environmentVariableName:"AWS_SECRET_ACCESS_KEY",description:"AWS secret access key"}),sessionToken:Ce({settingValue:e.sessionToken,environmentVariableName:"AWS_SESSION_TOKEN"})}}catch(u){const g=u instanceof Error?u.message:String(u);throw g.includes("AWS_ACCESS_KEY_ID")||g.includes("accessKeyId")?new Error(`AWS SigV4 authentication requires AWS credentials. Please provide either:
1. Set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables
2. Provide accessKeyId and secretAccessKey in options
3. Use a credentialProvider function
4. Use API key authentication with AWS_BEARER_TOKEN_BEDROCK or apiKey option
Original error: ${g}`):g.includes("AWS_SECRET_ACCESS_KEY")||g.includes("secretAccessKey")?new Error(`AWS SigV4 authentication requires both AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY. Please ensure both credentials are provided.
Original error: ${g}`):u}},e.fetch),a=()=>{var p,u;return(u=Le((p=e.baseURL)!=null?p:`https://bedrock-runtime.${ce({settingValue:e.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"})}.amazonaws.com`))!=null?u:"https://bedrock-runtime.us-east-1.amazonaws.com"},o=()=>{var p;const u=(p=e.headers)!=null?p:{};return we(u,`ai-sdk/amazon-bedrock/${Be}`)},l=p=>new Bn(p,{baseUrl:a,headers:o,fetch:s,generateId:Ge}),c=function(p){if(new.target)throw new Error("The Amazon Bedrock model function cannot be called with the new keyword.");return l(p)},d=p=>new Fn(p,{baseUrl:a,headers:o,fetch:s}),h=p=>new Rn(p,{baseUrl:a,headers:o,fetch:s});return c.languageModel=l,c.embedding=d,c.textEmbedding=d,c.textEmbeddingModel=d,c.image=h,c.imageModel=h,c.tools=Ne,c}var jn=qn();export{Be as VERSION,jn as bedrock,qn as createAmazonBedrock};
//# sourceMappingURL=index-PeS6wpEN.js.map
