import{w as We,l as De,c as ce,a as He,p as ue,b as le,d as oe,g as te,I as ge,i as ke,T as Ve,e as ze,m as Ue,f as Je,h as Le,j as me,k as fe,n as de,U as ae,o as Be,A as Fe,q as Ge,r as Ke,s as J,z as R,t as B,v as pe}from"./index-DCLtZRWp.js";import{o,a as I,d as U,s as e,l as p,r as Y,n as s,u as Oe,b as Q,c as ye,_ as P,e as F,f as Xe,g as Ye}from"./main-D4-rBj0Y.js";import"./__vite-browser-external-2447137e-qv044l9q.js";var ve=o({error:o({message:e(),type:e().nullish(),param:ye().nullish(),code:Q([e(),s()]).nullish()})}),ie=Ge({errorSchema:ve,errorToMessage:t=>t.error.message});function Qe({prompt:t,systemMessageMode:u="system"}){const _=[],m=[];for(const{role:h,content:f}of t)switch(h){case"system":{switch(u){case"system":{_.push({role:"system",content:f});break}case"developer":{_.push({role:"developer",content:f});break}case"remove":{m.push({type:"other",message:"system messages are removed for this model"});break}default:{const l=u;throw new Error(`Unsupported system message mode: ${l}`)}}break}case"user":{if(f.length===1&&f[0].type==="text"){_.push({role:"user",content:f[0].text});break}_.push({role:"user",content:f.map((l,a)=>{var d,v,k;switch(l.type){case"text":return{type:"text",text:l.text};case"file":if(l.mediaType.startsWith("image/")){const T=l.mediaType==="image/*"?"image/jpeg":l.mediaType;return{type:"image_url",image_url:{url:l.data instanceof URL?l.data.toString():`data:${T};base64,${de(l.data)}`,detail:(v=(d=l.providerOptions)==null?void 0:d.openai)==null?void 0:v.imageDetail}}}else if(l.mediaType.startsWith("audio/")){if(l.data instanceof URL)throw new ae({functionality:"audio file parts with URLs"});switch(l.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:de(l.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:de(l.data),format:"mp3"}};default:throw new ae({functionality:`audio content parts with media type ${l.mediaType}`})}}else if(l.mediaType==="application/pdf"){if(l.data instanceof URL)throw new ae({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof l.data=="string"&&l.data.startsWith("file-")?{file_id:l.data}:{filename:(k=l.filename)!=null?k:`part-${a}.pdf`,file_data:`data:application/pdf;base64,${de(l.data)}`}}}else throw new ae({functionality:`file part media type ${l.mediaType}`})}})});break}case"assistant":{let l="";const a=[];for(const d of f)switch(d.type){case"text":{l+=d.text;break}case"tool-call":{a.push({id:d.toolCallId,type:"function",function:{name:d.toolName,arguments:JSON.stringify(d.input)}});break}}_.push({role:"assistant",content:l,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const l of f){const a=l.output;let d;switch(a.type){case"text":case"error-text":d=a.value;break;case"content":case"json":case"error-json":d=JSON.stringify(a.value);break}_.push({role:"tool",tool_call_id:l.toolCallId,content:d})}break}default:{const l=h;throw new Error(`Unsupported role: ${l}`)}}return{messages:_,warnings:m}}function _e({id:t,model:u,created:_}){return{id:t??void 0,modelId:u??void 0,timestamp:_?new Date(_*1e3):void 0}}function xe(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Ze=B(()=>R(o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({message:o({role:p("assistant").nullish(),content:e().nullish(),tool_calls:I(o({id:e().nullish(),type:p("function"),function:o({name:e(),arguments:e()})})).nullish(),annotations:I(o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()})).nullish()}),index:s(),logprobs:o({content:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}).nullish(),finish_reason:e().nullish()})),usage:o({prompt_tokens:s().nullish(),completion_tokens:s().nullish(),total_tokens:s().nullish(),prompt_tokens_details:o({cached_tokens:s().nullish()}).nullish(),completion_tokens_details:o({reasoning_tokens:s().nullish(),accepted_prediction_tokens:s().nullish(),rejected_prediction_tokens:s().nullish()}).nullish()}).nullish()}))),et=B(()=>R(Q([o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({delta:o({role:P(["assistant"]).nullish(),content:e().nullish(),tool_calls:I(o({index:s(),id:e().nullish(),type:p("function").nullish(),function:o({name:e().nullish(),arguments:e().nullish()})})).nullish(),annotations:I(o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()})).nullish()}).nullish(),logprobs:o({content:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}).nullish(),finish_reason:e().nullish(),index:s()})),usage:o({prompt_tokens:s().nullish(),completion_tokens:s().nullish(),total_tokens:s().nullish(),prompt_tokens_details:o({cached_tokens:s().nullish()}).nullish(),completion_tokens_details:o({reasoning_tokens:s().nullish(),accepted_prediction_tokens:s().nullish(),rejected_prediction_tokens:s().nullish()}).nullish()}).nullish()}),ve]))),tt=B(()=>R(o({logitBias:Y(Ye(),s()).optional(),logprobs:Q([F(),s()]).optional(),parallelToolCalls:F().optional(),user:e().optional(),reasoningEffort:P(["none","minimal","low","medium","high"]).optional(),maxCompletionTokens:s().optional(),store:F().optional(),metadata:Y(e().max(64),e().max(512)).optional(),prediction:Y(e(),ye()).optional(),structuredOutputs:F().optional(),serviceTier:P(["auto","flex","priority","default"]).optional(),strictJsonSchema:F().optional(),textVerbosity:P(["low","medium","high"]).optional(),promptCacheKey:e().optional(),promptCacheRetention:P(["in_memory","24h"]).optional(),safetyIdentifier:e().optional()})));function nt({tools:t,toolChoice:u,structuredOutputs:_,strictJsonSchema:m}){t=t?.length?t:void 0;const h=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:h};const f=[];for(const a of t)switch(a.type){case"function":f.push({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema,strict:_?m:void 0}});break;default:h.push({type:"unsupported-tool",tool:a});break}if(u==null)return{tools:f,toolChoice:void 0,toolWarnings:h};const l=u.type;switch(l){case"auto":case"none":case"required":return{tools:f,toolChoice:l,toolWarnings:h};case"tool":return{tools:f,toolChoice:{type:"function",function:{name:u.toolName}},toolWarnings:h};default:{const a=l;throw new ae({functionality:`tool choice type: ${a}`})}}}var ot=class{constructor(t,u){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=t,this.config=u}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:u,temperature:_,topP:m,topK:h,frequencyPenalty:f,presencePenalty:l,stopSequences:a,responseFormat:d,seed:v,tools:k,toolChoice:T,providerOptions:b}){var r,g,y,c;const x=[],w=(r=await ue({provider:"openai",providerOptions:b,schema:tt}))!=null?r:{},i=(g=w.structuredOutputs)!=null?g:!0;h!=null&&x.push({type:"unsupported-setting",setting:"topK"}),d?.type==="json"&&d.schema!=null&&!i&&x.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{messages:A,warnings:V}=Qe({prompt:t,systemMessageMode:at(this.modelId)});x.push(...V);const j=(y=w.strictJsonSchema)!=null?y:!1,S={model:this.modelId,logit_bias:w.logitBias,logprobs:w.logprobs===!0||typeof w.logprobs=="number"?!0:void 0,top_logprobs:typeof w.logprobs=="number"?w.logprobs:typeof w.logprobs=="boolean"&&w.logprobs?0:void 0,user:w.user,parallel_tool_calls:w.parallelToolCalls,max_tokens:u,temperature:_,top_p:m,frequency_penalty:f,presence_penalty:l,response_format:d?.type==="json"?i&&d.schema!=null?{type:"json_schema",json_schema:{schema:d.schema,strict:j,name:(c=d.name)!=null?c:"response",description:d.description}}:{type:"json_object"}:void 0,stop:a,seed:v,verbosity:w.textVerbosity,max_completion_tokens:w.maxCompletionTokens,store:w.store,metadata:w.metadata,prediction:w.prediction,reasoning_effort:w.reasoningEffort,service_tier:w.serviceTier,prompt_cache_key:w.promptCacheKey,prompt_cache_retention:w.promptCacheRetention,safety_identifier:w.safetyIdentifier,messages:A};Ee(this.modelId)?(S.temperature!=null&&(S.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),S.top_p!=null&&(S.top_p=void 0,x.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),S.frequency_penalty!=null&&(S.frequency_penalty=void 0,x.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),S.presence_penalty!=null&&(S.presence_penalty=void 0,x.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),S.logit_bias!=null&&(S.logit_bias=void 0,x.push({type:"other",message:"logitBias is not supported for reasoning models"})),S.logprobs!=null&&(S.logprobs=void 0,x.push({type:"other",message:"logprobs is not supported for reasoning models"})),S.top_logprobs!=null&&(S.top_logprobs=void 0,x.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),S.max_tokens!=null&&(S.max_completion_tokens==null&&(S.max_completion_tokens=S.max_tokens),S.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&S.temperature!=null&&(S.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),w.serviceTier==="flex"&&!it(this.modelId)&&(x.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),S.service_tier=void 0),w.serviceTier==="priority"&&!st(this.modelId)&&(x.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),S.service_tier=void 0);const{tools:W,toolChoice:D,toolWarnings:$}=nt({tools:k,toolChoice:T,structuredOutputs:i,strictJsonSchema:j});return{args:{...S,tools:W,tool_choice:D},warnings:[...x,...$]}}async doGenerate(t){var u,_,m,h,f,l,a,d,v,k,T,b,r,g;const{args:y,warnings:c}=await this.getArgs(t),{responseHeaders:x,value:w,rawValue:i}=await le({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:y,failedResponseHandler:ie,successfulResponseHandler:me(Ze),abortSignal:t.abortSignal,fetch:this.config.fetch}),A=w.choices[0],V=[],j=A.message.content;j!=null&&j.length>0&&V.push({type:"text",text:j});for(const $ of(u=A.message.tool_calls)!=null?u:[])V.push({type:"tool-call",toolCallId:(_=$.id)!=null?_:te(),toolName:$.function.name,input:$.function.arguments});for(const $ of(m=A.message.annotations)!=null?m:[])V.push({type:"source",sourceType:"url",id:te(),url:$.url,title:$.title});const S=(h=w.usage)==null?void 0:h.completion_tokens_details,W=(f=w.usage)==null?void 0:f.prompt_tokens_details,D={openai:{}};return S?.accepted_prediction_tokens!=null&&(D.openai.acceptedPredictionTokens=S?.accepted_prediction_tokens),S?.rejected_prediction_tokens!=null&&(D.openai.rejectedPredictionTokens=S?.rejected_prediction_tokens),((l=A.logprobs)==null?void 0:l.content)!=null&&(D.openai.logprobs=A.logprobs.content),{content:V,finishReason:xe(A.finish_reason),usage:{inputTokens:(d=(a=w.usage)==null?void 0:a.prompt_tokens)!=null?d:void 0,outputTokens:(k=(v=w.usage)==null?void 0:v.completion_tokens)!=null?k:void 0,totalTokens:(b=(T=w.usage)==null?void 0:T.total_tokens)!=null?b:void 0,reasoningTokens:(r=S?.reasoning_tokens)!=null?r:void 0,cachedInputTokens:(g=W?.cached_tokens)!=null?g:void 0},request:{body:y},response:{..._e(w),headers:x,body:i},warnings:c,providerMetadata:D}}async doStream(t){const{args:u,warnings:_}=await this.getArgs(t),m={...u,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:h,value:f}=await le({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:m,failedResponseHandler:ie,successfulResponseHandler:fe(et),abortSignal:t.abortSignal,fetch:this.config.fetch}),l=[];let a="unknown";const d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let v=!1,k=!1;const T={openai:{}};return{stream:f.pipeThrough(new TransformStream({start(b){b.enqueue({type:"stream-start",warnings:_})},transform(b,r){var g,y,c,x,w,i,A,V,j,S,W,D,$,Z,K,z,se,X,ne,O,ee,H,re,E;if(t.includeRawChunks&&r.enqueue({type:"raw",rawValue:b.rawValue}),!b.success){a="error",r.enqueue({type:"error",error:b.error});return}const N=b.value;if("error"in N){a="error",r.enqueue({type:"error",error:N.error});return}if(!v){const M=_e(N);Object.values(M).some(Boolean)&&(v=!0,r.enqueue({type:"response-metadata",..._e(N)}))}N.usage!=null&&(d.inputTokens=(g=N.usage.prompt_tokens)!=null?g:void 0,d.outputTokens=(y=N.usage.completion_tokens)!=null?y:void 0,d.totalTokens=(c=N.usage.total_tokens)!=null?c:void 0,d.reasoningTokens=(w=(x=N.usage.completion_tokens_details)==null?void 0:x.reasoning_tokens)!=null?w:void 0,d.cachedInputTokens=(A=(i=N.usage.prompt_tokens_details)==null?void 0:i.cached_tokens)!=null?A:void 0,((V=N.usage.completion_tokens_details)==null?void 0:V.accepted_prediction_tokens)!=null&&(T.openai.acceptedPredictionTokens=(j=N.usage.completion_tokens_details)==null?void 0:j.accepted_prediction_tokens),((S=N.usage.completion_tokens_details)==null?void 0:S.rejected_prediction_tokens)!=null&&(T.openai.rejectedPredictionTokens=(W=N.usage.completion_tokens_details)==null?void 0:W.rejected_prediction_tokens));const L=N.choices[0];if(L?.finish_reason!=null&&(a=xe(L.finish_reason)),((D=L?.logprobs)==null?void 0:D.content)!=null&&(T.openai.logprobs=L.logprobs.content),L?.delta==null)return;const G=L.delta;if(G.content!=null&&(k||(r.enqueue({type:"text-start",id:"0"}),k=!0),r.enqueue({type:"text-delta",id:"0",delta:G.content})),G.tool_calls!=null)for(const M of G.tool_calls){const n=M.index;if(l[n]==null){if(M.type!=="function")throw new ge({data:M,message:"Expected 'function' type."});if(M.id==null)throw new ge({data:M,message:"Expected 'id' to be a string."});if((($=M.function)==null?void 0:$.name)==null)throw new ge({data:M,message:"Expected 'function.name' to be a string."});r.enqueue({type:"tool-input-start",id:M.id,toolName:M.function.name}),l[n]={id:M.id,type:"function",function:{name:M.function.name,arguments:(Z=M.function.arguments)!=null?Z:""},hasFinished:!1};const q=l[n];((K=q.function)==null?void 0:K.name)!=null&&((z=q.function)==null?void 0:z.arguments)!=null&&(q.function.arguments.length>0&&r.enqueue({type:"tool-input-delta",id:q.id,delta:q.function.arguments}),ke(q.function.arguments)&&(r.enqueue({type:"tool-input-end",id:q.id}),r.enqueue({type:"tool-call",toolCallId:(se=q.id)!=null?se:te(),toolName:q.function.name,input:q.function.arguments}),q.hasFinished=!0));continue}const C=l[n];C.hasFinished||(((X=M.function)==null?void 0:X.arguments)!=null&&(C.function.arguments+=(O=(ne=M.function)==null?void 0:ne.arguments)!=null?O:""),r.enqueue({type:"tool-input-delta",id:C.id,delta:(ee=M.function.arguments)!=null?ee:""}),((H=C.function)==null?void 0:H.name)!=null&&((re=C.function)==null?void 0:re.arguments)!=null&&ke(C.function.arguments)&&(r.enqueue({type:"tool-input-end",id:C.id}),r.enqueue({type:"tool-call",toolCallId:(E=C.id)!=null?E:te(),toolName:C.function.name,input:C.function.arguments}),C.hasFinished=!0))}if(G.annotations!=null)for(const M of G.annotations)r.enqueue({type:"source",sourceType:"url",id:te(),url:M.url,title:M.title})},flush(b){k&&b.enqueue({type:"text-end",id:"0"}),b.enqueue({type:"finish",finishReason:a,usage:d,...T!=null?{providerMetadata:T}:{}})}})),request:{body:m},response:{headers:h}}}};function Ee(t){return(t.startsWith("o")||t.startsWith("gpt-5"))&&!t.startsWith("gpt-5-chat")}function it(t){return t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat")}function st(t){return t.startsWith("gpt-4")||t.startsWith("gpt-5-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-nano")&&!t.startsWith("gpt-5-chat")||t.startsWith("o3")||t.startsWith("o4-mini")}function at(t){var u,_;return Ee(t)?(_=(u=lt[t])==null?void 0:u.systemMessageMode)!=null?_:"developer":"system"}var lt={o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function rt({prompt:t,user:u="user",assistant:_="assistant"}){let m="";t[0].role==="system"&&(m+=`${t[0].content}

`,t=t.slice(1));for(const{role:h,content:f}of t)switch(h){case"system":throw new Be({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const l=f.map(a=>{switch(a.type){case"text":return a.text}}).filter(Boolean).join("");m+=`${u}:
${l}

`;break}case"assistant":{const l=f.map(a=>{switch(a.type){case"text":return a.text;case"tool-call":throw new ae({functionality:"tool-call messages"})}}).join("");m+=`${_}:
${l}

`;break}case"tool":throw new ae({functionality:"tool messages"});default:{const l=h;throw new Error(`Unsupported role: ${l}`)}}return m+=`${_}:
`,{prompt:m,stopSequences:[`
${u}:`]}}function we({id:t,model:u,created:_}){return{id:t??void 0,modelId:u??void 0,timestamp:_!=null?new Date(_*1e3):void 0}}function Ie(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ut=B(()=>R(o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({text:e(),finish_reason:e(),logprobs:o({tokens:I(e()),token_logprobs:I(s()),top_logprobs:I(Y(e(),s())).nullish()}).nullish()})),usage:o({prompt_tokens:s(),completion_tokens:s(),total_tokens:s()}).nullish()}))),pt=B(()=>R(Q([o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({text:e(),finish_reason:e().nullish(),index:s(),logprobs:o({tokens:I(e()),token_logprobs:I(s()),top_logprobs:I(Y(e(),s())).nullish()}).nullish()})),usage:o({prompt_tokens:s(),completion_tokens:s(),total_tokens:s()}).nullish()}),ve]))),Se=B(()=>R(o({echo:F().optional(),logitBias:Y(e(),s()).optional(),suffix:e().optional(),user:e().optional(),logprobs:Q([F(),s()]).optional()}))),dt=class{constructor(t,u){this.specificationVersion="v2",this.supportedUrls={},this.modelId=t,this.config=u}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:u,temperature:_,topP:m,topK:h,frequencyPenalty:f,presencePenalty:l,stopSequences:a,responseFormat:d,tools:v,toolChoice:k,seed:T,providerOptions:b}){const r=[],g={...await ue({provider:"openai",providerOptions:b,schema:Se}),...await ue({provider:this.providerOptionsName,providerOptions:b,schema:Se})};h!=null&&r.push({type:"unsupported-setting",setting:"topK"}),v?.length&&r.push({type:"unsupported-setting",setting:"tools"}),k!=null&&r.push({type:"unsupported-setting",setting:"toolChoice"}),d!=null&&d.type!=="text"&&r.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:y,stopSequences:c}=rt({prompt:t}),x=[...c??[],...a??[]];return{args:{model:this.modelId,echo:g.echo,logit_bias:g.logitBias,logprobs:g?.logprobs===!0?0:g?.logprobs===!1?void 0:g?.logprobs,suffix:g.suffix,user:g.user,max_tokens:u,temperature:_,top_p:m,frequency_penalty:f,presence_penalty:l,seed:T,prompt:y,stop:x.length>0?x:void 0},warnings:r}}async doGenerate(t){var u,_,m;const{args:h,warnings:f}=await this.getArgs(t),{responseHeaders:l,value:a,rawValue:d}=await le({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:h,failedResponseHandler:ie,successfulResponseHandler:me(ut),abortSignal:t.abortSignal,fetch:this.config.fetch}),v=a.choices[0],k={openai:{}};return v.logprobs!=null&&(k.openai.logprobs=v.logprobs),{content:[{type:"text",text:v.text}],usage:{inputTokens:(u=a.usage)==null?void 0:u.prompt_tokens,outputTokens:(_=a.usage)==null?void 0:_.completion_tokens,totalTokens:(m=a.usage)==null?void 0:m.total_tokens},finishReason:Ie(v.finish_reason),request:{body:h},response:{...we(a),headers:l,body:d},providerMetadata:k,warnings:f}}async doStream(t){const{args:u,warnings:_}=await this.getArgs(t),m={...u,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:h,value:f}=await le({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:m,failedResponseHandler:ie,successfulResponseHandler:fe(pt),abortSignal:t.abortSignal,fetch:this.config.fetch});let l="unknown";const a={openai:{}},d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let v=!0;return{stream:f.pipeThrough(new TransformStream({start(k){k.enqueue({type:"stream-start",warnings:_})},transform(k,T){if(t.includeRawChunks&&T.enqueue({type:"raw",rawValue:k.rawValue}),!k.success){l="error",T.enqueue({type:"error",error:k.error});return}const b=k.value;if("error"in b){l="error",T.enqueue({type:"error",error:b.error});return}v&&(v=!1,T.enqueue({type:"response-metadata",...we(b)}),T.enqueue({type:"text-start",id:"0"})),b.usage!=null&&(d.inputTokens=b.usage.prompt_tokens,d.outputTokens=b.usage.completion_tokens,d.totalTokens=b.usage.total_tokens);const r=b.choices[0];r?.finish_reason!=null&&(l=Ie(r.finish_reason)),r?.logprobs!=null&&(a.openai.logprobs=r.logprobs),r?.text!=null&&r.text.length>0&&T.enqueue({type:"text-delta",id:"0",delta:r.text})},flush(k){v||k.enqueue({type:"text-end",id:"0"}),k.enqueue({type:"finish",finishReason:l,providerMetadata:a,usage:d})}})),request:{body:m},response:{headers:h}}}},ct=B(()=>R(o({dimensions:s().optional(),user:e().optional()}))),mt=B(()=>R(o({data:I(o({embedding:I(s())})),usage:o({prompt_tokens:s()}).nullish()}))),ht=class{constructor(t,u){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=t,this.config=u}get provider(){return this.config.provider}async doEmbed({values:t,headers:u,abortSignal:_,providerOptions:m}){var h;if(t.length>this.maxEmbeddingsPerCall)throw new Ve({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const f=(h=await ue({provider:"openai",providerOptions:m,schema:ct}))!=null?h:{},{responseHeaders:l,value:a,rawValue:d}=await le({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:oe(this.config.headers(),u),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:f.dimensions,user:f.user},failedResponseHandler:ie,successfulResponseHandler:me(mt),abortSignal:_,fetch:this.config.fetch});return{embeddings:a.data.map(v=>v.embedding),usage:a.usage?{tokens:a.usage.prompt_tokens}:void 0,response:{headers:l,body:d}}}},gt=B(()=>R(o({created:s().nullish(),data:I(o({b64_json:e(),revised_prompt:e().nullish()})),background:e().nullish(),output_format:e().nullish(),size:e().nullish(),quality:e().nullish(),usage:o({input_tokens:s().nullish(),output_tokens:s().nullish(),total_tokens:s().nullish(),input_tokens_details:o({image_tokens:s().nullish(),text_tokens:s().nullish()}).nullish()}).nullish()}))),_t={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10},ft=new Set(["gpt-image-1","gpt-image-1-mini"]),yt=class{constructor(t,u){this.modelId=t,this.config=u,this.specificationVersion="v2"}get maxImagesPerCall(){var t;return(t=_t[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:t,n:u,size:_,aspectRatio:m,seed:h,providerOptions:f,headers:l,abortSignal:a}){var d,v,k,T;const b=[];m!=null&&b.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),h!=null&&b.push({type:"unsupported-setting",setting:"seed"});const r=(k=(v=(d=this.config._internal)==null?void 0:d.currentDate)==null?void 0:v.call(d))!=null?k:new Date,{value:g,responseHeaders:y}=await le({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:oe(this.config.headers(),l),body:{model:this.modelId,prompt:t,n:u,size:_,...(T=f.openai)!=null?T:{},...ft.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:ie,successfulResponseHandler:me(gt),abortSignal:a,fetch:this.config.fetch});return{images:g.data.map(c=>c.b64_json),warnings:b,response:{timestamp:r,modelId:this.modelId,headers:y},providerMetadata:{openai:{images:g.data.map(c=>({...c.revised_prompt?{revisedPrompt:c.revised_prompt}:{},...g.created!=null?{created:g.created}:{},...g.size!=null?{size:g.size}:{},...g.quality!=null?{quality:g.quality}:{},...g.background!=null?{background:g.background}:{},...g.output_format!=null?{outputFormat:g.output_format}:{}}))}}}}},vt=J(()=>R(o({code:e().nullish(),containerId:e()}))),bt=J(()=>R(o({outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullish()}))),kt=J(()=>R(o({container:Q([e(),o({fileIds:I(e()).optional()})]).optional()}))),xt=ce({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:vt,outputSchema:bt}),wt=(t={})=>xt(t),Ne=o({key:e(),type:P(["eq","ne","gt","gte","lt","lte"]),value:Q([e(),s(),F()])}),Pe=o({type:P(["and","or"]),filters:I(Q([Ne,Xe(()=>Pe)]))}),It=J(()=>R(o({vectorStoreIds:I(e()),maxNumResults:s().optional(),ranking:o({ranker:e().optional(),scoreThreshold:s().optional()}).optional(),filters:Q([Ne,Pe]).optional()}))),St=J(()=>R(o({queries:I(e()),results:I(o({attributes:Y(e(),Oe()),fileId:e(),filename:e(),score:s(),text:e()})).nullable()}))),Ct=ce({id:"openai.file_search",name:"file_search",inputSchema:o({}),outputSchema:St}),Tt=J(()=>R(o({background:P(["auto","opaque","transparent"]).optional(),inputFidelity:P(["low","high"]).optional(),inputImageMask:o({fileId:e().optional(),imageUrl:e().optional()}).optional(),model:e().optional(),moderation:P(["auto"]).optional(),outputCompression:s().int().min(0).max(100).optional(),outputFormat:P(["png","jpeg","webp"]).optional(),partialImages:s().int().min(0).max(3).optional(),quality:P(["auto","low","medium","high"]).optional(),size:P(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),qt=J(()=>R(o({}))),Rt=J(()=>R(o({result:e()}))),Mt=ce({id:"openai.image_generation",name:"image_generation",inputSchema:qt,outputSchema:Rt}),Ot=(t={})=>Mt(t),$e=J(()=>R(o({action:o({type:p("exec"),command:I(e()),timeoutMs:s().optional(),user:e().optional(),workingDirectory:e().optional(),env:Y(e(),e()).optional()})}))),Ae=J(()=>R(o({output:e()}))),Et=ce({id:"openai.local_shell",name:"local_shell",inputSchema:$e,outputSchema:Ae}),Nt=J(()=>R(o({externalWebAccess:F().optional(),filters:o({allowedDomains:I(e()).optional()}).optional(),searchContextSize:P(["low","medium","high"]).optional(),userLocation:o({type:p("approximate"),country:e().optional(),city:e().optional(),region:e().optional(),timezone:e().optional()}).optional()}))),Pt=J(()=>R(o({}))),$t=J(()=>R(o({action:U("type",[o({type:p("search"),query:e().optional()}),o({type:p("openPage"),url:e()}),o({type:p("find"),url:e(),pattern:e()})]),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).optional()}))),At=ce({id:"openai.web_search",name:"web_search",inputSchema:Pt,outputSchema:$t}),jt=(t={})=>At(t),Wt=J(()=>R(o({searchContextSize:P(["low","medium","high"]).optional(),userLocation:o({type:p("approximate"),country:e().optional(),city:e().optional(),region:e().optional(),timezone:e().optional()}).optional()}))),Dt=J(()=>R(o({}))),Ht=J(()=>R(o({action:U("type",[o({type:p("search"),query:e().optional()}),o({type:p("openPage"),url:e()}),o({type:p("find"),url:e(),pattern:e()})])}))),Vt=ce({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:Dt,outputSchema:Ht}),zt={codeInterpreter:wt,fileSearch:Ct,imageGeneration:Ot,localShell:Et,webSearchPreview:Vt,webSearch:jt};function Ce(t,u){return u?u.some(_=>t.startsWith(_)):!1}async function Ut({prompt:t,systemMessageMode:u,fileIdPrefixes:_,store:m,hasLocalShellTool:h=!1}){var f,l,a,d;const v=[],k=[];for(const{role:T,content:b}of t)switch(T){case"system":{switch(u){case"system":{v.push({role:"system",content:b});break}case"developer":{v.push({role:"developer",content:b});break}case"remove":{k.push({type:"other",message:"system messages are removed for this model"});break}default:{const r=u;throw new Error(`Unsupported system message mode: ${r}`)}}break}case"user":{v.push({role:"user",content:b.map((r,g)=>{var y,c,x;switch(r.type){case"text":return{type:"input_text",text:r.text};case"file":if(r.mediaType.startsWith("image/")){const w=r.mediaType==="image/*"?"image/jpeg":r.mediaType;return{type:"input_image",...r.data instanceof URL?{image_url:r.data.toString()}:typeof r.data=="string"&&Ce(r.data,_)?{file_id:r.data}:{image_url:`data:${w};base64,${de(r.data)}`},detail:(c=(y=r.providerOptions)==null?void 0:y.openai)==null?void 0:c.imageDetail}}else{if(r.mediaType==="application/pdf")return r.data instanceof URL?{type:"input_file",file_url:r.data.toString()}:{type:"input_file",...typeof r.data=="string"&&Ce(r.data,_)?{file_id:r.data}:{filename:(x=r.filename)!=null?x:`part-${g}.pdf`,file_data:`data:application/pdf;base64,${de(r.data)}`}};throw new ae({functionality:`file part media type ${r.mediaType}`})}}})});break}case"assistant":{const r={},g={};for(const y of b)switch(y.type){case"text":{const c=(l=(f=y.providerOptions)==null?void 0:f.openai)==null?void 0:l.itemId;if(m&&c!=null){v.push({type:"item_reference",id:c});break}v.push({role:"assistant",content:[{type:"output_text",text:y.text}],id:c});break}case"tool-call":{if(g[y.toolCallId]=y,y.providerExecuted)break;const c=(d=(a=y.providerOptions)==null?void 0:a.openai)==null?void 0:d.itemId;if(m&&c!=null){v.push({type:"item_reference",id:c});break}if(h&&y.toolName==="local_shell"){const x=await pe({value:y.input,schema:$e});v.push({type:"local_shell_call",call_id:y.toolCallId,id:c,action:{type:"exec",command:x.action.command,timeout_ms:x.action.timeoutMs,user:x.action.user,working_directory:x.action.workingDirectory,env:x.action.env}});break}v.push({type:"function_call",call_id:y.toolCallId,name:y.toolName,arguments:JSON.stringify(y.input),id:c});break}case"tool-result":{m?v.push({type:"item_reference",id:y.toolCallId}):k.push({type:"other",message:`Results for OpenAI tool ${y.toolName} are not sent to the API when store is false`});break}case"reasoning":{const c=await ue({provider:"openai",providerOptions:y.providerOptions,schema:Jt}),x=c?.itemId;if(x!=null){const w=r[x];if(m)w===void 0&&(v.push({type:"item_reference",id:x}),r[x]={type:"reasoning",id:x,summary:[]});else{const i=[];y.text.length>0?i.push({type:"summary_text",text:y.text}):w!==void 0&&k.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(y)}.`}),w===void 0?(r[x]={type:"reasoning",id:x,encrypted_content:c?.reasoningEncryptedContent,summary:i},v.push(r[x])):(w.summary.push(...i),c?.reasoningEncryptedContent!=null&&(w.encrypted_content=c.reasoningEncryptedContent))}}else k.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(y)}.`});break}}break}case"tool":{for(const r of b){const g=r.output;if(h&&r.toolName==="local_shell"&&g.type==="json"){const c=await pe({value:g.value,schema:Ae});v.push({type:"local_shell_call_output",call_id:r.toolCallId,output:c.output});break}let y;switch(g.type){case"text":case"error-text":y=g.value;break;case"json":case"error-json":y=JSON.stringify(g.value);break;case"content":y=g.value.map(c=>{switch(c.type){case"text":return{type:"input_text",text:c.text};case"media":return c.mediaType.startsWith("image/")?{type:"input_image",image_url:`data:${c.mediaType};base64,${c.data}`}:{type:"input_file",filename:"data",file_data:`data:${c.mediaType};base64,${c.data}`}}});break}v.push({type:"function_call_output",call_id:r.toolCallId,output:y})}break}default:{const r=T;throw new Error(`Unsupported role: ${r}`)}}return{input:v,warnings:k}}var Jt=o({itemId:e().nullish(),reasoningEncryptedContent:e().nullish()});function Te({finishReason:t,hasFunctionCall:u}){switch(t){case void 0:case null:return u?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return u?"tool-calls":"unknown"}}var Lt=B(()=>R(Q([o({type:p("response.output_text.delta"),item_id:e(),delta:e(),logprobs:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}),o({type:P(["response.completed","response.incomplete"]),response:o({incomplete_details:o({reason:e()}).nullish(),usage:o({input_tokens:s(),input_tokens_details:o({cached_tokens:s().nullish()}).nullish(),output_tokens:s(),output_tokens_details:o({reasoning_tokens:s().nullish()}).nullish()}),service_tier:e().nullish()})}),o({type:p("response.created"),response:o({id:e(),created_at:s(),model:e(),service_tier:e().nullish()})}),o({type:p("response.output_item.added"),output_index:s(),item:U("type",[o({type:p("message"),id:e()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish()}),o({type:p("function_call"),id:e(),call_id:e(),name:e(),arguments:e()}),o({type:p("web_search_call"),id:e(),status:e()}),o({type:p("computer_call"),id:e(),status:e()}),o({type:p("file_search_call"),id:e()}),o({type:p("image_generation_call"),id:e()}),o({type:p("code_interpreter_call"),id:e(),container_id:e(),code:e().nullable(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable(),status:e()})])}),o({type:p("response.output_item.done"),output_index:s(),item:U("type",[o({type:p("message"),id:e()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish()}),o({type:p("function_call"),id:e(),call_id:e(),name:e(),arguments:e(),status:p("completed")}),o({type:p("code_interpreter_call"),id:e(),code:e().nullable(),container_id:e(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable()}),o({type:p("image_generation_call"),id:e(),result:e()}),o({type:p("web_search_call"),id:e(),status:e(),action:U("type",[o({type:p("search"),query:e().nullish(),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).nullish()}),o({type:p("open_page"),url:e()}),o({type:p("find"),url:e(),pattern:e()})])}),o({type:p("file_search_call"),id:e(),queries:I(e()),results:I(o({attributes:Y(e(),Oe()),file_id:e(),filename:e(),score:s(),text:e()})).nullish()}),o({type:p("local_shell_call"),id:e(),call_id:e(),action:o({type:p("exec"),command:I(e()),timeout_ms:s().optional(),user:e().optional(),working_directory:e().optional(),env:Y(e(),e()).optional()})}),o({type:p("computer_call"),id:e(),status:p("completed")})])}),o({type:p("response.function_call_arguments.delta"),item_id:e(),output_index:s(),delta:e()}),o({type:p("response.image_generation_call.partial_image"),item_id:e(),output_index:s(),partial_image_b64:e()}),o({type:p("response.code_interpreter_call_code.delta"),item_id:e(),output_index:s(),delta:e()}),o({type:p("response.code_interpreter_call_code.done"),item_id:e(),output_index:s(),code:e()}),o({type:p("response.output_text.annotation.added"),annotation:U("type",[o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()}),o({type:p("file_citation"),file_id:e(),filename:e().nullish(),index:s().nullish(),start_index:s().nullish(),end_index:s().nullish(),quote:e().nullish()})])}),o({type:p("response.reasoning_summary_part.added"),item_id:e(),summary_index:s()}),o({type:p("response.reasoning_summary_text.delta"),item_id:e(),summary_index:s(),delta:e()}),o({type:p("response.reasoning_summary_part.done"),item_id:e(),summary_index:s()}),o({type:p("error"),sequence_number:s(),error:o({type:e(),code:e(),message:e(),param:e().nullish()})}),o({type:e()}).loose().transform(t=>({type:"unknown_chunk",message:t.type}))]))),Bt=B(()=>R(o({id:e().optional(),created_at:s().optional(),error:o({message:e(),type:e(),param:e().nullish(),code:e()}).nullish(),model:e().optional(),output:I(U("type",[o({type:p("message"),role:p("assistant"),id:e(),content:I(o({type:p("output_text"),text:e(),logprobs:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish(),annotations:I(U("type",[o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()}),o({type:p("file_citation"),file_id:e(),filename:e().nullish(),index:s().nullish(),start_index:s().nullish(),end_index:s().nullish(),quote:e().nullish()}),o({type:p("container_file_citation"),container_id:e(),file_id:e(),filename:e().nullish(),start_index:s().nullish(),end_index:s().nullish(),index:s().nullish()}),o({type:p("file_path"),file_id:e(),index:s().nullish()})]))}))}),o({type:p("web_search_call"),id:e(),status:e(),action:U("type",[o({type:p("search"),query:e().nullish(),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).nullish()}),o({type:p("open_page"),url:e()}),o({type:p("find"),url:e(),pattern:e()})])}),o({type:p("file_search_call"),id:e(),queries:I(e()),results:I(o({attributes:Y(e(),Q([e(),s(),F()])),file_id:e(),filename:e(),score:s(),text:e()})).nullish()}),o({type:p("code_interpreter_call"),id:e(),code:e().nullable(),container_id:e(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable()}),o({type:p("image_generation_call"),id:e(),result:e()}),o({type:p("local_shell_call"),id:e(),call_id:e(),action:o({type:p("exec"),command:I(e()),timeout_ms:s().optional(),user:e().optional(),working_directory:e().optional(),env:Y(e(),e()).optional()})}),o({type:p("function_call"),call_id:e(),name:e(),arguments:e(),id:e()}),o({type:p("computer_call"),id:e(),status:e().optional()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish(),summary:I(o({type:p("summary_text"),text:e()}))})])).optional(),service_tier:e().nullish(),incomplete_details:o({reason:e()}).nullish(),usage:o({input_tokens:s(),input_tokens_details:o({cached_tokens:s().nullish()}).nullish(),output_tokens:s(),output_tokens_details:o({reasoning_tokens:s().nullish()}).nullish()}).optional()}))),je=20,Ft=B(()=>R(o({conversation:e().nullish(),include:I(P(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:e().nullish(),logprobs:Q([F(),s().min(1).max(je)]).optional(),maxToolCalls:s().nullish(),metadata:ye().nullish(),parallelToolCalls:F().nullish(),previousResponseId:e().nullish(),promptCacheKey:e().nullish(),promptCacheRetention:P(["in_memory","24h"]).nullish(),reasoningEffort:e().nullish(),reasoningSummary:e().nullish(),safetyIdentifier:e().nullish(),serviceTier:P(["auto","flex","priority","default"]).nullish(),store:F().nullish(),strictJsonSchema:F().nullish(),textVerbosity:P(["low","medium","high"]).nullish(),truncation:P(["auto","disabled"]).nullish(),user:e().nullish()})));async function Gt({tools:t,toolChoice:u,strictJsonSchema:_}){t=t?.length?t:void 0;const m=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:m};const h=[];for(const l of t)switch(l.type){case"function":h.push({type:"function",name:l.name,description:l.description,parameters:l.inputSchema,strict:_});break;case"provider-defined":{switch(l.id){case"openai.file_search":{const a=await pe({value:l.args,schema:It});h.push({type:"file_search",vector_store_ids:a.vectorStoreIds,max_num_results:a.maxNumResults,ranking_options:a.ranking?{ranker:a.ranking.ranker,score_threshold:a.ranking.scoreThreshold}:void 0,filters:a.filters});break}case"openai.local_shell":{h.push({type:"local_shell"});break}case"openai.web_search_preview":{const a=await pe({value:l.args,schema:Wt});h.push({type:"web_search_preview",search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.web_search":{const a=await pe({value:l.args,schema:Nt});h.push({type:"web_search",filters:a.filters!=null?{allowed_domains:a.filters.allowedDomains}:void 0,external_web_access:a.externalWebAccess,search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.code_interpreter":{const a=await pe({value:l.args,schema:kt});h.push({type:"code_interpreter",container:a.container==null?{type:"auto",file_ids:void 0}:typeof a.container=="string"?a.container:{type:"auto",file_ids:a.container.fileIds}});break}case"openai.image_generation":{const a=await pe({value:l.args,schema:Tt});h.push({type:"image_generation",background:a.background,input_fidelity:a.inputFidelity,input_image_mask:a.inputImageMask?{file_id:a.inputImageMask.fileId,image_url:a.inputImageMask.imageUrl}:void 0,model:a.model,size:a.size,quality:a.quality,moderation:a.moderation,output_format:a.outputFormat,output_compression:a.outputCompression});break}}break}default:m.push({type:"unsupported-tool",tool:l});break}if(u==null)return{tools:h,toolChoice:void 0,toolWarnings:m};const f=u.type;switch(f){case"auto":case"none":case"required":return{tools:h,toolChoice:f,toolWarnings:m};case"tool":return{tools:h,toolChoice:u.toolName==="code_interpreter"||u.toolName==="file_search"||u.toolName==="image_generation"||u.toolName==="web_search_preview"||u.toolName==="web_search"?{type:u.toolName}:{type:"function",name:u.toolName},toolWarnings:m};default:{const l=f;throw new ae({functionality:`tool choice type: ${l}`})}}}var Kt=class{constructor(t,u){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=t,this.config=u}get provider(){return this.config.provider}async getArgs({maxOutputTokens:t,temperature:u,stopSequences:_,topP:m,topK:h,presencePenalty:f,frequencyPenalty:l,seed:a,prompt:d,providerOptions:v,tools:k,toolChoice:T,responseFormat:b}){var r,g,y,c;const x=[],w=an(this.modelId);h!=null&&x.push({type:"unsupported-setting",setting:"topK"}),a!=null&&x.push({type:"unsupported-setting",setting:"seed"}),f!=null&&x.push({type:"unsupported-setting",setting:"presencePenalty"}),l!=null&&x.push({type:"unsupported-setting",setting:"frequencyPenalty"}),_!=null&&x.push({type:"unsupported-setting",setting:"stopSequences"});const i=await ue({provider:"openai",providerOptions:v,schema:Ft});i?.conversation&&i?.previousResponseId&&x.push({type:"unsupported-setting",setting:"conversation",details:"conversation and previousResponseId cannot be used together"});const{input:A,warnings:V}=await Ut({prompt:d,systemMessageMode:w.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:(r=i?.store)!=null?r:!0,hasLocalShellTool:D("openai.local_shell")});x.push(...V);const j=(g=i?.strictJsonSchema)!=null?g:!1;let S=i?.include;function W(O){S==null?S=[O]:S.includes(O)||(S=[...S,O])}function D(O){return k?.find(ee=>ee.type==="provider-defined"&&ee.id===O)!=null}const $=typeof i?.logprobs=="number"?i?.logprobs:i?.logprobs===!0?je:void 0;$&&W("message.output_text.logprobs");const Z=(y=k?.find(O=>O.type==="provider-defined"&&(O.id==="openai.web_search"||O.id==="openai.web_search_preview")))==null?void 0:y.name;Z&&W("web_search_call.action.sources"),D("openai.code_interpreter")&&W("code_interpreter_call.outputs");const K=i?.store;K===!1&&w.isReasoningModel&&W("reasoning.encrypted_content");const z={model:this.modelId,input:A,temperature:u,top_p:m,max_output_tokens:t,...(b?.type==="json"||i?.textVerbosity)&&{text:{...b?.type==="json"&&{format:b.schema!=null?{type:"json_schema",strict:j,name:(c=b.name)!=null?c:"response",description:b.description,schema:b.schema}:{type:"json_object"}},...i?.textVerbosity&&{verbosity:i.textVerbosity}}},conversation:i?.conversation,max_tool_calls:i?.maxToolCalls,metadata:i?.metadata,parallel_tool_calls:i?.parallelToolCalls,previous_response_id:i?.previousResponseId,store:K,user:i?.user,instructions:i?.instructions,service_tier:i?.serviceTier,include:S,prompt_cache_key:i?.promptCacheKey,prompt_cache_retention:i?.promptCacheRetention,safety_identifier:i?.safetyIdentifier,top_logprobs:$,truncation:i?.truncation,...w.isReasoningModel&&(i?.reasoningEffort!=null||i?.reasoningSummary!=null)&&{reasoning:{...i?.reasoningEffort!=null&&{effort:i.reasoningEffort},...i?.reasoningSummary!=null&&{summary:i.reasoningSummary}}}};w.isReasoningModel?(z.temperature!=null&&(z.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),z.top_p!=null&&(z.top_p=void 0,x.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):(i?.reasoningEffort!=null&&x.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),i?.reasoningSummary!=null&&x.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),i?.serviceTier==="flex"&&!w.supportsFlexProcessing&&(x.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete z.service_tier),i?.serviceTier==="priority"&&!w.supportsPriorityProcessing&&(x.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete z.service_tier);const{tools:se,toolChoice:X,toolWarnings:ne}=await Gt({tools:k,toolChoice:T,strictJsonSchema:j});return{webSearchToolName:Z,args:{...z,tools:se,tool_choice:X},warnings:[...x,...ne],store:K}}async doGenerate(t){var u,_,m,h,f,l,a,d,v,k,T,b,r,g,y,c,x,w,i,A,V,j,S,W,D,$,Z,K;const{args:z,warnings:se,webSearchToolName:X}=await this.getArgs(t),ne=this.config.url({path:"/responses",modelId:this.modelId}),O=this.config.provider.replace(".responses",""),{responseHeaders:ee,value:H,rawValue:re}=await le({url:ne,headers:oe(this.config.headers(),t.headers),body:z,failedResponseHandler:ie,successfulResponseHandler:me(Bt),abortSignal:t.abortSignal,fetch:this.config.fetch});if(H.error)throw new Fe({message:H.error.message,url:ne,requestBodyValues:z,statusCode:400,responseHeaders:ee,responseBody:re,isRetryable:!1});const E=[],N=[];let L=!1;for(const n of H.output)switch(n.type){case"reasoning":{n.summary.length===0&&n.summary.push({type:"summary_text",text:""});for(const C of n.summary)E.push({type:"reasoning",text:C.text,providerMetadata:{[O]:{itemId:n.id,reasoningEncryptedContent:(u=n.encrypted_content)!=null?u:null}}});break}case"image_generation_call":{E.push({type:"tool-call",toolCallId:n.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),E.push({type:"tool-result",toolCallId:n.id,toolName:"image_generation",result:{result:n.result},providerExecuted:!0});break}case"local_shell_call":{E.push({type:"tool-call",toolCallId:n.call_id,toolName:"local_shell",input:JSON.stringify({action:n.action}),providerMetadata:{[O]:{itemId:n.id}}});break}case"message":{for(const C of n.content){(m=(_=t.providerOptions)==null?void 0:_.openai)!=null&&m.logprobs&&C.logprobs&&N.push(C.logprobs),E.push({type:"text",text:C.text,providerMetadata:{[O]:{itemId:n.id}}});for(const q of C.annotations)q.type==="url_citation"?E.push({type:"source",sourceType:"url",id:(l=(f=(h=this.config).generateId)==null?void 0:f.call(h))!=null?l:te(),url:q.url,title:q.title}):q.type==="file_citation"?E.push({type:"source",sourceType:"document",id:(v=(d=(a=this.config).generateId)==null?void 0:d.call(a))!=null?v:te(),mediaType:"text/plain",title:(T=(k=q.quote)!=null?k:q.filename)!=null?T:"Document",filename:(b=q.filename)!=null?b:q.file_id,...q.file_id?{providerMetadata:{[O]:{fileId:q.file_id}}}:{}}):q.type==="container_file_citation"?E.push({type:"source",sourceType:"document",id:(y=(g=(r=this.config).generateId)==null?void 0:g.call(r))!=null?y:te(),mediaType:"text/plain",title:(x=(c=q.filename)!=null?c:q.file_id)!=null?x:"Document",filename:(w=q.filename)!=null?w:q.file_id,providerMetadata:{[O]:{fileId:q.file_id,containerId:q.container_id,...q.index!=null?{index:q.index}:{}}}}):q.type==="file_path"&&E.push({type:"source",sourceType:"document",id:(V=(A=(i=this.config).generateId)==null?void 0:A.call(i))!=null?V:te(),mediaType:"application/octet-stream",title:q.file_id,filename:q.file_id,providerMetadata:{[O]:{fileId:q.file_id,...q.index!=null?{index:q.index}:{}}}})}break}case"function_call":{L=!0,E.push({type:"tool-call",toolCallId:n.call_id,toolName:n.name,input:n.arguments,providerMetadata:{[O]:{itemId:n.id}}});break}case"web_search_call":{E.push({type:"tool-call",toolCallId:n.id,toolName:X??"web_search",input:JSON.stringify({}),providerExecuted:!0}),E.push({type:"tool-result",toolCallId:n.id,toolName:X??"web_search",result:Re(n.action),providerExecuted:!0});break}case"computer_call":{E.push({type:"tool-call",toolCallId:n.id,toolName:"computer_use",input:"",providerExecuted:!0}),E.push({type:"tool-result",toolCallId:n.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:n.status||"completed"},providerExecuted:!0});break}case"file_search_call":{E.push({type:"tool-call",toolCallId:n.id,toolName:"file_search",input:"{}",providerExecuted:!0}),E.push({type:"tool-result",toolCallId:n.id,toolName:"file_search",result:{queries:n.queries,results:(S=(j=n.results)==null?void 0:j.map(C=>({attributes:C.attributes,fileId:C.file_id,filename:C.filename,score:C.score,text:C.text})))!=null?S:null},providerExecuted:!0});break}case"code_interpreter_call":{E.push({type:"tool-call",toolCallId:n.id,toolName:"code_interpreter",input:JSON.stringify({code:n.code,containerId:n.container_id}),providerExecuted:!0}),E.push({type:"tool-result",toolCallId:n.id,toolName:"code_interpreter",result:{outputs:n.outputs},providerExecuted:!0});break}}const G={[O]:{...H.id!=null?{responseId:H.id}:{}}};N.length>0&&(G[O].logprobs=N),typeof H.service_tier=="string"&&(G[O].serviceTier=H.service_tier);const M=H.usage;return{content:E,finishReason:Te({finishReason:(W=H.incomplete_details)==null?void 0:W.reason,hasFunctionCall:L}),usage:{inputTokens:M.input_tokens,outputTokens:M.output_tokens,totalTokens:M.input_tokens+M.output_tokens,reasoningTokens:($=(D=M.output_tokens_details)==null?void 0:D.reasoning_tokens)!=null?$:void 0,cachedInputTokens:(K=(Z=M.input_tokens_details)==null?void 0:Z.cached_tokens)!=null?K:void 0},request:{body:z},response:{id:H.id,timestamp:new Date(H.created_at*1e3),modelId:H.model,headers:ee,body:re},providerMetadata:G,warnings:se}}async doStream(t){const{args:u,warnings:_,webSearchToolName:m,store:h}=await this.getArgs(t),{responseHeaders:f,value:l}=await le({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:{...u,stream:!0},failedResponseHandler:ie,successfulResponseHandler:fe(Lt),abortSignal:t.abortSignal,fetch:this.config.fetch}),a=this,d=this.config.provider.replace(".responses","");let v="unknown";const k={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},T=[];let b=null;const r={},g=[];let y=!1;const c={};let x;return{stream:l.pipeThrough(new TransformStream({start(w){w.enqueue({type:"stream-start",warnings:_})},transform(w,i){var A,V,j,S,W,D,$,Z,K,z,se,X,ne,O,ee,H,re,E,N,L,G,M;if(t.includeRawChunks&&i.enqueue({type:"raw",rawValue:w.rawValue}),!w.success){v="error",i.enqueue({type:"error",error:w.error});return}const n=w.value;if(qe(n))n.item.type==="function_call"?(r[n.output_index]={toolName:n.item.name,toolCallId:n.item.call_id},i.enqueue({type:"tool-input-start",id:n.item.call_id,toolName:n.item.name})):n.item.type==="web_search_call"?(r[n.output_index]={toolName:m??"web_search",toolCallId:n.item.id},i.enqueue({type:"tool-input-start",id:n.item.id,toolName:m??"web_search",providerExecuted:!0}),i.enqueue({type:"tool-input-end",id:n.item.id}),i.enqueue({type:"tool-call",toolCallId:n.item.id,toolName:m??"web_search",input:JSON.stringify({}),providerExecuted:!0})):n.item.type==="computer_call"?(r[n.output_index]={toolName:"computer_use",toolCallId:n.item.id},i.enqueue({type:"tool-input-start",id:n.item.id,toolName:"computer_use",providerExecuted:!0})):n.item.type==="code_interpreter_call"?(r[n.output_index]={toolName:"code_interpreter",toolCallId:n.item.id,codeInterpreter:{containerId:n.item.container_id}},i.enqueue({type:"tool-input-start",id:n.item.id,toolName:"code_interpreter",providerExecuted:!0}),i.enqueue({type:"tool-input-delta",id:n.item.id,delta:`{"containerId":"${n.item.container_id}","code":"`})):n.item.type==="file_search_call"?i.enqueue({type:"tool-call",toolCallId:n.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):n.item.type==="image_generation_call"?i.enqueue({type:"tool-call",toolCallId:n.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):n.item.type==="message"?(g.splice(0,g.length),i.enqueue({type:"text-start",id:n.item.id,providerMetadata:{[d]:{itemId:n.item.id}}})):qe(n)&&n.item.type==="reasoning"&&(c[n.item.id]={encryptedContent:n.item.encrypted_content,summaryParts:{0:"active"}},i.enqueue({type:"reasoning-start",id:`${n.item.id}:0`,providerMetadata:{[d]:{itemId:n.item.id,reasoningEncryptedContent:(A=n.item.encrypted_content)!=null?A:null}}}));else if(Yt(n)){if(n.item.type==="message")i.enqueue({type:"text-end",id:n.item.id,providerMetadata:{[d]:{itemId:n.item.id,...g.length>0&&{annotations:g}}}});else if(n.item.type==="function_call")r[n.output_index]=void 0,y=!0,i.enqueue({type:"tool-input-end",id:n.item.call_id}),i.enqueue({type:"tool-call",toolCallId:n.item.call_id,toolName:n.item.name,input:n.item.arguments,providerMetadata:{[d]:{itemId:n.item.id}}});else if(n.item.type==="web_search_call")r[n.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:n.item.id,toolName:m??"web_search",result:Re(n.item.action),providerExecuted:!0});else if(n.item.type==="computer_call")r[n.output_index]=void 0,i.enqueue({type:"tool-input-end",id:n.item.id}),i.enqueue({type:"tool-call",toolCallId:n.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),i.enqueue({type:"tool-result",toolCallId:n.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:n.item.status||"completed"},providerExecuted:!0});else if(n.item.type==="file_search_call")r[n.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:n.item.id,toolName:"file_search",result:{queries:n.item.queries,results:(j=(V=n.item.results)==null?void 0:V.map(C=>({attributes:C.attributes,fileId:C.file_id,filename:C.filename,score:C.score,text:C.text})))!=null?j:null},providerExecuted:!0});else if(n.item.type==="code_interpreter_call")r[n.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:n.item.id,toolName:"code_interpreter",result:{outputs:n.item.outputs},providerExecuted:!0});else if(n.item.type==="image_generation_call")i.enqueue({type:"tool-result",toolCallId:n.item.id,toolName:"image_generation",result:{result:n.item.result},providerExecuted:!0});else if(n.item.type==="local_shell_call")r[n.output_index]=void 0,i.enqueue({type:"tool-call",toolCallId:n.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:n.item.action.command,timeoutMs:n.item.action.timeout_ms,user:n.item.action.user,workingDirectory:n.item.action.working_directory,env:n.item.action.env}}),providerMetadata:{[d]:{itemId:n.item.id}}});else if(n.item.type==="reasoning"){const C=c[n.item.id],q=Object.entries(C.summaryParts).filter(([he,be])=>be==="active"||be==="can-conclude").map(([he])=>he);for(const he of q)i.enqueue({type:"reasoning-end",id:`${n.item.id}:${he}`,providerMetadata:{[d]:{itemId:n.item.id,reasoningEncryptedContent:(S=n.item.encrypted_content)!=null?S:null}}});delete c[n.item.id]}}else if(en(n)){const C=r[n.output_index];C!=null&&i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:n.delta})}else if(tn(n)){const C=r[n.output_index];C!=null&&i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:JSON.stringify(n.delta).slice(1,-1)})}else if(nn(n)){const C=r[n.output_index];C!=null&&(i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:'"}'}),i.enqueue({type:"tool-input-end",id:C.toolCallId}),i.enqueue({type:"tool-call",toolCallId:C.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:n.code,containerId:C.codeInterpreter.containerId}),providerExecuted:!0}))}else if(Zt(n))b=n.response.id,i.enqueue({type:"response-metadata",id:n.response.id,timestamp:new Date(n.response.created_at*1e3),modelId:n.response.model});else if(Xt(n))i.enqueue({type:"text-delta",id:n.item_id,delta:n.delta}),(D=(W=t.providerOptions)==null?void 0:W.openai)!=null&&D.logprobs&&n.logprobs&&T.push(n.logprobs);else if(n.type==="response.reasoning_summary_part.added"){if(n.summary_index>0){const C=c[n.item_id];C.summaryParts[n.summary_index]="active";for(const q of Object.keys(C.summaryParts))C.summaryParts[q]==="can-conclude"&&(i.enqueue({type:"reasoning-end",id:`${n.item_id}:${q}`,providerMetadata:{[d]:{itemId:n.item_id}}}),C.summaryParts[q]="concluded");i.enqueue({type:"reasoning-start",id:`${n.item_id}:${n.summary_index}`,providerMetadata:{[d]:{itemId:n.item_id,reasoningEncryptedContent:(Z=($=c[n.item_id])==null?void 0:$.encryptedContent)!=null?Z:null}}})}}else n.type==="response.reasoning_summary_text.delta"?i.enqueue({type:"reasoning-delta",id:`${n.item_id}:${n.summary_index}`,delta:n.delta,providerMetadata:{[d]:{itemId:n.item_id}}}):n.type==="response.reasoning_summary_part.done"?h?(i.enqueue({type:"reasoning-end",id:`${n.item_id}:${n.summary_index}`,providerMetadata:{[d]:{itemId:n.item_id}}}),c[n.item_id].summaryParts[n.summary_index]="concluded"):c[n.item_id].summaryParts[n.summary_index]="can-conclude":Qt(n)?(v=Te({finishReason:(K=n.response.incomplete_details)==null?void 0:K.reason,hasFunctionCall:y}),k.inputTokens=n.response.usage.input_tokens,k.outputTokens=n.response.usage.output_tokens,k.totalTokens=n.response.usage.input_tokens+n.response.usage.output_tokens,k.reasoningTokens=(se=(z=n.response.usage.output_tokens_details)==null?void 0:z.reasoning_tokens)!=null?se:void 0,k.cachedInputTokens=(ne=(X=n.response.usage.input_tokens_details)==null?void 0:X.cached_tokens)!=null?ne:void 0,typeof n.response.service_tier=="string"&&(x=n.response.service_tier)):on(n)?(g.push(n.annotation),n.annotation.type==="url_citation"?i.enqueue({type:"source",sourceType:"url",id:(H=(ee=(O=a.config).generateId)==null?void 0:ee.call(O))!=null?H:te(),url:n.annotation.url,title:n.annotation.title}):n.annotation.type==="file_citation"&&i.enqueue({type:"source",sourceType:"document",id:(N=(E=(re=a.config).generateId)==null?void 0:E.call(re))!=null?N:te(),mediaType:"text/plain",title:(G=(L=n.annotation.quote)!=null?L:n.annotation.filename)!=null?G:"Document",filename:(M=n.annotation.filename)!=null?M:n.annotation.file_id,...n.annotation.file_id?{providerMetadata:{[d]:{fileId:n.annotation.file_id}}}:{}})):sn(n)&&i.enqueue({type:"error",error:n})},flush(w){const i={[d]:{responseId:b}};T.length>0&&(i[d].logprobs=T),x!==void 0&&(i[d].serviceTier=x),w.enqueue({type:"finish",finishReason:v,usage:k,providerMetadata:i})}})),request:{body:u},response:{headers:f}}}};function Xt(t){return t.type==="response.output_text.delta"}function Yt(t){return t.type==="response.output_item.done"}function Qt(t){return t.type==="response.completed"||t.type==="response.incomplete"}function Zt(t){return t.type==="response.created"}function en(t){return t.type==="response.function_call_arguments.delta"}function tn(t){return t.type==="response.code_interpreter_call_code.delta"}function nn(t){return t.type==="response.code_interpreter_call_code.done"}function qe(t){return t.type==="response.output_item.added"}function on(t){return t.type==="response.output_text.annotation.added"}function sn(t){return t.type==="error"}function an(t){const u=t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat"),_=t.startsWith("gpt-4")||t.startsWith("gpt-5-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-nano")&&!t.startsWith("gpt-5-chat")||t.startsWith("o3")||t.startsWith("o4-mini"),m={systemMessageMode:"system",supportsFlexProcessing:u,supportsPriorityProcessing:_};return t.startsWith("gpt-5-chat")?{...m,isReasoningModel:!1}:t.startsWith("o")||t.startsWith("gpt-5")||t.startsWith("codex-")||t.startsWith("computer-use")?{...m,isReasoningModel:!0,systemMessageMode:"developer"}:{...m,isReasoningModel:!1}}function Re(t){var u;switch(t.type){case"search":return{action:{type:"search",query:(u=t.query)!=null?u:void 0},...t.sources!=null&&{sources:t.sources}};case"open_page":return{action:{type:"openPage",url:t.url}};case"find":return{action:{type:"find",url:t.url,pattern:t.pattern}}}}var ln=B(()=>R(o({instructions:e().nullish(),speed:s().min(.25).max(4).default(1).nullish()}))),rn=class{constructor(t,u){this.modelId=t,this.config=u,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:t,voice:u="alloy",outputFormat:_="mp3",speed:m,instructions:h,language:f,providerOptions:l}){const a=[],d=await ue({provider:"openai",providerOptions:l,schema:ln}),v={model:this.modelId,input:t,voice:u,response_format:"mp3",speed:m,instructions:h};if(_&&(["mp3","opus","aac","flac","wav","pcm"].includes(_)?v.response_format=_:a.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${_}. Using mp3 instead.`})),d){const k={};for(const T in k){const b=k[T];b!==void 0&&(v[T]=b)}}return f&&a.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${f}" was ignored.`}),{requestBody:v,warnings:a}}async doGenerate(t){var u,_,m;const h=(m=(_=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:_.call(u))!=null?m:new Date,{requestBody:f,warnings:l}=await this.getArgs(t),{value:a,responseHeaders:d,rawValue:v}=await le({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),body:f,failedResponseHandler:ie,successfulResponseHandler:Ke(),abortSignal:t.abortSignal,fetch:this.config.fetch});return{audio:a,warnings:l,request:{body:JSON.stringify(f)},response:{timestamp:h,modelId:this.modelId,headers:d,body:v}}}},un=B(()=>R(o({text:e(),language:e().nullish(),duration:s().nullish(),words:I(o({word:e(),start:s(),end:s()})).nullish(),segments:I(o({id:s(),seek:s(),start:s(),end:s(),text:e(),tokens:I(s()),temperature:s(),avg_logprob:s(),compression_ratio:s(),no_speech_prob:s()})).nullish()}))),pn=B(()=>R(o({include:I(e()).optional(),language:e().optional(),prompt:e().optional(),temperature:s().min(0).max(1).default(0).optional(),timestampGranularities:I(P(["word","segment"])).default(["segment"]).optional()}))),Me={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},dn=class{constructor(t,u){this.modelId=t,this.config=u,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:t,mediaType:u,providerOptions:_}){const m=[],h=await ue({provider:"openai",providerOptions:_,schema:pn}),f=new FormData,l=t instanceof Uint8Array?new Blob([t]):new Blob([ze(t)]);f.append("model",this.modelId);const a=Ue(u);if(f.append("file",new File([l],"audio",{type:u}),`audio.${a}`),h){const d={include:h.include,language:h.language,prompt:h.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:h.temperature,timestamp_granularities:h.timestampGranularities};for(const[v,k]of Object.entries(d))if(k!=null)if(Array.isArray(k))for(const T of k)f.append(`${v}[]`,String(T));else f.append(v,String(k))}return{formData:f,warnings:m}}async doGenerate(t){var u,_,m,h,f,l,a,d;const v=(m=(_=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:_.call(u))!=null?m:new Date,{formData:k,warnings:T}=await this.getArgs(t),{value:b,responseHeaders:r,rawValue:g}=await Je({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:oe(this.config.headers(),t.headers),formData:k,failedResponseHandler:ie,successfulResponseHandler:me(un),abortSignal:t.abortSignal,fetch:this.config.fetch}),y=b.language!=null&&b.language in Me?Me[b.language]:void 0;return{text:b.text,segments:(a=(l=(h=b.segments)==null?void 0:h.map(c=>({text:c.text,startSecond:c.start,endSecond:c.end})))!=null?l:(f=b.words)==null?void 0:f.map(c=>({text:c.word,startSecond:c.start,endSecond:c.end})))!=null?a:[],language:y,durationInSeconds:(d=b.duration)!=null?d:void 0,warnings:T,response:{timestamp:v,modelId:this.modelId,headers:r,body:g}}}},cn="2.0.76";function mn(t={}){var u,_;const m=(u=We(De({settingValue:t.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))!=null?u:"https://api.openai.com/v1",h=(_=t.name)!=null?_:"openai",f=()=>He({Authorization:`Bearer ${Le({apiKey:t.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":t.organization,"OpenAI-Project":t.project,...t.headers},`ai-sdk/openai/${cn}`),l=y=>new ot(y,{provider:`${h}.chat`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),a=y=>new dt(y,{provider:`${h}.completion`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),d=y=>new ht(y,{provider:`${h}.embedding`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),v=y=>new yt(y,{provider:`${h}.image`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),k=y=>new dn(y,{provider:`${h}.transcription`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),T=y=>new rn(y,{provider:`${h}.speech`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch}),b=y=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return r(y)},r=y=>new Kt(y,{provider:`${h}.responses`,url:({path:c})=>`${m}${c}`,headers:f,fetch:t.fetch,fileIdPrefixes:["file-"]}),g=function(y){return b(y)};return g.languageModel=b,g.chat=l,g.completion=a,g.responses=r,g.embedding=d,g.textEmbedding=d,g.textEmbeddingModel=d,g.image=v,g.imageModel=v,g.transcription=k,g.transcriptionModel=k,g.speech=T,g.speechModel=T,g.tools=zt,g}var fn=mn();export{cn as VERSION,mn as createOpenAI,fn as openai};
//# sourceMappingURL=index-ESx8DnZR.js.map
